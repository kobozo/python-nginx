# user  nobody;
worker_processes  auto;
error_log  logs/error.log warn;
pid        /var/run/tb-gw-default.pid;


events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
}


http {
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}
   keepalive_timeout            65;
   keepalive_requests           100000;
   sendfile                     on;
   tcp_nopush                   on;
   tcp_nodelay                  on;

   client_body_buffer_size      128k;
   client_max_body_size         20m;
   client_header_buffer_size    128k;
   large_client_header_buffers  4 128k;
   output_buffers               1 128k;
   postpone_output              1460;

   gzip                          on;
   gzip_min_length               1000;
   gzip_types                    application/x-javascript text/css application/javascript text/javascript text/plain text/xml application/json application/vnd.ms-fontobject application/x-font-opentype application/x-font-truetype application/x-font-ttf application/xml font/eot font/opentype font/otf image/svg+xml image/vnd.microsoft.icon;
   gzip_disable                  "MSIE [1-6]\.";

   default_type                  text/html;

   lua_shared_dict               aznCache 10m;
   lua_shared_dict               authCache 50m;

   map $http_cookie $session {
      default '';
      ~IDHUB-SESSION=(?<mc>[^\;]+) $mc;
   }

   log_format                    logstash '$http_host $remote_addr [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_time $upstream_response_time $http_Authorization $http_true_client_ip $session $sent_http_location';

   # Proxy Global Settings
   proxy_intercept_errors         off;
   proxy_ignore_client_abort      off;
   proxy_redirect                 http:// $scheme://;

   # Proxy failover
   proxy_next_upstream            error timeout invalid_header http_502 http_503 http_504;

   # We don't want to expose to much
   proxy_hide_header              Server;
   proxy_hide_header              X-Powered-By;
   proxy_hide_header              X-AspNet-Version;

   # Default headers we want to send back to the server
   proxy_set_header               Host                $http_host;
   proxy_set_header               X-Forwarded-By      $server_addr:$server_port;
   proxy_set_header               X-Real-IP           $remote_addr;
   proxy_set_header               X-Forwarded-For     $proxy_add_x_forwarded_for;

   proxy_set_header               X-Forwarded-Proto $scheme;
   map $scheme $msiis             {
      http off;
      https on;
   }
   # compatibility
   proxy_set_header               Front-End-Https   $msiis;

   ### proxy-timeouts ###
   proxy_connect_timeout          6;
   proxy_send_timeout             60;
   proxy_read_timeout             60;

   ### proxy-buffers ###
   proxy_buffering                on;
   proxy_buffer_size              128k;
   proxy_buffers                  256 128k;
   proxy_busy_buffers_size        128k;
   proxy_temp_file_write_size     128k;

   server_tokens off;
   more_set_headers 'Server: Unknown';
   
	set_real_ip_from 173.245.48.0/20;
	set_real_ip_from 103.21.244.0/22;
	set_real_ip_from 103.22.200.0/22;
	set_real_ip_from 103.31.4.0/22;
	set_real_ip_from 141.101.64.0/18;
	set_real_ip_from 108.162.192.0/18;
	set_real_ip_from 190.93.240.0/20;
	set_real_ip_from 188.114.96.0/20;
	set_real_ip_from 197.234.240.0/22;
	set_real_ip_from 198.41.128.0/17;
	set_real_ip_from 162.158.0.0/15;
	set_real_ip_from 104.16.0.0/12;
	set_real_ip_from 104.16.0.0/13;
	set_real_ip_from 104.24.0.0/14;
	set_real_ip_from 172.64.0.0/13;
	set_real_ip_from 131.0.72.0/22;
	set_real_ip_from 10.16.46.220/32;
	set_real_ip_from 10.73.46.218/32;
	set_real_ip_from  10.16.46.192/26;
	set_real_ip_from  10.73.46.192/26;
	set_real_ip_from 2400:cb00::/32;
	set_real_ip_from 2606:4700::/32;
	set_real_ip_from 2803:f800::/32;
	set_real_ip_from 2405:b500::/32;
	set_real_ip_from 2405:8100::/32;
	set_real_ip_from 2a06:98c0::/29;
	set_real_ip_from 2c0f:f248::/32;
	real_ip_header True-Client-IP;


   ### DNS Resolver ###
   resolver                       127.0.0.1;

 
upstream orchestrator_backend_predup {
    hash $remote_addr$http_x_forwarded_for consistent;
    server 10.16.35.3:8444;
    keepalive 32;
}
 
### Orchestrator Backend

upstream orchestrator_backend {
    hash $remote_addr$http_x_forwarded_for consistent;
    server 10.16.35.3:8443;
    keepalive 32;
}

upstream tba_backend {
    hash $http_x_forwarded_for consistent;
    server 10.16.35.3:18080;

    keepalive 32;
}
 
upstream ntlm_test {
    hash $remote_addr$http_x_forwarded_for consistent;
    server 10.16.43.55;
    keepalive 32;
}

   
   server {
      listen *:443 default_server ssl ;
      listen *:80 default_server;
      
      access_log /opt/trustbuilder/gateway/instances/default/logs/root_access.log logstash;

      if ($scheme = http) {
        return 301 https://$http_host$request_uri;
      }

      root                          /opt/trustbuilder/gateway/instances/default/docroots/root;

      error_page 404                /404.html;
      error_page 403                /403.html;
      error_page 500 502 503 504    /500.html;

      # Configuration of root vhost
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $domain          				'.allianz.be';
if ($http_host ~* 'allianz.nl'){
	set $domain          				'.allianz.nl';
}
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
   }

 
  server {
	listen *:443 ssl; 
	server_name aovportaal-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/aovportaal-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
	       set $my_host "life-aov-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
   	       proxy_set_header Host $my_host; 
	       proxy_pass  https://life-aov-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;               
   }

 location /ae-aov-fe {
                set $my_host "life-aov-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
   	       proxy_set_header Host $my_host; 
	       proxy_pass  https://life-aov-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-aov-fe;
   }
  
   #redirect logic to short the end user url
   location /register {
		
		return 302 https://api-uat.allianz.nl/ae-aov-bff/login/register?method=register&connection_code=$arg_cc;
   }
   
    location /login {
				
		return 302 https://api-uat.allianz.nl/ae-aov-bff/login;
   }
   
  }
 
server {
	listen *:443 ssl;
	server_name plp-uat.allianz.be;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}
 
	access_log /opt/trustbuilder/gateway/instances/default/logs/plp-uat/plp-uat.log logstash;
	
 
 location / {
		set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be;
	}
 
}
 
server {   
	listen *:443 ssl;
	server_name brmfun-uat.allianz.be;
	access_log /opt/trustbuilder/gateway/instances/default/logs/brmfun-uat.allianz.be/brmfun-uat.allianz.be_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;

	error_page 404 /404.html;
	error_page 403 /403.html;
	error_page 500 502 503 504 /500.html;

	# Configuration of root vhost 
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}

	#brmfun-uat.allianz.be
	location / {
    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header        X-Forwarded-Proto https;
		proxy_set_header Host   "brmfun-uat.allianz.be";
		proxy_pass              http://brmfun-uat.allianz.be;
		
	}
} 
server {
	listen *:443 ssl; 
	server_name mybroker-prp.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/adviseur_preprod_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
		 allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		
		allow 217.136.94.43/32;
		allow 185.106.154.61;
		allow 51.138.21.47;
		allow 51.138.21.189;
		allow 51.138.22.34;
		allow 51.138.22.122;
		allow 51.138.22.229;
		allow 51.138.104.128;
		allow 20.50.2.42;
		allow 185.125.236.21;
		allow 20.123.162.172;
		deny all;
		set $my_host "up-fe-azbnl-btu-up-preprod.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
		##proxy_pass  https://up-fe-azbnl-btu-up-preprod.apps.tools.adp.allianz;
   }
}
 
server {
	listen *:443 ssl;
	server_name plp-dup.allianz.be;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}
 
	access_log /opt/trustbuilder/gateway/instances/default/logs/plp-dup/plp-dup.log logstash;
	
	#proxy_set_header X-Forwarded-Proto $scheme;
	
	location / {
		proxy_redirect https://$http_host$request_uri http://$http_host$request_uri;
	}
 
 location /UL3 {
		set $my_host "bapps1920-ext-uat.agf.be";
		proxy_set_header Host $my_host; 
		proxy_pass http://bapps1920-ext-uat.agf.be:446;
	}
	
	location /zlfile {
		set $my_host "bapps1920-ext-uat.agf.be";
		proxy_set_header Host $my_host; 
		proxy_pass http://bapps1920-ext-uat.agf.be:446;
	}
	
	location /ZLFILE {
		set $my_host "bapps1920-ext-uat.agf.be";
		proxy_set_header Host $my_host; 
		proxy_pass http://bapps1920-ext-uat.agf.be:446;
	}
 
 #location /plp-tst {
	#	set $my_host "plp-brokerportal-fe-tst.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	#	proxy_set_header Host $my_host; 
	#	proxy_pass https://plp-brokerportal-fe-tst.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   # #proxy_redirect https://plp-brokerportal-fe-tst.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be;
	#}
 
 # Exposing PLP broker portal
 location /brokerportal {
		set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
	}
	
	location /runtime.56634f204058884b.js {
    set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
     
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/runtime.56634f204058884b.js;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
  }
  
  location /polyfills.bf8afd5d5bfa00a0.js {
    set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
     
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/polyfills.bf8afd5d5bfa00a0.js;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
  }
  
 
 location /main.13decda400571475.js {
    set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
     
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/main.13decda400571475.js;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
  }
  
  location /styles.008bef92bb8192a7.css {
    set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
     
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/styles.008bef92bb8192a7.css;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
  }
  
  location /Proxima-Nova-Regular.1502401d93b62e39.woff2{
    set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
     
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/Proxima-Nova-Regular.1502401d93b62e39.woff2;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
  }
 
 location ^~ .(js|css|woff2)$ {
    set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
     
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/$1;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
  }
  
  location /assets {
		set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/assets;
    #proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be/brokerportal;
	}
}
 
server {
	listen *:443 ssl;
	server_name extranet-dup.mgm-dup.agf.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
location /BI {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognosui-dup";
		proxy_set_header Host $my_host;
		return 302 http://cognosui-dup/bi;
}

location /bi {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognosui-dup";
		proxy_set_header Host $my_host;
		return 302 http://cognosui-dup/bi;
} 
location /atline {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		
		#proxy_pass http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
		#proxy_redirect http://fwkdcc-dup.agf.be https://extranet-dup-tb.allianz.be;
		
		return 302 http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
}

location /EBonline/Apps/Atline/AtlinePlus {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
}

location /ebonline/apps/atline/atlineplus {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
} 
location /cp {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
														x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		sub_filter_once off;
		sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';
		sub_filter '/Fr/ext_public' '/cp/Fr/ext_public';
		sub_filter '/Nl/ext_public' '/cp/Nl/ext_public';
		sub_filter 'cp-dup.allianz.be' 'extranet-dup-tb.allianz.be';

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /CP {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
														x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';
		sub_filter '/Fr/ext_public' '/cp/Fr/ext_public';
		sub_filter '/Nl/ext_public' '/cp/Nl/ext_public';
		sub_filter 'cp-dup.allianz.be' 'extranet-dup-tb.allianz.be';

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /Fr/extranet/collaborationPlateforme {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		#proxy_pass http://cp-dup.allianz.be/cp/Fr/extranet/collaborationPlateforme/mesDocuments/Pages/default.aspx;
		#proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
		
		return 302 https://extranet-dup-tb.allianz.be/cp/Fr/extranet/collaborationPlateforme/tousDocuments/Pages/default.aspx;
}

location /Nl/extranet/collaborationPlateforme {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		#proxy_pass http://cp-dup.allianz.be/cp/Nl/extranet/collaborationPlateforme/mesDocuments/Paginas/default.aspx;
		#proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
		
		return 302 https://extranet-dup-tb.allianz.be/cp/Nl/extranet/collaborationPlateforme/tousDocuments/Paginas/default.aspx;
}

location '/style%20library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/style library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/Style Library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/Style%20Library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
} 
location /ebonline/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

	sub_filter_once off;
	sub_filter 'ebonline-dup.allianz.be' 'extranet-dup-tb.allianz.be/ebonline';

		set $my_host "ebonline-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://extranet-dup-tb.allianz.be/ebonline;
}

location /EBonline/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

	sub_filter_once off;
	sub_filter 'ebonline-dup.allianz.be' 'extranet-dup-tb.allianz.be/ebonline';

		set $my_host "ebonline-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://extranet-dup-tb.allianz.be/ebonline;
}

location /EBonline/Apps/CP_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		
	return 302 https://extranet-dup-tb.allianz.be/cp/Fr/extranet/collaborationPlateforme/tousDocuments/Pages/default.aspx;
}

location /EBonline/Apps/CP_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		
	return 302 https://extranet-dup-tb.allianz.be/cp/Nl/extranet/collaborationPlateforme/tousDocuments/Paginas/default.aspx;
} 
location /plnnet/ {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	
	error_page 404 =200 /plnnet/nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'extranet-dup-tb.allianz.be/plnnet';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be/plnnet; 
}

location /PlnNet/ {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	
	error_page 404 =200 /plnnet/nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'extranet-dup-tb.allianz.be/plnnet';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be/plnnet; 
}

location /Plnnet/ {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	
	error_page 404 =200 /plnnet/nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'extranet-dup-tb.allianz.be/plnnet';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be/plnnet; 
} 
 
location /APPS {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkdcc-dup.agf.be;
		proxy_redirect https://lan-apps-dup.allianz.be http://fwkdcc-dup.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /Apps {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkdcc-dup.agf.be;
		proxy_redirect https://lan-apps-dup.allianz.be http://fwkdcc-dup.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		#proxy_set_header Connection "";
}

location /apps {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkdcc-dup.agf.be;
		#proxy_redirect https://lan-apps-dup.allianz.be http://fwkdcc-dup.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/NL {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/FR {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
location /apps/QuotationTool/RCDecennal/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/NL {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/nl-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/nl-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
location /apps/QuotationTool/TrafficPlan/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/Nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

 
location /_catalogs/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		set $my_host "";
		set $app "";
		set $sub "";
		
		if ($request_uri ~ .*plnnet.*) {
			set $my_host "plnnet-dup.allianz.be";
			set $app "plnnet";
			set $sub "plnnet/";
		}
		if ($request_uri ~ .*ebonline.*) {
			set $my_host "ebonline-dup.allianz.be";
			set $app "ebonline";
			set $sub "";
		}
		if ($request_uri ~ .*cp.*) {
			set $my_host "cp-dup.allianz.be";
			set $app "cp";
			set $sub "cp/";
		}
		if ($request_uri ~ .*atline.*) {
			set $my_host "atlinenet-dup.allianz.be";
			set $app "atlinenet";
			set $sub "";
		}
		
		proxy_set_header Host $my_host;
		proxy_pass http://app-dup.allianz.be/$sub;
		proxy_redirect http://app-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location /_layouts {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_layouts;
}

location /_upresources {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_upresources;
}

location /_vti_bin {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
}

location /_vti_inf.html* {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
}

location /documents {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /Documents {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /en/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
}

location /fr/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /FR/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /NL/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /ge/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
}

location /images {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/images;
}

location /nl/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
}

location /PublishingImages {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/PublishingImages;
}

location '/Style Library' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location /Style%20Library {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/$1;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/style library' {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be;
		proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /style%20library {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/$1;
		proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /Fr/Images_ext_secure {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be/cp; 
}

location /Nl/Images_ext_secure {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be/cp; 
} 
location /web/LVL3/Net4/Prevention/PreventionPolicyDoc {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/web/LVL3/Net4/Prevention/PreventionPolicyDoc;
} 
location /_common {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	#proxy_pass http://extranet-dup.mgm-dup.agf.be/_common;
	return 302 http://extranet-dup.mgm-dup.agf.be/_common;
}

location /_forms {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_forms;
}

location /crm/_forms {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/crm/_forms;
}

location /_grid {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_grid;
}

location /_imgs {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_imgs;
}

location /_static {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_static;
}

location /_static/_common {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_static/_common;
}

location /crm {
	access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		#add_header Set-Cookie "INTAZBE=LeNZotKf0S6qG6GEHNUlVGPtOLZmpfYvw9jZwmINbQgEBHKbtCfVYc76xX8xbLXPMRN3WiY957/8ekkSxx/Nug==";
		add_header Access-Control-Allow-Origin *;
		add_header Access-Control-Allow-Headers Content-Length;
		add_header Access-Control-Expose-Headers Content-Length;
		add_header Sec-Fetch-Dest "";
		add_header Sec-Fetch-Mode "";
		add_header Sec-Fetch-Site "";
		
		proxy_request_buffering off;
		
		set $my_host "extranet-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://extranet-dup.mgm-dup.agf.be/crm;
		#proxy_redirect http://extranet-dup.mgm-dup.agf.be https://extranet-dut-tb.allianz.be;
}

location /crm/XRMServices {
	access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		#add_header Set-Cookie "INTAZBE=LeNZotKf0S6qG6GEHNUlVGPtOLZmpfYvw9jZwmINbQgEBHKbtCfVYc76xX8xbLXPMRN3WiY957/8ekkSxx/Nug==";
		add_header Access-Control-Allow-Origin *;
		add_header Access-Control-Allow-Headers Content-Length;
		add_header Access-Control-Expose-Headers Content-Length;
		add_header Sec-Fetch-Dest "";
		add_header Sec-Fetch-Mode "";
		add_header Sec-Fetch-Site "";
		
		proxy_request_buffering off;
		
		set $my_host "extranet-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://extranet-dup.mgm-dup.agf.be/crm;
		#proxy_redirect http://extranet-dup.mgm-dup.agf.be https://extranet-dut-tb.allianz.be;
}

location /CRMReports {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/CRMReports;
}

location /help {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/help;
}

location /Reserved.ReportViewerWebControl.axd* {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/Reserved.ReportViewerWebControl.axd*;
}

location /ScriptResource.axd* {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/scriptresource.axd*;
}

location /tools {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/tools;
}

location /webresource.axd* {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/webresource.axd*;
}	
	access_log /opt/trustbuilder/gateway/instances/default/logs/extranet-dup.mgm-dup_access.log logstash;

	root /opt/trustbuilder/gateway/instances/default/docroots/root;

	location / {
		#set $my_host "extranet-dup.allianz.be";
		#proxy_set_header Host $my_host;
		#proxy_pass https://extranet-dup.allianz.be;
		return 302 https://extranet-dup.allianz.be$request_uri;
	}

} 
server {
	listen *:443 ssl; 
	server_name orvportaal-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/orvportaal-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
    
    sub_filter_once off;
	  sub_filter '02 895 10 00' '088 - 577 7300';
    
		set $my_host "egv-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://egv-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-egv-fe;
   }

   location /ae-egv-fe {
                set $my_host "egv-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_set_header Host $my_host;
                proxy_pass https://egv-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-egv-fe;
   }

location /ae-egv-fe/information {
                set $my_host "egv-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_set_header Host $my_host;
                proxy_pass https://egv-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-egv-fe/information;
   }
   
 #  location /ae-egv-bff {
 #               set $my_host "eu-uat-benelux.apis.allianz.com";
 #               proxy_set_header Host $my_host;
 #               proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-egv-bff;
 #  }

 #  location /ae-egv-bff/login {
 #               set $my_host "eu-uat-benelux.apis.allianz.com";
 #               proxy_set_header Host $my_host;
 #               proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-egv-bff/login;
 #  }
 
 
 
	location /ae-egv-bff/login/register {
		set $my_host "eu-uat-benelux.apis.allianz.com";
		proxy_set_header Host $my_host;
		proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-egv-bff/login/register;
		proxy_redirect https://eu-uat-benelux.apis.allianz.com/ae-egv-bff/login/register https://orvportaal-uat.allianz.nl;
    }
   
   #location /ais {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
    #            set $my_host "orvportaal-uat.allianz.nl";
	#	proxy_set_header Host $my_host; 
	#	proxy_pass  https://eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz/ais;
	#	proxy_redirect https://eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz https://orvportaal-uat.allianz.nl;
   #}
   
    location /ais/screens {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
		set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/screens;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
    location /ais/css {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
	        set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/css;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
     location /ais/html {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
                set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/html;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
     location /ais/images {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
	        set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/images;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
   
     location /ais/js {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
                set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/js;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
     location /ais/bootstrap {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
                set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/bootstrap;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
    location /ais/favicon {
		#set $my_host "eap-app-azbnl-allfinanz-uat.apps.tools.adp.allianz";
                set $my_host "orvportaal-uat.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb20410.srv.allianz:8443/ais/favicon;
		proxy_redirect https://slb20410.srv.allianz:8443 https://orvportaal-uat.allianz.nl;
   }
   
   

   
}
 
server {
	listen *:80;
	server_name www-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
    location /abslife {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "sso-dup.allianz.be";
        proxy_set_header Host $my_host;
        
    }
	location /indisponible {
		proxy_pass http://indisponible:8080/indisponible;
	}
	location /AllianzBE {
		proxy_pass http://moss-inet-dup.allianz.be/AllianzBE;
	}
	location /pro* {
		proxy_pass http://moss-inet-dup.allianz.be:9000/pro*;
	}
	location /_catalogs {
		proxy_pass http://redirect-dup.allianz.be/_catalogs;
	}
	location /allianz/images {
		proxy_pass http://redirect-dup.allianz.be/allianz/images;
	}
	location /allianz/media {
		proxy_pass http://redirect-dup.allianz.be/allianz/media;
	}
	location /allianz/mybenefits {
		proxy_pass http://redirect-dup.allianz.be/allianz/mybenefits;
	}
	location /BrokerLocalisation {
		proxy_pass http://redirect-dup.allianz.be/BrokerLocalisation;
	}
	location /emac/geolocalisation {
		proxy_pass http://redirect-dup.allianz.be/emac/geolocalisation;
	}
	location /FiscalForms {
		proxy_pass http://redirect-dup.allianz.be/FiscalForms;
	}
	location /fr* {
		proxy_pass http://redirect-dup.allianz.be/fr*;
	}
	location /GenericSearchEngine {
		proxy_pass http://redirect-dup.allianz.be/GenericSearchEngine;
	}
	location /life/performancecalculation {
		proxy_pass http://redirect-dup.allianz.be/life/performancecalculation;
	}
	location /nl* {
		proxy_pass http://redirect-dup.allianz.be/nl*;
	}
	location /robots.txt {
		proxy_pass http://redirect-dup.allianz.be/robots.txt;
	}
	location /sitemap.xml {
		proxy_pass http://redirect-dup.allianz.be/sitemap.xml;
	}
	location /Web/LVL3/Net4/P_C/FastQuote {
		proxy_pass http://redirect-dup.allianz.be/Web/LVL3/Net4/P_C/FastQuote;
	}
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name wood-life126-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://10.16.43.41/;
	}
}
server {
	listen *:80;
	server_name carplan-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/carplan;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/carplan;
	}
}
server {
	listen *:80;
	server_name homeplan-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/test;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/test;
	}
}
server {
	listen *:80;
	server_name InvestForLife-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/investforlife;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/investforlife;
	}
}
server {
	listen *:80;
	server_name prevoyance-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/prevoyance;
	}
}
server {
	listen *:80;
	server_name voorzorg-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/voorzorg;
	}
}
server {
	listen *:80;
	server_name www.carplan-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/carplan;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/carplan;
	}
}
server {
	listen *:80;
	server_name www.homeplan-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/test;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/test;
	}
}
server {
	listen *:80;
	server_name www.InvestForLife-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
}
server {
	listen *:80;
	server_name www.prevoyance-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/prevoyance;
	}
}
server {
	listen *:80;
	server_name www.voorzorg-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_layouts {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_layouts;
	}
	location /_upresources {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_upresources;
	}
	location /_vti_bin {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_bin;
	}
	location /_vti_inf.html* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/_vti_inf.html*;
	}
	location /documents {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/documents;
	}
	location /en/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/en/ext_public;
	}
	location /fr/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/ext_public;
	}
	location /fr/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/flash;
	}
	location /fr/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/fr/PublishingImages;
	}
	location /ge/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/ge/ext_public;
	}
	location /images {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/images;
	}
	location /lists {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/lists;
	}
	location /nl/ext_public {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/ext_public;
	}
	location /nl/flash {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/flash;
	}
	location /nl/PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/nl/PublishingImages;
	}
	location /PublishingImages {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/PublishingImages;
	}
	location /scriptresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/scriptresource.*;
	}
	location /Style%20Library {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/Style%20Library;
	}
	location /webresource.* {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/webresource.*;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/voorzorg;
	}
}
server {
	listen *:80;
	server_name www.investforlife-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /FR {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/FR/internet/investforlife;
	}
	location /NL {
		proxy_pass http://spscms-fiz-dup.mgm-dup.agf.be/NL/internet/investforlife;
	}
}
server {
	listen *:80;
	server_name allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_catalogs {
		proxy_pass http://redirect-dup.allianz.be/_catalogs;
	}
	location /allianz/images {
		proxy_pass http://redirect-dup.allianz.be/allianz/images;
	}
	location /allianz/media {
		proxy_pass http://redirect-dup.allianz.be/allianz/media;
	}
	location /allianz/mybenefits {
		proxy_pass http://redirect-dup.allianz.be/allianz/mybenefits;
	}
	location /BrokerLocalisation {
		proxy_pass http://redirect-dup.allianz.be/BrokerLocalisation;
	}
	location /emac/geolocalisation {
		proxy_pass http://redirect-dup.allianz.be/emac/geolocalisation;
	}
	location /FiscalForms {
		proxy_pass http://redirect-dup.allianz.be/FiscalForms;
	}
	location /fr* {
		proxy_pass http://redirect-dup.allianz.be/fr*;
	}
	location /GenericSearchEngine {
		proxy_pass http://redirect-dup.allianz.be/GenericSearchEngine;
	}
	location /life/performancecalculation {
		proxy_pass http://redirect-dup.allianz.be/life/performancecalculation;
	}
	location /nl* {
		proxy_pass http://redirect-dup.allianz.be/nl*;
	}
	location /robots.txt {
		proxy_pass http://redirect-dup.allianz.be/robots.txt;
	}
	location /sitemap.xml {
		proxy_pass http://redirect-dup.allianz.be/sitemap.xml;
	}
	location /Web/LVL3/Net4/P_C/FastQuote {
		proxy_pass http://redirect-dup.allianz.be/Web/LVL3/Net4/P_C/FastQuote;
	}
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name oasys-val.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name www-dup.agf.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name www-dup.mybenefits.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name www-dup2.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name www.prolinknet-dup.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://anonymous-dup.allianz.be/;
	}
}
server {
	listen *:80;
	server_name e1-2spdgw-uat.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /api {
		proxy_pass http://e1-2spdfe-uat.agf.be:8081/api;
	}
}
server {
	listen *:80;
	server_name e1-2spdfe-nft.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://e1-2spdfe-uat.agf.be:8084/;
	}
}
server {
	listen *:80;
	server_name 172.16.181.195;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /broker {
		#proxy_pass http://absepp-uat.allianz.be:8082/broker;
	}
}
server {
	listen *:80;
	server_name absepp-8082-uat.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /broker {
		#proxy_pass http://absepp-uat.allianz.be:8082/broker;
	}
}
server {
	listen *:80;
	server_name absepp-8085-uat.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /broker {
		#proxy_pass http://absepp-uat.allianz.be:8085/broker;
	}
	location /status {
		#proxy_pass http://absepp-uat.allianz.be:8085/status;
	}
}
server {
	listen *:4448 ssl;
	server_name plp-dup.allianz.be;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location / {
		proxy_pass http://fwkdcc-hts-fez-dup.mgm-dup.agf.be/;
	}
}

server {
	listen *:8063;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /_common {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/_common;
	}
	location /_forms {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/_forms;
	}
	location /_grid {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/_grid;
	}
	location /_imgs {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/_imgs;
	}
	location /_static {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/_static;
	}
	location /crm {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/crm;
	}
	location /CRMReports {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/CRMReports;
	}
	location /help {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/help;
	}
	location /Reserved.ReportViewerWebControl.axd* {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/Reserved.ReportViewerWebControl.axd*;
	}
	location /scriptresource.axd* {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/scriptresource.axd*;
	}
	location /tools {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/tools;
	}
	location /webresource.axd* {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://climb-uat.allianz.be/webresource.axd*;
	}
	location /helloworld {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://poctrustbuilder-dup.allianz.be/;
	}
}
server {
	listen *:8066;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /apir3b {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://e1-2spdfe1-uat.agf.be:8087/api;
	}
	location /absr3b {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://e1-2spdfe1-uat.agf.be:8082/absr3b;
	}
}
server {
	listen *:8065;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /api {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://e1-2spdfe1-uat.agf.be:8086/api;
	}
	location /absr3 {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://e1-2spdfe1-uat.agf.be:8081/absr3;
	}
}
server {
	listen *:8064;
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
	location /broker {
		access_by_lua_block {
			local header_map = {
				x_hdr_email = "credential.attributes['common|email']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		proxy_pass http://e1-absepp-uat.agf.be:8083/broker;
	}
}

 
server {
	listen *:443 ssl;

	server_name sso-predup.allianz.be;

      	access_log /opt/trustbuilder/gateway/instances/default/logs/sso-predup_access.log logstash;

      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

      	root                          /opt/trustbuilder/gateway/instances/default/docroots/root;

      	error_page 404                /404.html;
      	error_page 403                /403.html;
      	error_page 500 502 503 504    /500.html;

      	# Configuration of root vhost
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $domain          '.allianz.be';
set $session_regenerate             0;
set $session_auth		    'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}
## Itsme (EBPCD)
location /uat/itsme/callback {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'c7e973cb-ee2d-4261-9fe3-b67a432cbbb5';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/2f9036fb-b8ec-40c5-8370-12e1aa6ea599 {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '9ab005c5-c89f-4338-a56e-67cd515fd34e';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /idhub/tb/showHeaders {
    access_by_lua_block {
        local header_map= {
                x_hdr_header="credential.attributes['digidentity|digidentityHeader']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend_predup/idhub/tb/showHeaders;
}
location /jwks {
    proxy_pass https://orchestrator_backend_predup/idhub/oidc/v1/jwks.json;
}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        #deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    proxy_pass https://orchestrator_backend_predup;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.16.35.27;  ## HYDRABNL11
    deny all;

    proxy_pass https://orchestrator_backend_predup;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend_predup/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend_predup/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend_predup;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    deny all;

    proxy_pass https://orchestrator_backend_predup/idhub/public/api/v1/idp/provisioning/reset;
}

      
}
 
server {
	listen *:443 ssl; 
	server_name eb-int.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/eb-int_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
  location / {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	#deny all;
	
	#CRPV2
	set $my_host "eb-portal-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	proxy_set_header Host $my_host; 
	proxy_pass  https://eb-portal-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
	
  }
  
	location /ae-eb-portal-bff {

		set $my_host "eu-int-benelux.apis.allianz";
		proxy_set_header Host $my_host;
		proxy_pass https://eu-int-benelux.apis.allianz/ae-eb-portal-bff;
	}

	location /eb-portal-bo-fe/ {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		#deny all;
		
		#proxy_set_header authorization $http_authorization;
		#proxy_pass_header  authorization;

		#set $my_host "eb-portal-bo-fe-azbnl-eb-portal-int.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host;
		#proxy_pass http://eb-portal-bo-fe-azbnl-eb-portal-int.apps.tools.adp.allianz/eb-portal-bo-fe/;
		#proxy_redirect https://eb-portal-bo-fe-azbnl-eb-portal-int.apps.tools.adp.allianz/eb-portal-bo-fe/ #https://eb-int.allianz.be/eb-portal-bo-fe/; 
		
		#CRPV2
		set $my_host "eb-portal-bo-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host;
		proxy_pass https://eb-portal-bo-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-bo-fe/;
		proxy_redirect https://eb-portal-bo-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-bo-fe/ https://eb-int.allianz.be/eb-portal-bo-fe/; 
	}
}
 
server {
	listen *:443 ssl; 
	server_name ebquotation-uat.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}

	access_log /opt/trustbuilder/gateway/instances/default/logs/ebquotation-uat.allianz.be/ebquotation-uat.allianz.be_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	
	location / {
				
		set $my_host "quotationtool-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://quotationtool-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;  
	}
	
	location /eb-quotation-tool/ {
				
		set $my_host "quotationtool-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://quotationtool-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-quotation-tool/;             
	}
	  
	
   
   
   
}
 
server {
	listen *:443 ssl;

	server_name prolinknet-predup.allianz.be;

      	access_log /opt/trustbuilder/gateway/instances/default/logs/prolinknet-predup_access.log logstash;

      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

      	root                          /opt/trustbuilder/gateway/instances/default/docroots/root;

      	error_page 404                /404.html;
      	error_page 403                /403.html;
      	error_page 500 502 503 504    /500.html;

      	# Configuration of root vhost
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}
## Itsme (EBPCD)
location /uat/itsme/callback {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'c7e973cb-ee2d-4261-9fe3-b67a432cbbb5';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/2f9036fb-b8ec-40c5-8370-12e1aa6ea599 {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '9ab005c5-c89f-4338-a56e-67cd515fd34e';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /idhub/tb/showHeaders {
    access_by_lua_block {
        local header_map= {
                x_hdr_header="credential.attributes['digidentity|digidentityHeader']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend_predup/idhub/tb/showHeaders;
}
location /jwks {
    proxy_pass https://orchestrator_backend_predup/idhub/oidc/v1/jwks.json;
}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        #deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    proxy_pass https://orchestrator_backend_predup;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.16.35.27;  ## HYDRABNL11
    deny all;

    proxy_pass https://orchestrator_backend_predup;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend_predup/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend_predup/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend_predup;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    deny all;

    proxy_pass https://orchestrator_backend_predup/idhub/public/api/v1/idp/provisioning/reset;
}
}
 
server {
	listen *:443 ssl;
	server_name extranet-dup-tb.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
location /BI {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognosui-dup";
		proxy_set_header Host $my_host;
		return 302 http://cognosui-dup/bi;
}

location /bi {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognosui-dup";
		proxy_set_header Host $my_host;
		return 302 http://cognosui-dup/bi;
} 
location /atline {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		
		#proxy_pass http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
		#proxy_redirect http://fwkdcc-dup.agf.be https://extranet-dup-tb.allianz.be;
		
		return 302 http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
}

location /EBonline/Apps/Atline/AtlinePlus {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
}

location /ebonline/apps/atline/atlineplus {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://fwkdcc-dup.agf.be/lvl3/NET2/Life/EB/Atline/;
} 
location /cp {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
														x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		sub_filter_once off;
		sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';
		sub_filter '/Fr/ext_public' '/cp/Fr/ext_public';
		sub_filter '/Nl/ext_public' '/cp/Nl/ext_public';
		sub_filter 'cp-dup.allianz.be' 'extranet-dup-tb.allianz.be';

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /CP {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
														x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';
		sub_filter '/Fr/ext_public' '/cp/Fr/ext_public';
		sub_filter '/Nl/ext_public' '/cp/Nl/ext_public';
		sub_filter 'cp-dup.allianz.be' 'extranet-dup-tb.allianz.be';

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /Fr/extranet/collaborationPlateforme {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		#proxy_pass http://cp-dup.allianz.be/cp/Fr/extranet/collaborationPlateforme/mesDocuments/Pages/default.aspx;
		#proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
		
		return 302 https://extranet-dup-tb.allianz.be/cp/Fr/extranet/collaborationPlateforme/tousDocuments/Pages/default.aspx;
}

location /Nl/extranet/collaborationPlateforme {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		#proxy_pass http://cp-dup.allianz.be/cp/Nl/extranet/collaborationPlateforme/mesDocuments/Paginas/default.aspx;
		#proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
		
		return 302 https://extranet-dup-tb.allianz.be/cp/Nl/extranet/collaborationPlateforme/tousDocuments/Paginas/default.aspx;
}

location '/style%20library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/style library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/Style Library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/Style%20Library/allianz/js/cp' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be;
	proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be; 
} 
location /ebonline/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

	sub_filter_once off;
	sub_filter 'ebonline-dup.allianz.be' 'extranet-dup-tb.allianz.be/ebonline';

		set $my_host "ebonline-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://extranet-dup-tb.allianz.be/ebonline;
}

location /EBonline/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

	sub_filter_once off;
	sub_filter 'ebonline-dup.allianz.be' 'extranet-dup-tb.allianz.be/ebonline';

		set $my_host "ebonline-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://extranet-dup-tb.allianz.be/ebonline;
}

location /EBonline/Apps/CP_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		
	return 302 https://extranet-dup-tb.allianz.be/cp/Fr/extranet/collaborationPlateforme/tousDocuments/Pages/default.aspx;
}

location /EBonline/Apps/CP_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		
	return 302 https://extranet-dup-tb.allianz.be/cp/Nl/extranet/collaborationPlateforme/tousDocuments/Paginas/default.aspx;
} 
location /plnnet/ {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	
	error_page 404 =200 /plnnet/nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'extranet-dup-tb.allianz.be/plnnet';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be/plnnet; 
}

location /PlnNet/ {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	
	error_page 404 =200 /plnnet/nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'extranet-dup-tb.allianz.be/plnnet';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be/plnnet; 
}

location /Plnnet/ {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	
	error_page 404 =200 /plnnet/nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'extranet-dup-tb.allianz.be/plnnet';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be/plnnet; 
} 
 
location /APPS {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkdcc-dup.agf.be;
		proxy_redirect https://lan-apps-dup.allianz.be http://fwkdcc-dup.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /Apps {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkdcc-dup.agf.be;
		proxy_redirect https://lan-apps-dup.allianz.be http://fwkdcc-dup.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		#proxy_set_header Connection "";
}

location /apps {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkdcc-dup.agf.be;
		#proxy_redirect https://lan-apps-dup.allianz.be http://fwkdcc-dup.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/NL {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/FR {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
location /apps/QuotationTool/RCDecennal/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/NL {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/nl-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/nl-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
location /apps/QuotationTool/TrafficPlan/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/Nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

 
location /_catalogs/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		set $my_host "";
		set $app "";
		set $sub "";
		
		if ($request_uri ~ .*plnnet.*) {
			set $my_host "plnnet-dup.allianz.be";
			set $app "plnnet";
			set $sub "plnnet/";
		}
		if ($request_uri ~ .*ebonline.*) {
			set $my_host "ebonline-dup.allianz.be";
			set $app "ebonline";
			set $sub "";
		}
		if ($request_uri ~ .*cp.*) {
			set $my_host "cp-dup.allianz.be";
			set $app "cp";
			set $sub "cp/";
		}
		if ($request_uri ~ .*atline.*) {
			set $my_host "atlinenet-dup.allianz.be";
			set $app "atlinenet";
			set $sub "";
		}
		
		proxy_set_header Host $my_host;
		proxy_pass http://app-dup.allianz.be/$sub;
		proxy_redirect http://app-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location /_layouts {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_layouts;
}

location /_upresources {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_upresources;
}

location /_vti_bin {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
}

location /_vti_inf.html* {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
}

location /documents {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /Documents {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /en/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
}

location /fr/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /FR/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /NL/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /ge/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
}

location /images {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/images;
}

location /nl/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
}

location /PublishingImages {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/PublishingImages;
}

location '/Style Library' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location /Style%20Library {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/$1;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be; 
}

location '/style library' {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be;
		proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /style%20library {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/$1;
		proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup-tb.allianz.be;
}

location /Fr/Images_ext_secure {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be/cp; 
}

location /Nl/Images_ext_secure {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup-tb.allianz.be/cp; 
} 
location /web/LVL3/Net4/Prevention/PreventionPolicyDoc {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/web/LVL3/Net4/Prevention/PreventionPolicyDoc;
} 
location /_common {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	#proxy_pass http://extranet-dup.mgm-dup.agf.be/_common;
	return 302 http://extranet-dup.mgm-dup.agf.be/_common;
}

location /_forms {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_forms;
}

location /crm/_forms {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/crm/_forms;
}

location /_grid {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_grid;
}

location /_imgs {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_imgs;
}

location /_static {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_static;
}

location /_static/_common {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/_static/_common;
}

location /crm {
	access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		#add_header Set-Cookie "INTAZBE=LeNZotKf0S6qG6GEHNUlVGPtOLZmpfYvw9jZwmINbQgEBHKbtCfVYc76xX8xbLXPMRN3WiY957/8ekkSxx/Nug==";
		add_header Access-Control-Allow-Origin *;
		add_header Access-Control-Allow-Headers Content-Length;
		add_header Access-Control-Expose-Headers Content-Length;
		add_header Sec-Fetch-Dest "";
		add_header Sec-Fetch-Mode "";
		add_header Sec-Fetch-Site "";
		
		proxy_request_buffering off;
		
		set $my_host "extranet-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://extranet-dup.mgm-dup.agf.be/crm;
		#proxy_redirect http://extranet-dup.mgm-dup.agf.be https://extranet-dut-tb.allianz.be;
}

location /crm/XRMServices {
	access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		#add_header Set-Cookie "INTAZBE=LeNZotKf0S6qG6GEHNUlVGPtOLZmpfYvw9jZwmINbQgEBHKbtCfVYc76xX8xbLXPMRN3WiY957/8ekkSxx/Nug==";
		add_header Access-Control-Allow-Origin *;
		add_header Access-Control-Allow-Headers Content-Length;
		add_header Access-Control-Expose-Headers Content-Length;
		add_header Sec-Fetch-Dest "";
		add_header Sec-Fetch-Mode "";
		add_header Sec-Fetch-Site "";
		
		proxy_request_buffering off;
		
		set $my_host "extranet-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://extranet-dup.mgm-dup.agf.be/crm;
		#proxy_redirect http://extranet-dup.mgm-dup.agf.be https://extranet-dut-tb.allianz.be;
}

location /CRMReports {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/CRMReports;
}

location /help {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/help;
}

location /Reserved.ReportViewerWebControl.axd* {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/Reserved.ReportViewerWebControl.axd*;
}

location /ScriptResource.axd* {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/scriptresource.axd*;
}

location /tools {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/tools;
}

location /webresource.axd* {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "extranet-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	return 302 http://extranet-dup.mgm-dup.agf.be/webresource.axd*;
}	

	access_log /opt/trustbuilder/gateway/instances/default/logs/extranet_access.log logstash;

	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
  error_page 404 =301 http://plnnet-dup.allianz.be/Plnnet/Nl/extranet/prolinknet/Paginas/PageNotFound.aspx;
	#add_header Strict-Transport-Security "max-age=31536000" always;
    #add_header Content-Security-Policy upgrade-insecure-requests;

	location /prolinksmemobile {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			set $my_host "prolinksmobile-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://prolinksmemobile-dup.allianz.be/;
	}
	
	location /helloworld {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			set $my_host "poctrustbuilder-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://poctrustbuilder-dup.allianz.be/;
	}
	
	
	location /broker {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			set $my_host "e1-absepp-uat.agf.be";
			proxy_set_header Host $my_host;
			proxy_pass http://e1-absepp-uat.agf.be:8083/broker;
	}
	
	location /ABSLogon {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			proxy_pass http://127.0.0.1:6080/ABSLogon;
	}
}
 
server {
	listen *:443 ssl;
	server_name trustb20-ext-dup.mgm-dup.agf.be;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
	access_log /opt/trustbuilder/gateway/instances/default/logs/kafka/kafka.log logstash;
	
	#proxy_set_header X-Forwarded-Proto $scheme;
	
	#location / {
	#	proxy_redirect https://$http_host$request_uri http://$http_host$request_uri;
	#}
	
	location /ae-cprework-notification-bfi {
    proxy_http_version 1.1;
    proxy_set_header Connection "";
 
		set $my_host "eu-uat-benelux.apis.allianz.com";
		proxy_set_header Host $my_host; 
		proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-cprework-notification-bfi;
	}
} 
server {
	listen *:443 ssl;

	server_name broker-predup.allianz.be;

      	access_log /opt/trustbuilder/gateway/instances/default/logs/broker-predup_access.log logstash;

      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

      	root                          /opt/trustbuilder/gateway/instances/default/docroots/root;

      	error_page 404                /404.html;
      	error_page 403                /403.html;
      	error_page 500 502 503 504    /500.html;

      	# Configuration of root vhost
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}
## Itsme (EBPCD)
location /uat/itsme/callback {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'c7e973cb-ee2d-4261-9fe3-b67a432cbbb5';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/2f9036fb-b8ec-40c5-8370-12e1aa6ea599 {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '9ab005c5-c89f-4338-a56e-67cd515fd34e';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /idhub/tb/showHeaders {
    access_by_lua_block {
        local header_map= {
                x_hdr_header="credential.attributes['digidentity|digidentityHeader']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend_predup/idhub/tb/showHeaders;
}
location /jwks {
    proxy_pass https://orchestrator_backend_predup/idhub/oidc/v1/jwks.json;
}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        #deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    proxy_pass https://orchestrator_backend_predup;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.16.35.27;  ## HYDRABNL11
    deny all;

    proxy_pass https://orchestrator_backend_predup;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend_predup/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend_predup/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend_predup;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend_predup/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    deny all;

    proxy_pass https://orchestrator_backend_predup/idhub/public/api/v1/idp/provisioning/reset;
}
}
 
server {
    listen *:443 ssl;
    server_name prolinknet-dup-tb.allianz.be;
	access_log /opt/trustbuilder/gateway/instances/default/logs/prolinknet-dup-tb_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
location /LVL3/TeamCoordinationCourtage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/TEAMCOORDINATIONCOURTAGE;
}

location /LVL3/TEAMCOORDINATIONCOURTAGE {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/TEAMCOORDINATIONCOURTAGE;
}

location /LVL3/ZVI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/ZVI;
}

location /LVL0/Z2K {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/Z2K;
}

location /LVLAS2/Z2K {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/Z2K;
}

location /LVLAS2/ZAD {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/ZAD;
}

location /LVLAS2/ZFC {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/ZFC;
}

location /LVL0/NET {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/NET;
}

location /LVL0/ZAD {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/ZAD;
}

location /LVL0/ZVI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/ZVI;
}

location /LVL3/Z2K/TRX/aaazntdisplog {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Z2K/TRX/aaazntdisplog;
}

location /LVL3/Z2K/TRX/aaazntprofile {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Z2K/TRX/aaazntprofile;
}

location /LVL3/NET/ZVG/DOWNLOAD {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZVG/DOWNLOAD;
}

location /LVL3/ZVG/BLUE3 {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/ZVG/BLUE3;
}

location /LVL3/NET/ZCO/Application/Flexiterme {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/Flexiterme;
}

location /LVL3/NET/ZCO/Application/FicheCourtierProto {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/FicheCourtierProto;
}

location /LVL3/NET/VIEF/Proposition {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET/VIEF/Proposition;
}

location /LVL3/QuoteProlinkNet/CarPlan {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://carplan-dup.agf.be/LVL3/QuoteProlinkNet/CarPlan;
} 
location /BI/ {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}

  add_header Access-Control-Allow-Origin *;
  add_header Sec-Fetch-Site "cross-site";
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
location /BI/ps/login {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
location /BI/skins/corporate/portal/ {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
 
location /LVL3/NET4/Common/QuotationTool {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	#add_header Set-Cookie "ASWEBAZBE=pNHfw+j8LBV3r6FHNjuW42BPwSxqRZkM4iwa4eTZs2Kes8+QB5ycgLnBwCYKc5OTwYeOBgyA4qLZYTjPJqrMqA==";
	proxy_set_header Cookie "$http_cookieASWEBAZBE=pNHfw+j8LBV3r6FHNjuW42BPwSxqRZkM4iwa4eTZs2Kes8+QB5ycgLnBwCYKc5OTwYeOBgyA4qLZYTjPJqrMqA==";
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /lvl3/NET4/Common/QuotationTool {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	#add_header Set-Cookie "ASWEBAZBE=pNHfw+j8LBV3r6FHNjuW42BPwSxqRZkM4iwa4eTZs2Kes8+QB5ycgLnBwCYKc5OTwYeOBgyA4qLZYTjPJqrMqA==";
	proxy_set_header Cookie "$http_cookieASWEBAZBE=pNHfw+j8LBV3r6FHNjuW42BPwSxqRZkM4iwa4eTZs2Kes8+QB5ycgLnBwCYKc5OTwYeOBgyA4qLZYTjPJqrMqA==";
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /lvl3/Net4/Common/QuotationTool {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	#add_header Set-Cookie "ASWEBAZBE=pNHfw+j8LBV3r6FHNjuW42BPwSxqRZkM4iwa4eTZs2Kes8+QB5ycgLnBwCYKc5OTwYeOBgyA4qLZYTjPJqrMqA==";
	proxy_set_header Cookie "$http_cookieASWEBAZBE=pNHfw+j8LBV3r6FHNjuW42BPwSxqRZkM4iwa4eTZs2Kes8+QB5ycgLnBwCYKc5OTwYeOBgyA4qLZYTjPJqrMqA==";
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}
 
    location /LVL3/EMAC/APPS/WhosWhoWebSite {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['portima|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/EMAC/APPS/WhosWhoWebSite;
    }

 
location /cp/ {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}

			   # sub_filter_once off;
			   # sub_filter 'src="/CP' 'src="';
			   # sub_filter 'type="text/css" href="/CP' 'type="text/css" href="';

	sub_filter_once off;
sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';

			set $my_host "cp-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://cp-dup.allianz.be/;
			proxy_redirect http://cp-dup.allianz.be https://prolinknet-dup-tb.allianz.be; 
	}

location /CP/ {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']",
			_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
		}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}

	# sub_filter_once off;
	# sub_filter 'src="/CP' 'src="';
	# sub_filter 'type="text/css" href="/CP' 'type="text/css" href="';

	sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be/;
	proxy_redirect http://cp-dup.allianz.be https://prolinknet-dup-tb.allianz.be; 
} 
location /ebonline/ {
	access_by_lua_block {
	local header_map = {
		Authorization="credential.attributes['common|authz_header']",
	}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
	require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "ebonline-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /EBonline/ {
	access_by_lua_block {
	local header_map = {
		Authorization="credential.attributes['common|authz_header']",
		x_tb_session   = ''
	}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
	require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "ebonline-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
} 
location /Fr/extranet/prolinknet {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
			
	return 302 https://prolinknet-dup-tb.allianz.be/plnnet/Fr/extranet/prolinknet/Pages/default.aspx;
}

location /Nl/extranet/prolinknet {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
		
	return 302 https://prolinknet-dup-tb.allianz.be/plnnet/Nl/extranet/prolinknet/Paginas/default.aspx;
}

location /fr/extranet/prolinknet {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
			
	return 302 https://prolinknet-dup-tb.allianz.be/plnnet/Fr/extranet/prolinknet/Pages/default.aspx;
}

location /nl/extranet/prolinknet {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
		
	return 302 https://prolinknet-dup-tb.allianz.be/plnnet/Nl/extranet/prolinknet/Paginas/default.aspx;
}

location /plnnet/ {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be/plnnet';
	sub_filter 'plnnet/_catalogs' '/_catalogs';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be/plnnet; 
}

location /PlnNet/ {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	sub_filter_once off;
	sub_filter 'plnnet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be/plnnet';
	sub_filter 'plnnet/_catalogs' '/_catalogs';
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be/plnnet; 
} 
location /lvl3/NET2/ProLinkNG {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be';
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET2/ProLinkNG;
}

location /LVL3/NET2/ProlinkNG {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be';
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET2/ProLinkNG;
}

location /lvl3/net2/prolinkng {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be';
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET2/ProLinkNG;
}

#ProLinkNG - Claims -> TEST VDK
location /lvl3/net2/prolinkng/claims {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
								x_tb_session  = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be';
  
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET2/ProLinkNG/Claims;   
}

location /lvl3/NET2/ProLinkNG/Claims {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
								x_tb_session  = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknet-dup.allianz.be' 'prolinknet-dup-tb.allianz.be';
  
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET2/ProLinkNG/Claims;   
}
 
location /lvl3/NET4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET4/Brokerage/PortfolioStatement;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /LVL3/NET4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET4/Brokerage/PortfolioStatement;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /lvl3/Net4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET4/Brokerage/PortfolioStatement;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}
 
location /APPS {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://prolinknet-dup-tb.allianz.be;
}

location /Apps {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://prolinknet-dup-tb.allianz.be;
}

location /apps {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://prolinknet-dup-tb.allianz.be;
} 
location /_layouts {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_layouts;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /_catalogs {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_catalogs;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be; 
}

location /_upresources {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_upresources;
}

location /_vti_bin {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
}

location /_vti_inf.html* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
}

location /documents {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /en/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
}

location /fr/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /ge/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
}

location /images {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/images;
}

location /nl/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
}

location /PublishingImages {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be;
}

location /Style%20Library {
			access_by_lua_block {
				local header_map= {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
	
	set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/$1;
		proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be; 
	}

location '/Style Library' {
			access_by_lua_block {
					local header_map= {
							Authorization="credential.attributes['common|authz_header']",
											x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}

			set $my_host "plnnet-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://plnnet-dup.allianz.be;
			proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
	}

location /style%20library {
			access_by_lua_block {
					local header_map= {
							Authorization="credential.attributes['common|authz_header']",
											x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}

			set $my_host "plnnet-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://plnnet-dup.allianz.be/$1;
			proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
	}
	
location '/style library' {
			access_by_lua_block {
					local header_map= {
							Authorization="credential.attributes['common|authz_header']",
											x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}

			set $my_host "plnnet-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://plnnet-dup.allianz.be/$1;
			proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
	} 
location /LVL3/NET4/Life/il/lisa {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
}

location /lvl3/NET4/Life/IL/LISA {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
}

location /lvl3/Net4/Life/IL/LISA {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
}

location /LVL3/NET4/Life/il/LISA {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
} 
location /LVL3/NET/Brokerage/PortFolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/PortFolioStatement;
}

location /LVL3/NET/Brokerage/portfoliostatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/PortFolioStatement;
}

location /portfoliostatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/PortFolioStatement;
}

location /LVL3/NET/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/BrokerAccount;
}

location /lvl3/NET4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/BrokerAccount;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /lvl3/Net4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/Net4/Brokerage/BrokerAccount;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
}

location /LVL3/Net2/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/LVL3/Net2/Brokerage;
}

location /lvl3/net4/brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/net4/Brokerage;
}

location /lvl3/net4/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/net4/Brokerage;
}

location /lvl3/NET4/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/net4/Brokerage;
}

location /lvl3/NET4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/CommercialReporting;
}

location /LVL3/NET4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/CommercialReporting;
}

location /lvl3/net4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/CommercialReporting;
} 
location /_common {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_common;
}
location /_forms {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_forms;
}
location /_grid {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_grid;
}
location /_imgs {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_imgs;
}
location /_static {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_static;
}
location /crm {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/crm;
}
location /CRMReports {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/CRMReports;
}
location /help {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/help;
}
location /Reserved.ReportViewerWebControl.axd* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/Reserved.ReportViewerWebControl.axd*;
}
location /ScriptResource.axd* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/scriptresource.axd*;
}
location /tools {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_pass http://climb-uat.allianz.be/tools;
}
location /WebResource.axd* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/webresource.axd*;
}    
    #VDK TEST
    location /vdk_login {
    access_by_lua_block {
        local header_map= {
                x_hdr_header="credential.attributes['digidentity|digidentityHeader']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
		}
		proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
    }
     
    #EB
    location /LVL3/EMAC/APPS/EBWebsiteSecure {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/EMAC/APPS/EBWebsiteSecure;
    }
	
	location /lvl3/emac/apps/ebwebsitesecure {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/EMAC/APPS/EBWebsiteSecure;
    }
	
	location /prolinksmemobile {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://prolinksmemobile-dup.allianz.be/;
    }
	
	location /indisponible {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://indisponible:8080/indisponible;
    }
}
 
server {
	listen *:443 ssl; 
	server_name mira-int.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/mira-int.allianz.nl_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
        # Internals only
        #allow 194.127.26.64/26;
        #allow 194.127.24.64/26;
        #deny all;

		set $my_host "mira-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://mira-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   }
} 
server {
	listen *:443 ssl; 
	server_name my-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/my-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
		
		#set $my_host "up-claimstracker-fe-uat-azbnl-btu-up.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
        #proxy_pass http://up-claimstracker-fe-uat-azbnl-btu-up.apps.tools.adp.allianz;
		
		set $my_host "customerportal-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://customerportal-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
			
	}
	#redirect logic to short the end user url
   location /register {
		
		#return 302 https://api-uat.allianz.nl/ae-cp-bff/login/register?method=register&connection_code=$arg_cc;
		return 302 https://api-uat.allianz.nl/ae-cp-bff/login/register?method=register&connection_code=$arg_cc&usertype=$arg_usertype;
   }
   
    location /login {
				
		return 302 https://api-uat.allianz.nl/ae-cp-bff/login;
   }

}
 
server {
	listen *:443 ssl;
	server_name plp-tst.allianz.be;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}
 
	access_log /opt/trustbuilder/gateway/instances/default/logs/plp-tst/plp-tst.log logstash;
	
 
 location / {
		set $my_host "plp-brokerportal-fe-tst.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://plp-brokerportal-fe-tst.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
    #proxy_redirect https://plp-brokerportal-fe-tst.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plp-dup.allianz.be;
	}
 
}
 
server {
        listen *:443 ssl;
        server_name broker-dup.allianz.be;

 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers on;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '3600';
#set $session_timeout                '360';
#set $session_inactivity_timeout     '60';

set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
      location /newprolinkretail {
          access_by_lua_block {
              local header_map= {
                  Authorization="credential.attributes['portima|authz_header']",
                  SM_USER="credential.attributes['portima|SM_USER']",
                  AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
                  username="credential.attributes['common|username']",
                  password="credential.attributes['common|password']",
              }
              require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
              require("trustbuilder-gateway.auth_interface")()
          }
          set $my_host broker-dup.allianz.be;
          proxy_set_header Host $my_host;
          proxy_pass http://e1-2spdfe-uat.agf.be:8081/newprolinkretail;
          proxy_redirect http://e1-2spdfe-uat.agf.be:8081/ https://broker-dup.allianz.be/newprolinkretail;
      }
      location /apia {
          access_by_lua_block {
              local header_map= {
                  Authorization="credential.attributes['portima|authz_header']",
                  SM_USER="credential.attributes['portima|SM_USER']",
                  AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
                  username="credential.attributes['idp|allianz_subject']",
                  password="credential.attributes['common|password']",
              }
              require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
              require("trustbuilder-gateway.auth_interface")()
          }
          set $my_host broker-dup.allianz.be;
          proxy_set_header Host $my_host;
          proxy_pass http://e1-2spdfe-uat.agf.be:8087/apia;
          proxy_redirect http://e1-2spdfe-uat.agf.be:8087/ https://broker-dup.allianz.be/apia;
      }

 
    location /plnnet {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/;
        proxy_redirect http://plnnet-dup.allianz.be/ https://broker-dup.allianz.be/plnnet;
    }
    
    
    location /indisponible {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://indisponible:8080/indisponible;
    }
    location /APPS {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/APPS_digipass;
    }
    location /_layouts {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/_layouts;
    }
    location /_upresources {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/_upresources;
    }
    location /_vti_bin {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
    }
    location /_vti_inf.html* {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
    }
    location /documents {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/documents;
    }
    location /en/ext_public {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
    }
    location /fr/ext_public {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
    }
    location /ge/ext_public {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
    }
    location /images {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/images;
    }
    location /nl/ext_public {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
    }
    location /PublishingImages {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be;
    }
    

    location '/Style Library'{
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be;
    }
   
    location /Style%20Library{
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://plnnet-dup.allianz.be;
    }
 
    location /cp {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        proxy_pass http://cp-dup.allianz.be/;
    }

    
    location /prolinksmemobile {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://prolinksmemobile-dup.allianz.be/;
    }
    location /lvl3/NET2/ProLinkNG {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
    }
    location /LVL3/ZVI {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/ZVI;
    }
    location /LVL0/Z2K {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/Z2K;
    }
    location /LVLAS2/Z2K {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/Z2K;
    }
    location /LVLAS2/ZAD {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/ZAD;
    }
    location /LVLAS2/ZFC {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/ZFC;
    }
    location /LVL0/NET {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/NET;
    }
    location /LVL0/ZAD {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/ZAD;
    }
    location /LVL0/ZVI {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/ZVI;
    }
    location /LVL3/TEAMCOORDINATIONCOURTAGE {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/TEAMCOORDINATIONCOURTAGE;
    }
    location /LVL3/Z2K/TRX/aaazntdisplog {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Z2K/TRX/aaazntdisplog;
    }
    location /LVL3/Z2K/TRX/aaazntprofile {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Z2K/TRX/aaazntprofile;
    }
    location /LVL3/Net2/Brokerage {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Net2/Brokerage;
    }
    location /lvl3/net4/Brokerage {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
    }

    location /LVL3/NET/ZVG/DOWNLOAD {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZVG/DOWNLOAD;
    }
    location /LVL3/ZVG/BLUE3 {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/ZVG/BLUE3;
    }
    location /LVL3/NET/ZCO/Application/Flexiterme {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/Flexiterme;
    }
    location /LVL3/NET/ZCO/Application/FicheCourtierProto {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/FicheCourtierProto;
    }
    location /LVL3/NET/VIEF/Proposition {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET/VIEF/Proposition;
    }
    location /LVL3/EMAC/APPS/EBWebsiteSecure {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/EMAC/APPS/EBWebsiteSecure;
    }
    location /LVL3/NET/Brokerage/PortFolioStatement {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/Brokerage/PortFolioStatement;
    }
    location /LVL3/NET/Brokerage/BrokerAccount {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/Brokerage/BrokerAccount;
    }
    location /BI {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://cognosui-fez-dup.allianz.be/BI;
    }
    location /LVL3/NET4/Common/QuotationTool {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Common/QuotationTool;
    }
    location /LVL3/NET4/Life/il/lisa {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
    }
    location /_common {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/_common;
    }
    location /_forms {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/_forms;
    }
    location /_grid {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/_grid;
    }
    location /_imgs {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/_imgs;
    }
    location /_static {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/_static;
    }
    location /crm {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/crm;
    }
    location /CRMReports {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/CRMReports;
    }
    location /help {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/help;
    }
    location /Reserved.ReportViewerWebControl.axd* {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/Reserved.ReportViewerWebControl.axd*;
    }
    location /scriptresource.axd* {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/scriptresource.axd*;
    }
    location /tools {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        proxy_pass http://climb-uat.allianz.be/tools;
    }
    location /webresource.axd* {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://climb-uat.allianz.be/webresource.axd*;
    }
    location /LVL3/QuoteProlinkNet/CarPlan {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['digipass|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://carplan-dup.agf.be/LVL3/QuoteProlinkNet/CarPlan;
    }
 
 location /lvl3/EMAC/Apps/WhosWhoWebSite {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['digipass|SM_USER']",
                AgfAuthentication="credential.attributes['digipass|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/EMAC/Apps/WhosWhoWebSite;
    }
}
 
server {
    listen *:443 ssl;
    server_name prolinknet-dup.allianz.be;
	access_log /opt/trustbuilder/gateway/instances/default/logs/prolinknet-dup_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $domain          				'.allianz.be';
if ($http_host ~* 'allianz.nl'){
	set $domain          				'.allianz.nl';
}
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
location /LVL3/TeamCoordinationCourtage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/TEAMCOORDINATIONCOURTAGE;
}

location /LVL3/TEAMCOORDINATIONCOURTAGE {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/TEAMCOORDINATIONCOURTAGE;
}

location /LVL3/ZVI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/ZVI;
}

location /LVL0/Z2K {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/Z2K;
}

location /LVLAS2/Z2K {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/Z2K;
}

location /LVLAS2/ZAD {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/ZAD;
}

location /LVLAS2/ZFC {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVLAS2/ZFC;
}

location /LVL0/NET {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/NET;
}

location /LVL0/ZAD {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/ZAD;
}

location /LVL0/ZVI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL0/ZVI;
}

location /LVL3/Z2K/TRX/aaazntdisplog {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Z2K/TRX/aaazntdisplog;
}

location /LVL3/Z2K/TRX/aaazntprofile {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/Z2K/TRX/aaazntprofile;
}

location /LVL3/NET/ZVG/DOWNLOAD {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZVG/DOWNLOAD;
}

location /LVL3/ZVG/BLUE3 {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/ZVG/BLUE3;
}

location /LVL3/NET/ZCO/Application/Flexiterme {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/Flexiterme;
}

location /LVL3/NET/ZCO/Application/FicheCourtierProto {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/FicheCourtierProto;
}

location /LVL3/NET/VIEF/Proposition {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET/VIEF/Proposition;
}

location /LVL3/QuoteProlinkNet/CarPlan {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://carplan-dup.agf.be/LVL3/QuoteProlinkNet/CarPlan;
} 
location /BI/ {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}

  add_header Access-Control-Allow-Origin *;
  add_header Sec-Fetch-Site "cross-site";
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
location /BI/ps/login {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
location /BI/skins/corporate/portal/ {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}

location /bi/ {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}

  add_header Access-Control-Allow-Origin *;
  add_header Sec-Fetch-Site "cross-site";
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
location /bi/ps/login {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}
location /bi/skins/corporate/portal/ {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}

#New Cognos 10 on Windows 2019
	location /ibmcognos {
		access_by_lua_block {
  		local header_map = {
  			Authorization="credential.attributes['common|authz_header']", 
  			x_tb_session   = ''
  		}
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
		set $my_host "bapps1920-ext-uat.agf.be";
		proxy_set_header Host $my_host; 
    proxy_pass http://bapps1920-ext-uat.agf.be;
    proxy_redirect http://bapps1920-ext-uat.agf.be https://prolinknet-dup.allianz.be;
	} 
location /LVL3/NET4/Common/QuotationTool/Platform/UI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	
	set $my_host "prolinknet-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass  http://prolinknethc-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknethc-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /lvl3/NET4/Common/QuotationTool/Platform/UI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknethc-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /lvl3/Net4/Common/QuotationTool/Platform/UI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknethc-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /lvl3/net4/Common/QuotationTool/Platform/UI {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/LVL3/NET4/Common/QuotationTool/Platform/UI;
	proxy_redirect http://prolinknethc-dup.allianz.be https://prolinknet-dup.allianz.be;
} 
    location /LVL3/EMAC/APPS/WhosWhoWebSite {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['portima|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/EMAC/APPS/WhosWhoWebSite;
    }

 
location /cp/ {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}

			   # sub_filter_once off;
			   # sub_filter 'src="/CP' 'src="';
			   # sub_filter 'type="text/css" href="/CP' 'type="text/css" href="';

	sub_filter_once off;
sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';

			set $my_host "cp-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://cp-dup.allianz.be/;
			proxy_redirect http://cp-dup.allianz.be https://prolinknet-dup.allianz.be; 
	}

location /CP/ {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']",
			_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
		}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}

	# sub_filter_once off;
	# sub_filter 'src="/CP' 'src="';
	# sub_filter 'type="text/css" href="/CP' 'type="text/css" href="';

	sub_filter 'P81dl8UGtPQ9Qt8jT83IDdCRZ5F2af_j1SHQ2ux0rx7YSyA4LwNR_bIPbU_RMWaVwMvzTyn106xZZAKiN2_HE1PqtOu4bD-yUq8DZ6RSFJYTi3fxWym-yZVi5dSd11fdT212neqM2ayrCNjqQYApyinjwfI1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';

	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be/;
	proxy_redirect http://cp-dup.allianz.be https://prolinknet-dup.allianz.be; 
} 
location /ebonline/ {
	access_by_lua_block {
	local header_map = {
		Authorization="credential.attributes['common|authz_header']",
	}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
	require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "ebonline-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /EBonline/ {
	access_by_lua_block {
	local header_map = {
		Authorization="credential.attributes['common|authz_header']",
		x_tb_session   = ''
	}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
	require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "ebonline-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://ebonline-dup.allianz.be/;
	proxy_redirect http://ebonline-dup.allianz.be https://prolinknet-dup.allianz.be;
} 
location /Fr/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Nl/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /fr/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /nl/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /plnnet/ {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /PlnNet/ {
	return 302 https://apps-dup.allianz.be/MyAllianz; 
} 
location /lvl3/NET2/ProLinkNG {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknethc-dup.allianz.be' 'prolinknet-dup.allianz.be';
	
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/lvl3/NET2/ProLinkNG;
}

location /LVL3/NET2/ProlinkNG {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknethc-dup.allianz.be' 'prolinknet-dup.allianz.be';
	
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/lvl3/NET2/ProLinkNG;
}

location /lvl3/net2/prolinkng {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknethc-dup.allianz.be' 'prolinknet-dup.allianz.be';
	
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/lvl3/NET2/ProLinkNG;
}

#ProLinkNG - Claims -> TEST VDK
location /lvl3/net2/prolinkng/claims {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
								x_tb_session  = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknethc-dup.allianz.be' 'prolinknet-dup.allianz.be';
  
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/lvl3/NET2/ProLinkNG/Claims;   
}

location /lvl3/NET2/ProLinkNG/Claims {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
								x_tb_session  = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'prolinknethc-dup.allianz.be' 'prolinknet-dup.allianz.be';
  
	set $my_host "prolinknethc-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknethc-dup.allianz.be/lvl3/NET2/ProLinkNG/Claims;   
}
 
location /lvl3/NET4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET4/Brokerage/PortfolioStatement;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /LVL3/NET4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET4/Brokerage/PortfolioStatement;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /lvl3/Net4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "prolinknet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://prolinknet-dup.allianz.be/lvl3/NET4/Brokerage/PortfolioStatement;
	proxy_redirect http://prolinknet-dup.allianz.be https://prolinknet-dup.allianz.be;
}
 
location /APPS {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
}

location /Apps {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
}

location /apps {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
}

location /APPS_Portima {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/APPS_Portima;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
}

# this is new location to point new server and normally shoud work but if this will not work enable to below location 
#location /apps/Brokerage/GreenCard {
#	access_by_lua_block {
#		local header_map= {
#			Authorization="credential.attributes['common|authz_header']",
#			SM_USER="credential.attributes['portima|SM_USER']",
#			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
#		}
#		require("trustbuilder-gateway.protect").web_app(header_map)
#	}
#	header_filter_by_lua_block {
#		require("trustbuilder-gateway.auth_interface")()
#	}
#	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
#	proxy_set_header Host $my_host;
#	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard;
#	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
#}
# this location can be enaled if green card is not working from my broker port
location ~* ^/apps/Brokerage/GreenCard {
		access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
		set $my_host "prolinknet-dup.allianz.be";
		proxy_set_header Host $my_host;
		return 302 https://prolinknet-dup.allianz.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
 
location /_layouts {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_layouts;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be;
}

location /_catalogs {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_catalogs;
	proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be; 
}

location /_upresources {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_upresources;
}

location /_vti_bin {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
}

location /_vti_inf.html* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
}

location /documents {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /en/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
}

location /fr/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /ge/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
}

location /images {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/images;
}

location /nl/ext_public {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
}

location /PublishingImages {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be;
}

location /Style%20Library {
			access_by_lua_block {
				local header_map= {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
	
	set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/$1;
		proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be; 
	}

location '/Style Library' {
			access_by_lua_block {
					local header_map= {
							Authorization="credential.attributes['common|authz_header']",
											x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}

			set $my_host "plnnet-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://plnnet-dup.allianz.be;
			proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be;
	}

location /style%20library {
			access_by_lua_block {
					local header_map= {
							Authorization="credential.attributes['common|authz_header']",
											x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}

			set $my_host "plnnet-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://plnnet-dup.allianz.be/$1;
			proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be;
	}
	
location '/style library' {
			access_by_lua_block {
					local header_map= {
							Authorization="credential.attributes['common|authz_header']",
											x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}

			set $my_host "plnnet-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://plnnet-dup.allianz.be/$1;
			proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be;
	} 
location /LVL3/NET4/Life/il/lisa {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
}

location /lvl3/NET4/Life/IL/LISA {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
}

location /lvl3/Net4/Life/IL/LISA {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
}

location /LVL3/NET4/Life/il/LISA {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
} 
location /LVL3/NET/Brokerage/PortFolioStatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/PortFolioStatement;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET/Brokerage/PortFolioStatement;
}

location /LVL3/NET/Brokerage/portfoliostatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/PortFolioStatement;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET/Brokerage/PortFolioStatement;
}

location /portfoliostatement {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/PortFolioStatement;
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET/Brokerage/PortFolioStatement;
}

location /LVL3/NET/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/LVL3/NET/Brokerage/BrokerAccount;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET/Brokerage/BrokerAccount;
}

location /lvl3/NET4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/BrokerAccount;
	#proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/Net4/Brokerage/BrokerAccount;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
	
}

location /lvl3/Net4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/Net4/Brokerage/BrokerAccount;
	#proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup.allianz.be;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/Net4/Brokerage/BrokerAccount;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://prolinknet-dup.allianz.be;
}

location /LVL3/Net2/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_http_version 1.1;
	proxy_set_header Connection "";
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/NET2/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_http_version 1.1;
	proxy_set_header Connection "";
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/net4/brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/net4/Brokerage;
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/net4/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/net4/Brokerage;
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/NET4/Brokerage {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/net4/Brokerage;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
	
}

location /lvl3/NET4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/CommercialReporting;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET4/Brokerage/CommercialReporting;
}

location /LVL3/NET4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/CommercialReporting;
	
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET4/Brokerage/CommercialReporting;
}

location /lvl3/net4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	#set $my_host "plnnet-dup.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass http://plnnet-dup.allianz.be/lvl3/NET4/Brokerage/CommercialReporting;
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET4/Brokerage/CommercialReporting;
}

 
location /_common {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_common;
}
location /_forms {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_forms;
}
location /_grid {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_grid;
}
location /_imgs {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_imgs;
}
location /_static {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_static;
}
location /crm {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/crm;
}
location /CRMReports {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/CRMReports;
}
location /help {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/help;
}
location /Reserved.ReportViewerWebControl.axd* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/Reserved.ReportViewerWebControl.axd*;
}
location /ScriptResource.axd* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/scriptresource.axd*;
}
location /tools {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']"
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	proxy_pass http://climb-uat.allianz.be/tools;
}
location /WebResource.axd* {
	access_by_lua_block {
		local header_map= {
			Authorization="credential.attributes['common|authz_header']",
			SM_USER="credential.attributes['portima|SM_USER']",
			AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/webresource.axd*;
}	proxy_cookie_path ~^(.+)$ "$1; domain=.allianz.be";
    
    #VDK TEST
    location /vdk_login {
    access_by_lua_block {
        local header_map= {
                x_hdr_header="credential.attributes['digidentity|digidentityHeader']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
		}
		proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
    }
     
    #EB
    location /LVL3/EMAC/APPS/EBWebsiteSecure {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/EMAC/APPS/EBWebsiteSecure;
    }
	
	location /lvl3/emac/apps/ebwebsitesecure {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/EMAC/APPS/EBWebsiteSecure;
    }
	
	location /prolinksmemobile {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://prolinksmemobile-dup.allianz.be/;
    }
	
	location /indisponible {
        access_by_lua_block {
            local header_map= {
                Authorization="credential.attributes['common|authz_header']",
                SM_USER="credential.attributes['portima|SM_USER']",
                AgfAuthentication="credential.attributes['portima|AgfAuthentication']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "plnnet-dup.allianz.be";
        proxy_set_header Host $my_host;
        proxy_pass http://indisponible:8080/indisponible;
    }
}
 
server {
	listen *:443 ssl; 
	server_name schadestatus-int.allianz.nl;
	
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/schadestatus-int_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
		
		set $my_host "up-claimstracker-fe-azbnl-btu-up.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://up-claimstracker-fe-azbnl-btu-up.apps.tools.adp.allianz;
                   
	}
	#redirect logic to short the end user url
   location /register {
		#https://eu-int-benelux.apis.allianz/ae-ct-bff	
		#proxy_pass https://eu-int-benelux.apis.allianz/ae-ct-bff/login/register?method=register&connection_code=$arg_cc;
		proxy_pass https://eu-int-benelux.apis.allianz/ae-ct-bff/login/register?method=register&connection_code=$arg_cc&usertype=$arg_usertype;
   }
   
    location /login {
				
		proxy_pass https://eu-int-benelux.apis.allianz/ae-ct-bff/login;
   }

    location /ae-ct-bff {

		proxy_pass https://eu-int-benelux.apis.allianz/ae-ct-bff;
    }

   
}
 
server {
    listen *:443 ssl;
    server_name brokernl-dup.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';


    location /absr3 {
         access_by_lua_block {
            local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
		proxy_set_header Referer "";
        #8081: maintenance branch    8083: project branch    8082: CU branch
        proxy_pass http://e1-2spdfe1-uat.agf.be:8082/absr3;  
    }

    location /maintenance {
         access_by_lua_block {
            local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
                proxy_set_header Referer "";
        #8081: maintenance branch    8083: project branch    8082: CU branch
        proxy_pass http://e1-2spdfe1-uat.agf.be:8081/absr3;
    }
 
    location /project {
         access_by_lua_block {
            local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
                proxy_set_header Referer "";
        #8081: maintenance branch    8083: project branch    8082: CU branch
        proxy_pass http://e1-2spdfe1-uat.agf.be:8083/absr3;
    }


    location /cu {
         access_by_lua_block {
            local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
                proxy_set_header Referer "";
        #8081: maintenance branch    8083: project branch    8082: CU branch
        proxy_pass http://e1-2spdfe1-uat.agf.be:8082/absr3;
    }

 
    #BFF maintenance branch
    location /apia {

     proxy_set_header Origin https://brokernl-dup.allianz.be;
     proxy_hide_header Access-Control-Allow-Origin;
     add_header Access-Control-Allow-Origin $http_origin;

    access_by_lua_block {
       local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        } 
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
		proxy_set_header Referer "";

        proxy_pass http://e1-2spdfe1-uat.agf.be:8087/apia;
    }

    #BFF CU branch
    location /apib {

     proxy_set_header Origin https://brokernl-dup.allianz.be;
     proxy_hide_header Access-Control-Allow-Origin;
     add_header Access-Control-Allow-Origin $http_origin;

    access_by_lua_block {
       local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
                proxy_set_header Referer "";

        proxy_pass http://e1-2spdfe1-uat.agf.be:8087/apib;
    }


   #BFF Project branch
    location /apic {

     proxy_set_header Origin https://brokernl-dup.allianz.be;
     proxy_hide_header Access-Control-Allow-Origin;
     add_header Access-Control-Allow-Origin $http_origin;

    access_by_lua_block {
       local header_map= {
                username="credential.attributes['common|username']",
                password="credential.attributes['common|password']",
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
        }
        set $my_host "brokernl-dup.allianz.be";
        proxy_set_header Host $my_host;
                proxy_set_header Referer "";

        proxy_pass http://e1-2spdfe1-uat.agf.be:8087/apic;
    }


   # FE ABS bff gateway auth. (TB-GW -> apigee <-> TB <-> digidentity)
   #location /apia/security/auth {
  #
   #             set $my_host "eu-uat-benelux.apis.allianz.com";
   #             proxy_set_header Host $my_host;
   #             proxy_pass  https://eu-uat-benelux.apis.allianz.com/abs/login;

   #}
   
	#digidentityWS
	location /digidentityWS/eWS/user/webUserManagement {
	    #satisfy any;
	    auth_basic "Anonymous authentication";
	    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";
	
	    #auth_request /tb_int_auth;
	    #auth_request_set $user $upstream_http_x_forwarded_user;

	    #proxy_set_header Host "e1-absesb-uat.agf.be";
	    proxy_set_header Host $host;
	    proxy_pass http://e1-absesb1-uat.agf.be:8084/eWS/user/webUserManagement/WebuserManagementService;
	    proxy_ssl_verify off;
	}

	location /digidentity {

	proxy_pass http://e1-absesb1-uat.agf.be:8084/eWS/user/webUserManagement/WebuserManagementService;

	}

 
}
 
server {
        listen *:443 ssl; 
        server_name vdk-dup.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}

      	access_log /opt/trustbuilder/gateway/instances/default/logs/vdk-dup_access.log logstash;
      	root /opt/trustbuilder/gateway/instances/default/docroots/root;
       
       #ProLinkNG
		   location /prolinkng {
          access_by_lua_block {
                        local header_map = {
                                Authorization = "credential.attributes['common|authz_header']",
								                x_tb_session  = ''
                        }
                        require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
          }
		  
		  sub_filter_once off;
		  sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		  
		  proxy_connect_timeout       600;
		  proxy_send_timeout          600;
		  proxy_read_timeout          600;
		  send_timeout                600;
          
          set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
          proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/CivilLiability;
          proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;    
       }
	   
	location /lvl3/NET2/ProLinkNG {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	
	location /LVL3/NET2/ProLinkNG {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
		
		sub_filter_once off;
		sub_filter 'fwkdcc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
		proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/net2/prolinkng {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
		}
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	  
	#ProLinkNG - Claims -> TEST VDK
	location /lvl3/net2/prolinkng/claims {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Claims;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;		
	}

	location /lvl3/NET2/ProLinkNG/Claims {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Claims;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;   
	}
       
       #ProLinkNG - CivilLiability
		   location /lvl3/NET2/ProLinkNG/CivilLiability {
          access_by_lua_block {
                        local header_map = {
                                Authorization = "credential.attributes['common|authz_header']",
								                x_tb_session  = ''
                        }
                        require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
          }
		  
		  sub_filter_once off;
		  sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		  
		  proxy_connect_timeout       600;
		  proxy_send_timeout          600;
		  proxy_read_timeout          600;
		  send_timeout                600;
          
          set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
          proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/CivilLiability;
          proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;    
       }
       #ProLinkNG - Property
		   location /lvl3/NET2/ProLinkNG/Property {
          access_by_lua_block {
                        local header_map = {
                                Authorization = "credential.attributes['common|authz_header']",
								                x_tb_session  = ''
                        }
                        require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
          }
		  
		  sub_filter_once off;
		  sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		  
		  proxy_connect_timeout       600;
		  proxy_send_timeout          600;
		  proxy_read_timeout          600;
		  send_timeout                600;
          
          set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
          proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Property;
          proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;    
       }
	   
	    location /lvl3/net2/prolinkng/Property {
          access_by_lua_block {
                        local header_map = {
                                Authorization = "credential.attributes['common|authz_header']",
								                x_tb_session  = ''
                        }
                        require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
          }
		  
		  sub_filter_once off;
		  sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		  
		  proxy_connect_timeout       600;
		  proxy_send_timeout          600;
		  proxy_read_timeout          600;
		  send_timeout                600;
          
          set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
          proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Property;
          proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;    
       }
	   
	location /lvl3/net2/prolinkng/Vehicle {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net2/prolinkng/Vehicle;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	
	location /lvl3/NET2/ProLinkNG/Vehicle {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net2/prolinkng/Vehicle;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	
	location /lvl3/net2/Brokerage/GreenCard {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	
	location /lvl3/NET2/Brokerage/GreenCard {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/NET2/Brokerage/GreenCard/Create {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/Create;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/net2/Brokerage/GreenCard/Create {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/Create;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/net2/Brokerage/GreenCard/UI/WebViews/assets {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}

		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;

		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/assets;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/NET2/Brokerage/GreenCard/UI/WebViews/assets {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
		
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/assets;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard/CreateGreenCardForExternalUse {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
		
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard/CreateGreenCardForExternalUse;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}

	location /lvl3/net2/Brokerage/GreenCard/UI/WebViews/GreenCard/CreateGreenCardForExternalUse {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
		
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard/CreateGreenCardForExternalUse;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	
	location /lvl3/net2/prolinkng/FacilityProgram {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net2/prolinkng/FacilityProgram;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
	
	location /lvl3/NET2/ProLinkNG/FacilityProgram {
		access_by_lua_block {
			local header_map = {
				Authorization = "credential.attributes['common|authz_header']",
									x_tb_session  = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
			require("trustbuilder-gateway.auth_interface")()
		}
		
		sub_filter_once off;
		sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net2/prolinkng/FacilityProgram;
		proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://vdk-dup.allianz.be;
	}
 
  #RestAPI
  location /VDKRestApi {
    #VDK IP Ranges
    allow 213.211.131.160/28;
    allow 109.236.128.144/28;
    allow 79.132.240.144/28;
    allow 213.211.141.112/28;
    allow 84.199.96.16/28;
    allow 84.198.220.160/28;
    allow 212.123.14.16/28;
    allow 84.198.220.144/28;
    
    ##Proxy_AGN_1
    allow 194.127.26.64/26;
	  ##Proxy_AGN_2
	  allow 194.127.24.64/26;
     
    ##Hydraadm10
    allow 10.73.35.13;
    allow 217.136.92.31;

		deny all;
		
		#sub_filter_once off;
		#sub_filter 'anonymousws-dup.allianz.be' 'vdk-dup.allianz.be';
		
		proxy_connect_timeout       600;
		proxy_send_timeout          600;
		proxy_read_timeout          600;
		send_timeout                600;
	  
		set $my_host "anonymousws-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/P_C/VDKRestApi;
		proxy_redirect http://anonymousws-hc-ext-uat.allianz.be https://vdk-dup.allianz.be;
	}
}
 
server {
	listen *:443 ssl; 
	server_name eb-uat.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}

	access_log /opt/trustbuilder/gateway/instances/default/logs/eb-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
	
	location / {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		#deny all;
		
		#set $my_host "eb-portal-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
		#proxy_pass  https://eb-portal-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz; 
		
		#CRPV221062023
		set $my_host "eb-portal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://eb-portal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;		
	}
	  
	location /ae-eb-portal-bff{
		set $my_host "eu-uat-benelux.apis.allianz.com";
		proxy_set_header Host $my_host;
		proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-eb-portal-bff;
	}
   

    location /eb-portal-bo-fe-old/ {
		proxy_set_header authorization $http_authorization;
		proxy_pass_header  authorization;	       

		#set $my_host "eb-portal-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
		#proxy_pass  https://eb-portal-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz;
		
		
		set $my_host "eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-bo-fe/;
		proxy_redirect https://eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-bo-fe/ https://eb-uat.allianz.be/;                   
	}


   location /eb-portal-bo-fe {
     #set $my_host "eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
     #proxy_set_header Host $my_host;
     #proxy_pass  https://eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-bo-fe/;
	 #proxy_redirect https://eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-bo-fe/ https://eb-uat.allianz.be/;
	 
	 #CRPV221062023
	 set $my_host "eb-portal-bo-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
     proxy_set_header Host $my_host;
     proxy_pass  https://eb-portal-bo-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-bo-fe/;
	 proxy_redirect https://eb-portal-bo-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-bo-fe/ https://eb-uat.allianz.be/;
   }
   
   location /mybenefitsaccount {
     #set $my_host "eb-portal-self-reg-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
     #proxy_set_header Host $my_host;
     #proxy_pass  https://eb-portal-self-reg-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/mybenefitsaccount/;
	 ##proxy_redirect https://eb-portal-self-reg-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/mybenefitsaccount/ https://eb-uat.allianz.be/;
	 
	 #CRPV221062023
	 set $my_host "eb-portal-self-reg-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
     proxy_set_header Host $my_host;
     proxy_pass  https://eb-portal-self-reg-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/mybenefitsaccount/;
	 
   }
     location /eb-portal-self-reg-bff/api/register {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		deny all;
     #set $my_host "eb-portal-self-reg-bff-azbnl-eb-portal-uat.apps.tools.adp.allianz";
     #proxy_set_header Host $my_host;
     #proxy_pass  https://eb-portal-self-reg-bff-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-self-reg-bff/api/register;
	 
	 #CRPV221062023
	 set $my_host "eb-portal-self-reg-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
     proxy_set_header Host $my_host;
     proxy_pass https://eb-portal-self-reg-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-self-reg-bff/api/register;
	 
	 
   }
   
   
   
}
 
server {
	listen *:443 ssl; 
	server_name ebcollab-uat.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/eb-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {   
	   return https://apps-dup.allianz.be/collaboration-platform;            
   }
} 
server {
	listen *:443 ssl; 
	server_name mira-uat.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/mira-uat.allianz.be_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
        # Internals only
        #allow 194.127.26.64/26;
        #allow 194.127.24.64/26;
        #deny all;

		set $my_host "mira-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://mira-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   }
   
} 
server {
	listen *:443 ssl;
	server_name lifeportal-uat.allianz.be;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    application/font-woff                            woff;
    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}
 
	# Server name changed to lifeportal-uat on 02/01/2024 - Keeping same log folder and file name
    access_log /opt/trustbuilder/gateway/instances/default/logs/plpportal-uat/plpportal-uat.log logstash;
	
 
	# Exposing PLP broker portal
	location / {
		set $my_host "plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
		#proxy_redirect https://plp-brokerportal-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plpportal-uat.allianz.be;
	}
	
	location ^~/bff/ {
		set $my_host "plp-brokerportal-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		
		rewrite ^/bff/(.*)$ /$1 break;
		proxy_pass https://plp-brokerportal-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
		#proxy_redirect https://plp-brokerportal-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://plpportal-uat.allianz.be/bff;
	}
}
 
server {
	listen *:443 ssl;
	server_name fkweb-fiz-dup.allianz.be;
 
location /LVL0/net {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/net;
}
location /LVL0/z2k {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/z2k;
}
location /LVL0/ZAD {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/ZAD;
}
location /LVL0/ZVI {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL0/ZVI;
}
location /LVL3/Z2K/TRX/AAAZNTDISPLOG {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/Z2K/TRX/AAAZNTDISPLOG;
}
location /LVL3/Z2K/TRX/AAAZNTPROFILE {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/Z2K/TRX/AAAZNTPROFILE;
}

location /LVL3/NET/ZCO/Portal/Broker {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET/ZCO/Portal/Broker;
	proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
	}
	
location /LVL3/TeamCoordinationCourtage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/TeamCoordinationCourtage;
	proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}
location /LVL3/NET/ZVG/DOWNLOAD {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZVG/DOWNLOAD;
}
location /LVL3/ZVG/BLUE3 {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/ZVG/BLUE3;
}
location /LVL3/EMAC/APPS/EBWebsitesecure {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/EMAC/APPS/EBWebsitesecure;
}
location /LVL3/NET/ZCO/Application/flexiterme {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/flexiterme;
}
location /LVL3/ZAE/simulationemprunthypothecaire {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/ZAE/simulationemprunthypothecaire;
}
location /LVL3/NET/ZCO/Application/FichecourtierProto {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET/ZCO/Application/FichecourtierProto;
}
location /LVL3/NET/VIEF/proposition {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/NET/VIEF/proposition;
}
location /LVL3/ZVI/Omniconsultation {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/ZVI/Omniconsultation;
}

location /LVL3/NET2/LifeSystems {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkw2k-fez-dup.agf.be/LVL3/NET2/LifeSystems;
} 
location /BI/ {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}

location /BI/ps/login {
  access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
  
	set $my_host "cognosui-fez-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cognosui-fez-dup.allianz.be;
}

#New Cognos 10 on Windows 2019
	location /ibmcognos {
		access_by_lua_block {
  		local header_map = {
  			Authorization="credential.attributes['common|authz_header']", 
  			x_tb_session   = ''
  		}
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
		set $my_host "bapps1920-ext-uat.agf.be";
		proxy_set_header Host $my_host; 
    proxy_pass http://bapps1920-ext-uat.agf.be/ibmcognos;
    proxy_redirect http://bapps1920-ext-uat.agf.be https://fkweb-fiz-dup.allianz.be;
	} 
location /LVL3/NET4/Common/QuotationTool {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Common/QuotationTool;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/Net4/Common/QuotationTool {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Common/QuotationTool;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/NET4/Common/QuotationTool {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Common/QuotationTool;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/net4/Common/QuotationTool {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_read_timeout 3600;
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Common/QuotationTool;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
} 
location /atline {
	return 301 https://apps-dup.allianz.be/atline;
}

location /lvl3/NET2/Life/EB/Atline {
	return 301 https://apps-dup.allianz.be/atline;
}

location /lvl3/NET2/Life/EB/ATLine {
	return 301 https://apps-dup.allianz.be/atline;
}

location /EBonline/Apps/Atline/AtlinePlus {
	return 301 https://apps-dup.allianz.be/atline;
}

location /ebonline/apps/atline/atlineplus {
	return 301 https://apps-dup.allianz.be/atline;
}

location /@LineNetManager {
	return 301 https://apps-dup.allianz.be/atline;
} 
location /cp {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /CP {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}


location /Fr/extranet/collaborationPlateforme/tousDocuments/_vti_bin/Allianz {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /Fr/extranet/collaborationPlateforme {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /Nl/extranet/collaborationPlateforme {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /EBonline/Apps/CP_fr {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /Apps/CP_fr {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /apps/cp_fr {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /EBonline/Apps/CP_nl {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /Apps/CP_nl {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /apps/cp_nl {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

 
location /ebonline {
	##return 301 https://apps-dup.allianz.be/ebonline;
  set $my_host "eb-online-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
	proxy_set_header Host $my_host; 
  proxy_pass https://eb-online-azbnl-ebcollabora-uat.apps.tools.adp.allianz/ebonline/;
}

location /EBonline {
	return 301 https://apps-dup.allianz.be/ebonline;
}

location /ebonline/ {
	return 301 https://apps-dup.allianz.be/ebonline;
}

location /EBonline/ {
	return 301 https://apps-dup.allianz.be/ebonline;
} 
location /plnnet/ {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /PlnNet/ {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Plnnet/ {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Fr/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Nl/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /ProlinkNet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
} 
location /lvl3/NET2/ProLinkNG {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /LVL3/NET2/ProLinkNG {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/net2/prolinkng {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /LVL3/NET2/ProLinkNG/Vehicle {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';
 
  set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
  proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Vehicle;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/NET2/ProLinkNG/Vehicle {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';
 
  set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
  proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Vehicle;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/net2/prolinkng/claims {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';

	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
  	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Claims;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/NET2/ProLinkNG/Claims {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	proxy_connect_timeout       600;
	proxy_send_timeout          600;
	proxy_read_timeout          600;
	send_timeout                600;
	
	sub_filter_once off;
	sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'fkweb-fiz-dup.allianz.be';

	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
  	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/Claims;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
} 
location /apps {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/apps_digipass;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /APPS {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/apps_digipass;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /Apps {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/apps_digipass;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /apps/Brokerage/GreenCard {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

#location ~* ^/apps/Brokerage/GreenCard {
#		access_by_lua_block {
#		local header_map = {
#			Authorization="credential.attributes['common|authz_header']", 
#			x_tb_session   = ''
#		}
#		require("trustbuilder-gateway.protect").web_app(header_map)
#	}
#		set $my_host "fkweb-fiz-dup.allianz.be";
#		proxy_set_header Host $my_host;
#		return 302 https://fkweb-fiz-dup.allianz.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard;
#		proxy_connect_timeout       300;
#		proxy_send_timeout          300;
#		proxy_read_timeout          300;
#		send_timeout                300;
#		proxy_set_header Connection "";
#}

location /lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard {
		
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard;
}

location /aol {
		access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  proxy_set_header Host $my_host;
		proxy_set_header Host   "mfipo1.agf.be";
		proxy_pass              http://mfipo1.agf.be:41002/;
	}

location /w2h {
		access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
    proxy_set_header  Authorization $http_authorization;
    proxy_pass_header Authorization;
	  proxy_set_header Host $my_host;
		proxy_set_header Host   "mfipo1.agf.be";
		proxy_pass              http://mfipo1.agf.be:41002;
	}
 
location / {
		access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
    proxy_set_header  Authorization $http_authorization;
    proxy_pass_header Authorization;
	  proxy_set_header Host $my_host;
		proxy_set_header Host   "mfipo1.agf.be";
		proxy_pass              http://mfipo1.agf.be:41002;
	}
   
location /_layouts {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
	   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_layouts;
}

location /_upresources {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_upresources;
}
location /_vti_bin {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
}

location /_vti_inf.html* {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
}

location /documents {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /Documents {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /en/ext_public {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
}

location /fr/ext_public {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}
location /ge/ext_public {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
}
location /images {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/images;
}
location /nl/ext_public {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
}
location /PublishingImages {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/PublishingImages;
}

location /Style%20Library {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	
	
	set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be;
	
	if ($http_referrer ~ 'ebonline'){
		set $my_host "ebonline-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be;
	}
	if ($http_referrer ~ 'cp'){
		set $my_host "cp-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be;
	}
}

location '/Style Library' {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be;
		#proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
		
	if ($http_referrer ~ 'ebonline'){
		set $my_host "ebonline-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be;
	}
	if ($http_referrer ~ 'cp'){
		set $my_host "cp-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be;
	}
}

location /style%20library {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be;
		#proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
		
	if ($http_referrer ~ 'ebonline'){
		set $my_host "ebonline-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be;
	}
	if ($http_referrer ~ 'cp'){
		set $my_host "cp-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be;
	}
}

location '/style library' {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be;
		#proxy_redirect http://plnnet-dup.allianz.be https://prolinknet-dup-tb.allianz.be;
		
	if ($http_referrer ~ 'ebonline'){
		set $my_host "ebonline-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be;
	}
	if ($http_referrer ~ 'cp'){
		set $my_host "cp-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be;
	}
}	
location /_catalogs {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_catalogs;
		proxy_redirect http://plnnet-dup.allianz.be https://fkweb-fiz-dup.allianz.be;
		
	if ($http_referrer ~ 'ebonline'){
		set $my_host "ebonline-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://ebonline-dup.allianz.be;
	}
	if ($http_referrer ~ 'cp'){
		set $my_host "cp-dup.allianz.be";
		#proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be;
	}
} 
location /LVL3/NET4/Life/il/lisa {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz.allianz.be;
}

location /lvl3/NET4/Life/IL/LISA {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz.allianz.be;
}

location /lvl3/Net4/Life/IL/LISA {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz.allianz.be;
}

location /LVL3/NET4/Life/il/LISA {
	access_by_lua_block {
		local header_map = {
			Authorization = "credential.attributes['common|authz_header']",
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Life/il/lisa;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz.allianz.be;
}

location /lvl3/NET4/Life/il/lisa {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET4/Life/il/lisa;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz.allianz.be;
}

location /Scripts/Libraries {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET4/Life/IL/LISA/Scripts/Libraries;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz.allianz.be;
}
 
location /lvl3/net2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx {
	#if ($http_cookie !~* "DIGIAZBE"){
	#	return 302 https://webservice03-dup.allianz.be/digiwebsite/Logon_PLP_Digi.aspx?urlOrg=https://fkweb-fiz-dup-tmp.allianz.be/lvl3/NET2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx;
	#	break;
	#}
    #proxy_set_header X-Real-IP $remote_addr;
    #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #proxy_set_header Authorization $http_authorization;
	#proxy_set_header Authorization 'Basic ZG9tX2JlYWdmXHcwdHJjbDpBbGxpYW56MDgwQA==';
	#proxy_pass_header Authorization;
	
	#set $my_host "fkweb-fiz-dup-tb.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass https://fkweb-fiz-dup-tb.allianz.be/lvl3/net2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx;
	
	
	return 302 http://fkweb-fiz-dup-plp.allianz.be/lvl3/net2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx;
}

location /lvl3/NET2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx {
	#if ($http_cookie !~* "DIGIAZBE"){
	#	return 302 https://webservice03-dup.allianz.be/digiwebsite/Logon_PLP_Digi.aspx?urlOrg=https://fkweb-fiz-dup-tmp.allianz.be/lvl3/NET2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx;
	#	break;
	#}
    #proxy_set_header X-Real-IP $remote_addr;
    #proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    #proxy_set_header Authorization $http_authorization;
	#proxy_set_header Authorization 'Basic ZG9tX2JlYWdmXHcwdHJjbDpBbGxpYW56MDgwQA==';
	#proxy_pass_header Authorization;
	
	#set $my_host "fkweb-fiz-dup-tb.allianz.be";
	#proxy_set_header Host $my_host;
	#proxy_pass https://fkweb-fiz-dup-tb.allianz.be/lvl3/net2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx;
	
	return 302 http://fkweb-fiz-dup-plp.allianz.be/lvl3/net2/Life/PLP/AuthenticationSite/UI/WebViews/Default.aspx;
} 
location /LVL3/Net4/Brokerage/IARD {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/Net4/Brokerage/IARD;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /LVL3/NET4/Brokerage/portfoliostatement {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/portfoliostatement;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /LVL3/NET4/Brokerage/PortFolioStatement {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/portfoliostatement;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/NET4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/portfoliostatement;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /lvl3/Net4/Brokerage/PortfolioStatement {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/portfoliostatement;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /portfoliostatement {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/portfoliostatement;
	proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup.allianz.be;
}

location /LVL3/NET4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount;
}

location /lvl3/net4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount;
}

location /lvl3/net4/brokerage/brokeraccount {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount;
}

location /lvl3/NET4/Brokerage/BrokerAccount {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount;
}

location /lvl3/NET4/Brokerage/BrokerAccount/Scripts {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount/Scripts;
}

location /brokeraccount {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount;
}

location /apps/brokerage/brokeraccount/Consultation {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount;
}

location /lvl3/NET4/Brokerage/BrokerAccount/Account/InitialiseSearch {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount/Account/InitialiseSearch;
}

location /lvl3/NET4/Brokerage/BrokerAccount/Content {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/NET4/Brokerage/BrokerAccount/Content;
}

location /LVL3/Net2/Brokerage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/Net2/Brokerage;
}

location /lvl3/net2/brokerage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/Net2/Brokerage;
}

location /lvl3/NET2/Brokerage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/LVL3/Net2/Brokerage;
}

location /lvl3/net4/Brokerage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/net4/brokerage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/NET4/Brokerage {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage;
}

location /lvl3/NET4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage/CommercialReporting;
}

location /LVL3/NET4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage/CommercialReporting;
}

location /lvl3/net4/Brokerage/CommercialReporting {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", 
			x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	proxy_set_header Host $my_host;
	
	proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/net4/Brokerage/CommercialReporting;
}
 
location /_common {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_common;
}
location /_forms {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_forms;
}

location /crm/_forms {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/crm/_forms;
}

location /_grid {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_grid;
}
location /_imgs {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_imgs;
}
location /_static {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_static;
}

location /_static/_common {
	access_by_lua_block {
			local header_map = {
					Authorization="credential.attributes['common|authz_header']",
					x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_static/_common;
}

location /crm {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/crm;
}
location /CRMReports {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/CRMReports;
}
location /help {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/help;
}
location /Reserved.ReportViewerWebControl.axd* {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/Reserved.ReportViewerWebControl.axd*;
}

location /scriptresource.axd* {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}

	sub_filter_once off;
	sub_filter 'MByopgSAeTI-jDKg5kI_k8ZGBsecfRMM2FKwxiYVbM1nDW0hu-0WH8LgmbSVoRUDhLkStxeBKheM9bSMfwrb7BJbeANSvGRf_QOnJi051oepjJJFM-4_TPFn8RrjwVWsjsaiN_-VQ6dQ1oWNeR_-mUkDuMM1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';
	
	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be/scriptresource.axd*;
}
location /ScriptResource.axd* {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}

	sub_filter_once off;
	sub_filter 'MByopgSAeTI-jDKg5kI_k8ZGBsecfRMM2FKwxiYVbM1nDW0hu-0WH8LgmbSVoRUDhLkStxeBKheM9bSMfwrb7BJbeANSvGRf_QOnJi051oepjJJFM-4_TPFn8RrjwVWsjsaiN_-VQ6dQ1oWNeR_-mUkDuMM1' 'hnnLeABdoWHoYGuWdn1dB8M-UHhmErpmZBjo3u_B_WN2FBAn3IJ2vEHHWnyAO8D7-RQq9ERo5pmXHuDecI1EVGkHVbgSybutWnKzvtzlqyeEmi8-ByWsvirjBfiQGbtNveH6ivX8XKv48IPei6KAw9-RaFw1';
	
	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be/ScriptResource.axd*;
}

location /tools {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/tools;
}

location /webresource.axd* {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be/webresource.axd*;
}
location /WebResource.axd* {
	access_by_lua_block {
		local header_map = {
			Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	set $my_host "cp-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://cp-dup.allianz.be/WebResource.axd*;
} 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $domain          				'.allianz.be';
if ($http_host ~* 'allianz.nl'){
	set $domain          				'.allianz.nl';
}
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
  	access_log /opt/trustbuilder/gateway/instances/default/logs/fkweb-fiz-dup-tb_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;

	#proxy_set_header	Host	fwkdcc-fez-dup.mgm-dup.agf.be;


	#location /prolinksmemobile {
	#	access_by_lua_block {
	#		local header_map = {
	#			Authorization="credential.attributes['common|authz_header']", 
	#			x_tb_session   = ''
	#		}
	#		require("trustbuilder-gateway.protect").web_app(header_map)
	#	}
	#	proxy_pass http://prolinksmemobile-dup.allianz.be/;
	#}
	
	#location /LVL3/EMAC/APPS/WhosWhoWebSite {
	#	access_by_lua_block {
	#		local header_map = {
	#			Authorization="credential.attributes['common|authz_header']", 
	#			x_tb_session   = ''
	#		}
	#		require("trustbuilder-gateway.protect").web_app(header_map)
	#	}
	#	proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/LVL3/EMAC/APPS/WhosWhoWebSite;
	#	proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://fkweb-fiz-dup-tb.allianz.be;
	#}
}
 
server {
	listen *:443 ssl; 
	server_name adviseur-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/adviseur_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
       return 302 $scheme://mybroker-uat.allianz.nl$request_uri;
		#set $my_host "up-fe-uat-azbnl-btu-up.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
		#proxy_pass  https://up-fe-uat-azbnl-btu-up.apps.tools.adp.allianz;
   }
}
 
server {
	listen *:443 ssl;
	server_name extranet-dup.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $domain          				'.allianz.be';
if ($http_host ~* 'allianz.nl'){
	set $domain          				'.allianz.nl';
}
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';
 
location /BI {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognosui-dup";
		proxy_set_header Host $my_host;
		return 302 http://cognosui-dup/bi;
}

location /bi {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognosui-dup";
		proxy_set_header Host $my_host;
		return 302 http://cognosui-dup/bi;
}

#New Cognos 10 on Windows 2019
	location /ibmcognos {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "cognos1920-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://cognos1920-dup.agf.be/ibmcognos/bi/;
} 
location /atline {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		
		#proxy_pass http://fwkhc-uat.agf.be/lvl3/NET2/Life/EB/Atline/;
		#proxy_redirect http://fwkhc-uat.agf.be https://extranet-dup.allianz.be;
		
		return 302 http://fwkhc-uat.agf.be/lvl3/NET2/Life/EB/Atline/;
}

location /EBonline/Apps/Atline/AtlinePlus {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://fwkhc-uat.agf.be/lvl3/NET2/Life/EB/Atline/;
}

location /ebonline/apps/atline/atlineplus {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 http://fwkhc-uat.agf.be/lvl3/NET2/Life/EB/Atline/;
} 
location /cp {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /CP {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /Fr/extranet/collaborationPlateforme {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location /Nl/extranet/collaborationPlateforme {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location '/style%20library/allianz/js/cp' {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location '/style library/allianz/js/cp' {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location '/Style Library/allianz/js/cp' {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
}

location '/Style%20Library/allianz/js/cp' {
		return 301 https://apps-dup.allianz.be/collaboration-platform;
} 
location /ebonline {
		return 301 https://apps-dup.allianz.be/ebonline;
}

location /EBonline {
		return 301 https://apps-dup.allianz.be/ebonline;
}

location /ebonline/ {
		return 301 https://apps-dup.allianz.be/ebonline;
}

location /EBonline/ {
		return 301 https://apps-dup.allianz.be/ebonline;
}

location /EBonline/Apps/CP_fr {
		return 301 https://apps-dup.allianz.be/ebonline;
}

location /EBonline/Apps/CP_nl {
		return 301 https://apps-dup.allianz.be/ebonline;
}

location /ebonline/fr/extranet/EBonline {
	return 301 https://apps-dup.allianz.be/ebonline;
}

location /ebonline/nl/extranet/EBonline {
	return 301 https://apps-dup.allianz.be/ebonline;
} 
location /plnnet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /PlnNet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Plnnet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Fr/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /Nl/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /fr/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
}

location /nl/extranet/prolinknet {
	return 302 https://apps-dup.allianz.be/MyAllianz;
} 
 
location /APPS {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-uat.agf.be;
		proxy_redirect https://lan-apps-dup.allianz.be http://fwkhc-uat.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /Apps {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-uat.agf.be;
		proxy_redirect https://lan-apps-dup.allianz.be http://fwkhc-uat.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		#proxy_set_header Connection "";
}

location /apps {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		proxy_pass http://fwkhc-uat.agf.be;
		#proxy_redirect https://lan-apps-dup.allianz.be http://fwkhc-uat.agf.be;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/NL {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/Platform/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Platform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/FR {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
location /apps/QuotationTool/RCDecennal/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/fr-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/NL {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/nl-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/RCDecennal/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Common/QuotationTool/Platform/UI/nl-BE/DecennialLiabilityPlatform/Configuration;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/Fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}
location /apps/QuotationTool/TrafficPlan/fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/fr-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/Nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location /apps/QuotationTool/TrafficPlan/nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET4/Common/QuotationTool/Platform/UI/nl-be/Accident/TrafficPlan/TrafficPlan;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/Brokerage/BrokerAccount/Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Brokerage/BrokerAccount;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/Brokerage/CommercialReporting {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Brokerage/CommercialReporting;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/Brokerage/GreenCard {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/Brokerage/GreenCard/UI/WebViews/GreenCard;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/Brokerage/Portfolio/Statement {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Brokerage/PortfolioStatement;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";

}
location ~* ^/apps/ClaimsForms/Incendie_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/net4/Brokerage/ClaimsForms/Incendie/Incendie?lang=fr;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ClaimsForms/Incendie_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Brokerage/ClaimsForms/Incendie/Incendie?lang=nl;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ClaimsForms/Omnium_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Brokerage/ClaimsForms/Omnium/Omnium?lang=fr;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ClaimsForms/Omnium_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Brokerage/ClaimsForms/Omnium/Omnium?lang=nl;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ClaimsForms/RC_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Brokerage/ClaimsForms/RC/RC?lang=fr;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ClaimsForms/RC_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/net4/Brokerage/ClaimsForms/RC/RC?lang=nl;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNet/Commercial_All/Devis_Incendie_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/LVL3/TeamCoordinationCourtage/devis_incendie/fr/devis.html;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNet/Commercial_All/Devis_Incendie_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/LVL3/TeamCoordinationCourtage/devis_incendie/nl/schaderamming.html;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNet/Commercial_All/Inspecteur_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/LVL3/TeamCoordinationCourtage/Inspecteur/index.htm;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNet/Commercial_All/Inspecteur_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/LVL3/TeamCoordinationCourtage/Inspecteur/index_nl.htm;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNet/Commercial_All/Taylor_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/LVL3/TeamCoordinationCourtage/Taylor_made_contract\fr\RCE\index.html;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNet/Commercial_All/Taylor_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/LVL3/TeamCoordinationCourtage/Taylor_made_contract\nl\BAO\index.html;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNet/Commercial_All/Whoswho_Acces_fr {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/EMAC/Apps/WhosWhoWebSite/index.asp?lang=FR;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNet/Commercial_All/Whoswho_Acces_nl {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkdcc-dup.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkdcc-dup.agf.be/lvl3/EMAC/Apps/WhosWhoWebSite/index.asp?lang=NL;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_All/FacilityProgram_All {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/FacilityProgram/Workplace.aspx?dialog=CreateFacilityProgram;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_All/FacilityProgram_Manage {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/FacilityProgram/Workplace.aspx?dialog=Manage;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNG/Contrat_Auto/Contrat_Avenant {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Vehicle/Workplace.aspx?dialog=Amendment;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNG/Contrat_Auto/Contrat_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Vehicle/Workplace.aspx?dialog=Search;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNG/Contrat_Auto/Contrat_NouvelleAffaire {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Vehicle/Workplace.aspx?dialog=NewCase;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_Auto/Contrat_Tarification {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Vehicle/Workplace.aspx?dialog=NewPricing;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNG/Contrat_Auto/Tarif_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Vehicle/Workplace.aspx?dialog=ConsultPricing;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNG/Contrat_Incendie/Contrat_Avenant {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Property/Workplace.aspx?dialog=Amendment;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_Incendie/Contrat_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Property/Workplace.aspx?dialog=ConsultContract;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}


location ~* ^/apps/ProlinkNG/Contrat_Incendie/Contrat_NouvelleAffaire {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Property/Workplace.aspx?dialog=NewCase;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_Incendie/Contrat_Tarification {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Property/Workplace.aspx?dialog=NewPricing;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_Incendie/Tarif_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Property/Workplace.aspx?dialog=ConsultPricing;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_RCFamiliale/Contrat_Avenant {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/CivilLiability/Workplace.aspx?dialog=Amendment;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_RCFamiliale/Contrat_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/CivilLiability/Workplace.aspx?dialog=Search;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_RCFamiliale/Contrat_NouvelleAffaire{
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/CivilLiability/Workplace.aspx?dialog=NewCase;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_RCFamiliale/Contrat_Tarification{
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/CivilLiability/Workplace.aspx?dialog=NewPricing;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Contrat_RCFamiliale/Tarif_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/CivilLiability/Workplace.aspx?dialog=ConsultPricing;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Home {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/StartPage/default.aspx;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}

location ~* ^/apps/ProlinkNG/Sinistre_All/Sinistre_Consultation {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "fwkhc-uat.agf.be";
		proxy_set_header Host $my_host;
		return 302 https://fwkhc-uat.agf.be/lvl3/NET2/ProLinkNG/Claims/Workplace.aspx?dialog=Search;
		proxy_connect_timeout       300;
		proxy_send_timeout          300;
		proxy_read_timeout          300;
		send_timeout                300;
		proxy_set_header Connection "";
}









 
location /_catalogs/ {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		
		set $my_host "";
		set $app "";
		set $sub "";
		
		if ($request_uri ~ .*plnnet.*) {
			set $my_host "plnnet-dup.allianz.be";
			set $app "plnnet";
			set $sub "plnnet/";
		}
		if ($request_uri ~ .*ebonline.*) {
			set $my_host "ebonline-dup.allianz.be";
			set $app "ebonline";
			set $sub "";
		}
		if ($request_uri ~ .*cp.*) {
			set $my_host "cp-dup.allianz.be";
			set $app "cp";
			set $sub "cp/";
		}
		if ($request_uri ~ .*atline.*) {
			set $my_host "atlinenet-dup.allianz.be";
			set $app "atlinenet";
			set $sub "";
		}
		
		proxy_set_header Host $my_host;
		proxy_pass http://app-dup.allianz.be/$sub;
		proxy_redirect http://app-dup.allianz.be https://extranet-dup.allianz.be; 
}

location /_layouts {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_layouts;
}

location /_upresources {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_upresources;
}

location /_vti_bin {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_vti_bin;
}

location /_vti_inf.html* {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/_vti_inf.html*;
}

location /documents {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /Documents {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/documents;
}

location /en/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/en/ext_public;
}

location /fr/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /FR/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /NL/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/fr/ext_public;
}

location /ge/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/ge/ext_public;
}

location /images {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/images;
}

location /nl/ext_public {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/nl/ext_public;
}

location /PublishingImages {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}
		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/PublishingImages;
}

location '/Style Library' {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup.allianz.be; 
}

location /Style%20Library {
		access_by_lua_block {
			local header_map= {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
			}
			require("trustbuilder-gateway.protect").web_app(header_map)
	}

set $my_host "plnnet-dup.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://plnnet-dup.allianz.be/$1;
	proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup.allianz.be; 
}

location '/style library' {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be;
		proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup.allianz.be;
}

location /style%20library {
		access_by_lua_block {
				local header_map= {
						Authorization="credential.attributes['common|authz_header']",
										x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}

		set $my_host "plnnet-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://plnnet-dup.allianz.be/$1;
		proxy_redirect http://plnnet-dup.allianz.be https://extranet-dup.allianz.be;
}

location /Fr/Images_ext_secure {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup.allianz.be/cp; 
}

location /Nl/Images_ext_secure {
		access_by_lua_block {
				local header_map = {
						Authorization="credential.attributes['common|authz_header']",
						x_tb_session   = ''
				}
				require("trustbuilder-gateway.protect").web_app(header_map)
		}
		header_filter_by_lua_block {
			   require("trustbuilder-gateway.auth_interface")()
		}

		set $my_host "cp-dup.allianz.be";
		proxy_set_header Host $my_host;
		proxy_pass http://cp-dup.allianz.be/;
		proxy_redirect http://cp-dup.allianz.be https://extranet-dup.allianz.be/cp; 
} 
location /web/LVL3/Net4/Prevention/PreventionPolicyDoc {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/web/LVL3/Net4/Prevention/PreventionPolicyDoc;
} 
location /_common {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_common;
}

location /_forms {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_forms;
}

location /crm/_forms {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/crm/_forms;
}

location /_grid {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_grid;
}

location /_imgs {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_imgs;
}

location /_static {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_static;
}

location /_static/_common {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/_static/_common;
}

location /crm {
	return 301 http://climb-uat.allianz.be/crm;
}

location /crm/XRMServices {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	add_header Access-Control-Allow-Origin *;
	
	proxy_http_version 1.1;
    proxy_set_header Connection "";
	
	proxy_set_header  Authorization $http_authorization;
	proxy_pass_header Authorization;
	
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/crm/XRMServices;
	proxy_redirect http://climb-uat.allianz.be https://extranet-dup.allianz.be;
}

location /CRMReports {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/CRMReports;
}

location /help {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/help;
}

location /Reserved.ReportViewerWebControl.axd* {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/Reserved.ReportViewerWebControl.axd*;
}

location /ScriptResource.axd* {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/scriptresource.axd*;
}

location /tools {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/tools;
}

location /Tools {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/tools;
}

location /webresource.axd* {
	access_by_lua_block {
		local header_map = {
				Authorization="credential.attributes['common|authz_header']",
				x_tb_session   = ''
		}
		require("trustbuilder-gateway.protect").web_app(header_map)
	}
	header_filter_by_lua_block {
		   require("trustbuilder-gateway.auth_interface")()
	}
	set $my_host "climb-uat.allianz.be";
	proxy_set_header Host $my_host;
	proxy_pass http://climb-uat.allianz.be/webresource.axd*;
}	

	access_log /opt/trustbuilder/gateway/instances/default/logs/extranet_access.log logstash;

	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	#add_header Strict-Transport-Security "max-age=31536000" always;
    #add_header Content-Security-Policy upgrade-insecure-requests;
	
  location / {
      error_page 404 = @fallback;
  }
  
  location @fallback {
  internal;
      rewrite (.*) /Plnnet/Nl/extranet/prolinknet/Paginas/PageNotFound.aspx  break;
      proxy_pass http://plnnet-dup.allianz.be;
  }
  

	location /prolinksmemobile {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			set $my_host "prolinksmobile-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://prolinksmemobile-dup.allianz.be/;
	}
	
	location /helloworld {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			set $my_host "poctrustbuilder-dup.allianz.be";
			proxy_set_header Host $my_host;
			proxy_pass http://poctrustbuilder-dup.allianz.be/;
	}
	
	
	location /broker {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			set $my_host "e1-absepp-uat.agf.be";
			proxy_set_header Host $my_host;
			proxy_pass http://e1-absepp-uat.agf.be:8083/broker;
	}
	
	location /ABSLogon {
			access_by_lua_block {
					local header_map = {
							Authorization="credential.attributes['common|authz_header']",
							x_tb_session   = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
			}
			header_filter_by_lua_block {
				   require("trustbuilder-gateway.auth_interface")()
			}
			proxy_pass http://127.0.0.1:6080/ABSLogon;
	}
}
 
server {
    listen *:443 ssl;
    server_name broker-dup.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

# ABS P&C FE portal location
    location /absr3 {
        set $my_host "broker-dup.allianz.nl";
        proxy_set_header Host $my_host;

        proxy_pass http://e1-2spdfe1-uat.agf.be:8082/absr3;  
    }

#digidentityWS
  location /digidentityWS/eWS/user/webUserManagement {
    #satisfy any;
    auth_basic "Anonymous authentication";
    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";

    #auth_request /tb_int_auth;
    #auth_request_set $user $upstream_http_x_forwarded_user;

    proxy_set_header Host "e1-absesb1-uat.agf.be";
    #proxy_set_header Host "api-dup.allianz.be";
    proxy_pass http://e1-absesb1-uat.agf.be:8084/eWS/user/webUserManagement;
    proxy_ssl_verify off;
  }

    
}
 
server {
    listen *:443 ssl;
    server_name www.wood-life126.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

    location / {
        access_by_lua_block {
                        local header_map = {
                                Authorization="credential.attributes['common|authz_header']",
                        }
                        require("trustbuilder-gateway.protect").web_app(header_map)
                }
                header_filter_by_lua_block {
                       require("trustbuilder-gateway.auth_interface")()
                }
		proxy_set_header Host $host;
		proxy_pass http://www.wood-life126.be;
    }
    
}
 
server {
	listen *:443 ssl; 
	server_name mira-int.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/mira-int.allianz.be_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
        # Internals only
        #allow 194.127.26.64/26;
        #allow 194.127.24.64/26;
        #deny all;

		set $my_host "mira-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://mira-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   }
} 
server {   
	listen *:443 ssl;
	server_name mortgage-uat.allianz.be;
	access_log /opt/trustbuilder/gateway/instances/default/logs/mortgage-uat.allianz.be/mortgage-uat.allianz.be_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;

	error_page 404 /404.html;
	error_page 403 /403.html;
	error_page 500 502 503 504 /500.html;

	# Configuration of root vhost 
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}

	location / { 
	  # set $my_host "allianzstg.alpha1.be";
	   #proxy_pass https://allianzstg.alpha1.be/;
	   #proxy_redirect https://allianzstg.alpha1.be https://mortgage-uat.allianz.be;
	}
}
 
server {
	listen *:443 ssl; 
	server_name mybroker-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/mybroker-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
		set $my_host "up-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://up-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   }

    location /myallianz {
                set $my_host "up-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_set_header Host $my_host;
                proxy_pass  https://up-nl-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   }


}
 
  server {
	listen *:443 ssl; 
	server_name aovportaal-int.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/aovportaal-int_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
       
	
	       set $my_host "life-aov-nl-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
   	       proxy_set_header Host $my_host; 
	       proxy_pass  https://life-aov-nl-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;
		                     
   }
   
    location /ae-aov-fe {
                set $my_host "life-aov-nl-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
   	       proxy_set_header Host $my_host; 
	       proxy_pass  https://life-aov-nl-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-aov-fe;
   }
   
   #redirect logic to short the end user url
   location /register {
		
		proxy_pass https://eu-int-benelux.apis.allianz/ae-aov-bff/login/register?method=register&connection_code=$arg_cc;
   }
   
    location /login {
				
		proxy_pass https://eu-int-benelux.apis.allianz/ae-aov-bff/login;
   }

    location /ae-aov-bff {

		proxy_pass https://eu-int-benelux.apis.allianz/ae-aov-bff;
    }
	
  }
 
server {
	listen *:443 ssl; 
	server_name mira-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/mira-uat.allianz.nl_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
    location / {
        # Internals only
        #allow 194.127.26.64/26;
        #allow 194.127.24.64/26;
        #deny all;

		set $my_host "mira-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://mira-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
   }
} 
server {
	listen *:443;
	server_name webservice03-dup.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/webservice03-dup_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
   
   location / {
		if ($arg_urlOrg) {
			return 302 $arg_urlOrg;
		}
		
		return 404;
   }
}
 
server {
	listen *:443 ssl; 
	server_name schadestatus-uat.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/schadestatus-uat_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
		
		#set $my_host "up-claimstracker-fe-uat-azbnl-btu-up.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
        #proxy_pass http://up-claimstracker-fe-uat-azbnl-btu-up.apps.tools.adp.allianz;
		return 302 https://my-uat.allianz.nl;
	}
	#redirect logic to short the end user url
   location /register {
		
		#return 302 https://api-uat.allianz.nl/ae-ct-bff/login/register?method=register&connection_code=$arg_cc;
		return 302 https://api-uat.allianz.nl/ae-cp-bff/login/register?method=register&connection_code=$arg_cc&usertype=$arg_usertype;
   }
   
    location /login {
				
		#return 302 https://api-uat.allianz.nl/ae-ct-bff/login;
		return 302 https://api-uat.allianz.nl/ae-cp-bff/login;
   }

   
}
 
  server {
	listen *:443 ssl; 
	server_name orvportaal-int.allianz.nl;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

	access_log /opt/trustbuilder/gateway/instances/default/logs/orvportaal-int_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;
	
	add_header Content-Security-Policy upgrade-insecure-requests;
   
    location / {
    
              # proxy_set_header authorization $http_authorization;
               #proxy_pass_header  authorization;	       
	
	       set $my_host "egv-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
   	       proxy_set_header Host $my_host; 
	       proxy_pass  https://egv-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-egv-fe/;
		                     
   }

   location /ae-egv-fe {
			  
		#proxy_set_header authorization $http_authorization;
		#proxy_pass_header  authorization; 
		set $my_host "egv-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass  https://egv-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ae-egv-fe/;
		

   }
   
   location /ae-egv-bff{
			#proxy_set_header authorization $http_authorization;
			#proxy_pass_header  authorization;

                set $my_host "eu-int-benelux.apis.allianz";
                proxy_set_header Host $my_host;
                proxy_pass https://eu-int-benelux.apis.allianz/ae-egv-bff;
				proxy_redirect https://eu-int-benelux.apis.allianz/ae-egv-bff https://orvportaal-int.allianz.nl;

   }
   
   location /ae-egv-bff/login/register {
		proxy_set_header authorization $http_authorization;
		proxy_pass_header  authorization;

		set $my_host "eu-int-benelux.apis.allianz";
		proxy_set_header Host $my_host;
		proxy_pass https://eu-int-benelux.apis.allianz/ae-egv-bff/login/register;
		proxy_redirect https://eu-int-benelux.apis.allianz/ae-egv-bff/login/register https://orvportaal-int.allianz.nl;
    }
	
   location /ais {
		#set $my_host "slb21144.srv.allianz:8443";
		proxy_set_header authorization $http_authorization;
		proxy_pass_header  authorization;

                set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   
    location /ais/screens {
		#set $my_host "slb21144.srv.allianz:8443";
		set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais/screens;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   
    location /ais/css {
		#set $my_host "slb21144.srv.allianz:8443";
	        set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais/css;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   
     location /ais/html {
		#set $my_host "slb21144.srv.allianz:8443";
                set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais/html;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   
     location /ais/images {
		#set $my_host "slb21144.srv.allianz:8443";
	        set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais/images;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   
   
     location /ais/js {
		#set $my_host "slb21144.srv.allianz:8443";
                set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais/js;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   
     location /ais/bootstrap {
		#set $my_host "slb21144.srv.allianz:8443";
                set $my_host "orvportaal-int.allianz.nl";
		proxy_set_header Host $my_host; 
		proxy_pass  https://slb21144.srv.allianz:8443/ais/bootstrap;
		proxy_redirect https://slb21144.srv.allianz:8443 https://orvportaal-int.allianz.nl;
   }
   

   
}
 
server {   
	listen *:443 ssl;
	server_name aol-uat.allianz.nl;
	access_log /opt/trustbuilder/gateway/instances/default/logs/aol-uat.allianz.nl/aol-uat.allianz.nl_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;

	error_page 404 /404.html;
	error_page 403 /403.html;
	error_page 500 502 503 504 /500.html;

	# Configuration of root vhost 
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}

	#aol-uat.allianz.nl (ANS MF)
	location / {
	}
 
 location /aol {
    access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  #proxy_set_header Host $my_host;
		proxy_set_header Host "mftoag.agf.be";
		proxy_pass  https://mftoag.agf.be:41002/;
	}
 
  location /w2h {
		access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  #proxy_set_header Host $my_host;
		proxy_set_header Host "mftoag.agf.be";
		proxy_pass  https://mftoag.agf.be:41002;
  }
  
  location /option {
    access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  #proxy_set_header Host $my_host;
		proxy_set_header Host "mftoag.agf.be";
		proxy_pass  https://mftoag.agf.be:41002;
	}
 
  #https://aol-uat.allianz.nl/Virtelappmenu.png
  location /Virtelappmenu.png {
    access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  #proxy_set_header Host $my_host;
		proxy_set_header Host "mftoag.agf.be";
		proxy_pass  https://mftoag.agf.be:41002/Virtelappmenu.png;
	}
 
 location /doc {
    access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  #proxy_set_header Host $my_host;
		proxy_set_header Host "mftoag.agf.be";
		proxy_pass  https://mftoag.agf.be:41002;
	}
 
 location /USERPARM {
    access_by_lua_block {
		  local header_map = {
			  x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
	  #proxy_set_header Host $my_host;
		proxy_set_header Host "mftoag.agf.be";
		proxy_pass  https://mftoag.agf.be:41002;
	}
} 
server {
        listen *:443;
        server_name wilolc-dup.allianz.be;
 
## Sector Orange (BTU)
location /callback/so {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '4ce275c3-13e0-4900-b0a9-6cf74163c08a';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /callback/so/uat  {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '28f10f01-f100-49d2-b964-7e995b1cf462';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

location /uat/itsme/callback {
    
    #proxy_pass https://orchestrator_backend/idhub/oauth2/callback/23d85bb9-a0a8-47bf-b33b-f9cf3536f7bf;
    
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Sector Orange (UP) Preprod
location /callback/so/preprod {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '25c46040-b02a-4655-a3e3-8d23ccde472f';
    set $code $arg_access_token;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Itsme (EBPCD)
location /replac-again {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '721ce26b-130f-464d-88b3-5549a63eb6b3';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Registration (EBPCD)
location /idhub/tb/ebpcd_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'cda34c0e-21fe-4763-a455-31f228f8a67f';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Registration (EB Portal 2.0)
location /idhub/tb/eb_register {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '818db123-5d59-40a3-b4f6-a94e98830544';
    set $action $arg_doAction;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&doAction=$action&relayState=$relayState&authenticationContext=;
}

## Digidenity (TMG)
location /idhub/oauth2/callback/0d1f9fdf-21e0-40b1-9760-0b8010bfc4fb {
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode '5c53e111-d74f-4631-833c-0fa9b5b7e8c7';
    set $code $arg_code;
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}

## Portima (TMG)
location /idhub/tb/portima_idp{
    proxy_set_header Host $http_host;
    set $relayState $arg_state;
    set $idpCode 'd1699d53-9a69-47ab-9632-c107e2b6f702';
    access_by_lua_block {
        require("trustbuilder-gateway.protect").public_web_app_v2()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }
    proxy_method POST;
    proxy_set_body $query_string;
    proxy_pass https://orchestrator_backend/idhub/authenticate/internalidp?idpCode=$idpCode&code=$code&relayState=$relayState&authenticationContext=;
}


location /tb/showHeaders {
    access_by_lua_block {
        local header_map= {
		x_hdr_user="credential.attributes['btu|user']"
            }
            require("trustbuilder-gateway.protect").web_app(header_map)
        }
        header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
    }
    proxy_pass https://orchestrator_backend/idhub/tb/showHeaders;
}
location /idhub/oidc/v2/jwks.json {
    proxy_pass https://orchestrator_backend/idhub/tb/well_known;
}

location /idhub/oidc/.well-known/openid-configuration{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/.well-known/openid-configuration;

}
location /idhub/oidc/v1/token{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/token;

}
location /idhub/oidc/v1/jwks.json{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/jwks.json;

}
location /idhub/oidc/v1/userinfo{
#proxy_hide_header Access-Control-Allow-Origin;
proxy_pass https://orchestrator_backend/idhub/oidc/v1/userinfo;

}
 
location /server_status {
      	if ($scheme = http) {
        	return 301 https://$http_host$request_uri;
      	}

        # Turn on nginx stats
        stub_status on;

        # I do not need logs for stats
        access_log   off;

        # Security: Only allow access from 192.168.1.100 IP #
        allow 127.0.0.1;

        # Send rest of the world to /dev/null #
        deny all;
} 
location /idhub {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

	#proxy_set_header Referer "";
	#proxy_set_header Origin "";
    proxy_pass https://orchestrator_backend;
}

location /idhub/tb/pages {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
	#if ($http_referer = "https://apps-dup.allianz.nl/") {
		more_clear_headers "Referer";
		more_clear_headers "Origin";
		#add_header Referer "";
		#add_header Origin "";
	#}
	
	if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' '*';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
     }
     if ($request_method = 'POST') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }
     if ($request_method = 'GET') {
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' '*' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
     }

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    # Error page request ?
    #if ($args ~* "ACTION=error") {
        # Remove session cookies
    #    add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #    add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    #}

    if ($args ~* "ERROR_CODE=") {
        # Remove session cookies
        add_header Set-Cookie "IDHUB_JSESSIONID=; path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
        add_header Set-Cookie "IDHUB-SESSION=; path=/; domain=.allianz.be; Expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    }

    proxy_pass https://orchestrator_backend;
}

location /idhub/admin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").orchestrator()
    }
    header_filter_by_lua_block {
        require("trustbuilder-gateway.auth_interface")()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    if ( $request_uri ~* \.(css|js|png|gif|eot|woff2|ttf|svg)$ ) {
        access_log off;
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public";
    }

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 84.198.141.54;
	allow 94.225.50.134;
    deny all;

    proxy_pass https://orchestrator_backend;
}

location /authzServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Host $host;

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/authorization/score;
}

location /sessionServer {
    internal;

    proxy_http_version 1.1;
    proxy_set_header Connection "";

    
    proxy_pass https://orchestrator_backend/idhub/admin/api/v1/session;
}

location /idhub/mobileauthentication/builtinregister {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend;
}

location /idhub/authenticate/applicationcatalog/builtin {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;

    proxy_pass https://orchestrator_backend/idhub/authenticate/applicationcatalog/builtin;
}

location /tba {
    access_by_lua_block {
        local header_map = {
            Authorization = 'credential.attributes["idp|TBAAccess"]';
        }

        require("trustbuilder-gateway.protect").web_app(header_map)
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
    default_type text/html;

    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 10.73.35.10; ## HYDRABNL10
    allow 10.16.35.27; ## HYDRABNL11
    allow 94.224.167.122;
    allow 84.198.141.54;

    deny all;

    proxy_pass http://tba_backend/tba;
}

location /idhub/public/api/v1/idp/provisioning/reset {
    access_by_lua_block {
        require("trustbuilder-gateway.protect").web_app()
    }

    expires 0;
    add_header Cache-Control "private, max-age=0, no-cache, no-store" always;
    add_header Pragma "no-cache" always;
	
    allow 10.16.32.33; ## HYDRAADME1
    allow 10.73.32.33; ## HYDRAADME2
    allow 10.73.36.33; ## HYDRA10
    allow 10.16.36.33; ## HYDRA11
    allow 10.73.35.13; ## HYDRAADME10
    allow 10.16.35.28; ## HYDRAADME11
    allow 94.224.167.122;
    deny all;

    proxy_pass https://orchestrator_backend/idhub/public/api/v1/idp/provisioning/reset;
}
 
ssl_certificate /opt/trustbuilder/gateway/instances/default/ssl/allianz.crt;
ssl_certificate_key /opt/trustbuilder/gateway/instances/default/ssl/allianz.key;
ssl_session_cache shared:SSL:50m;
ssl_session_timeout 5m;
ssl_dhparam /opt/trustbuilder/gateway/instances/default/ssl/dhparam.pem;
ssl_prefer_server_ciphers off;
ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
ssl_ciphers "ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4";

set $session_store_location         '127.0.0.1:46379';

set $session_timeout                '28800';
set $session_inactivity_timeout     '1800';
set $session_cookie                 'IDHUB-SESSION';
set $session_regenerate             0;
set $session_auth		    		'HF9YS7SXE9syLzd';
set $login_url                      '/idhub/gw-login';
set $authorization_url              '/authzServer';
set $authorization_cache_time       '300';

set $idhub_install_enabled          'true'; #In production setting this to false is a wise choice
set $idhub_admin_enabled            'true';
set $idhub_admin_api_enabled        'true';

      	access_log /opt/trustbuilder/gateway/instances/default/logs/willemot_access.log logstash;
      	root /opt/trustbuilder/gateway/instances/default/docroots/root;
       
       #ProLinkNG
		  location /prolinkng {
          access_by_lua_block {
                        local header_map = {
                                Authorization = "credential.attributes['common|authz_header']",
								                x_tb_session  = ''
                        }
                        require("trustbuilder-gateway.protect").web_app(header_map)
          }
          header_filter_by_lua_block {
            require("trustbuilder-gateway.auth_interface")()
          }
		  
		  sub_filter_once off;
		  sub_filter 'fkweb-fiz.allianz.be' 'wilolc-dup.allianz.be';
          
          set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
          proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG/CivilLiability;
          proxy_redirect http://fwkdcc-fez-dup.mgm-dup.agf.be https://wilolc-dup.allianz.be;    
       }
	   
		location /lvl3/NET2/ProLinkNG {
		  sub_filter_once off;
		  sub_filter 'fkweb-fiz.allianz.be' 'wilolc-dup.allianz.be';
		  
		  if ($http_WilProfile) {
			add_header Set-Cookie WilAZBE=DUP:${http_WilProfile};
		  }
		  
		  #proxy_set_header WilProfile "DUP:${http_WilProfile}";
		  #proxy_pass_header WilProfile;
        
      proxy_connect_timeout       600;
    	proxy_send_timeout          600;
    	proxy_read_timeout          600;
    	send_timeout                600;
          
          set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
		  proxy_set_header  Authorization $http_authorization;
		  proxy_pass_header Authorization;
          proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
          proxy_redirect https://fwkdcc-fez-dup.mgm-dup.agf.be https://wilolc.willemot.be;
       }
	   
	   location /lvl3/net2/ProLinkNG {
		  sub_filter_once off;
		  sub_filter 'fkweb-fiz.allianz.be' 'wilolc-dup.allianz.be';
		  
		  if ($http_WilProfile) {
			add_header Set-Cookie WilAZBE=DUP:${http_WilProfile};
		  }
		  
		  #proxy_set_header WilProfile "DUP:${http_WilProfile}";
		  #proxy_pass_header WilProfile;
        
      proxy_connect_timeout       600;
    	proxy_send_timeout          600;
    	proxy_read_timeout          600;
    	send_timeout                600;
          
          set $my_host "fwkdcc-fez-dup.mgm-dup.agf.be";
          proxy_set_header Host $my_host;
		  proxy_set_header  Authorization $http_authorization;
		  proxy_pass_header Authorization;
          proxy_pass http://fwkdcc-fez-dup.mgm-dup.agf.be/lvl3/NET2/ProLinkNG;
          proxy_redirect https://fwkdcc-fez-dup.mgm-dup.agf.be https://wilolc.willemot.be;
       }
}
 
server {   
	listen *:443 ssl;
	server_name climb-uat.allianz.be;
	access_log /opt/trustbuilder/gateway/instances/default/logs/climb-uat.allianz.be/climb-uat.allianz.be_access.log logstash;
	root /opt/trustbuilder/gateway/instances/default/docroots/root;

	error_page 404 /404.html;
	error_page 403 /403.html;
	error_page 500 502 503 504 /500.html;

	# Configuration of root vhost 

	#climb-uat.allianz.be
	location /{
		proxy_set_header Host  "climb-uat.allianz.be";
		proxy_pass   http://climb-uat.allianz.be;
		
	}

}

 
server {
    listen *:443 ssl;
    server_name apps-dup.allianz.nl;
    access_log /opt/trustbuilder/gateway/instances/default/logs/apps-dup.allianz.nl/apps-dup.allianz.nl_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    error_page 404 /404.html;
    error_page 403 /403.html;
    error_page 500 502 503 504 /500.html;


location / {
			proxy_set_header Host "aem.allianz.be";
			proxy_pass http://aem.allianz.be;
   }
   
   # ABS P&C FE portal location
    location /absr3 {
	add_header Access-Control-Allow-Headers *;
        set $my_host "apps-dup.allianz.nl";
        proxy_set_header Host $my_host;
		
		add_header Access-Control-Allow-Origin $http_origin;

        proxy_pass http://e1-2spdfe1-uat.agf.be:8081/absr3;
    }

 

 ########################## My Allianz ####################################
   location /MyAllianz {
        #External
        allow 194.127.26.64/26;
        ##Proxy_AGN_1
        allow 194.127.24.64/26;
        ##Proxy_AGN_2;
        allow 109.134.152.80;
        #deny all;
		
		proxy_set_header Origin https://apps-dup.allianz.nl;
		add_header Access-Control-Allow-Origin $http_origin;	
        
        proxy_set_header Host "pnet-fe-azbnl-prolinknet-uat.apps.tools.adp.allianz";
        proxy_pass https://pnet-fe-azbnl-prolinknet-uat.apps.tools.adp.allianz/MyAllianz;
       #proxy_redirect https://pnet-fe-azbnl-prolinknet-uat.apps.tools.adp.allianz https://apps-dup.allianz.nl;
   }

   location /MyAllianz/digipass {
 	add_header 'Access-Control-Allow-Credentials' 'true'; 
    	proxy_set_header Origin https://apps-dup.allianz.nl;
        add_header Access-Control-Allow-Origin $http_origin;
	add_header Set-Cookie "auth_channel=digipass; domain=.allianz.nl; path=/; Max-Age=60";
	return 302  https://apps-dup.allianz.nl/MyAllianz;
	#proxy_set_header Host "apps-dup.allianz.nl";
        #proxy_pass https://apps-dup.allianz.nl/MyAllianz;

   }

#Colaboration-platform Project
location /collaboration-platform {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
        proxy_pass https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz/ae-ebcollaboration-fe/;
		proxy_redirect https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.nl;
	}

location /ae-ebcollaboration-fe {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
        proxy_pass https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz/ae-ebcollaboration-fe/;
		proxy_redirect https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.nl;
	}
 
 location /aol {
		access_by_lua_block {
		  local header_map = {
			  Authorization="credential.attributes['common|authz_header']", x_tb_session   = ''
		  }
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
		proxy_set_header Host   "mfipo1.agf.be";
		proxy_pass              http://mfipo1.agf.be:41002/;
	}
	
#OV project - Sector Orange endpoint

	location /api/sector/orange/process-action/ {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 10.251.77.64/26;
		allow 10.251.92.0/24;
		allow 44.112.134.192/27;	
		allow 185.106.154.61;
		allow 98.71.181.87;
		deny all;
		
		proxy_set_header Host "life-aov-aovapplmngt-nl-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://life-aov-aovapplmngt-nl-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/api/sector/orange/process-action/;
		proxy_redirect https://life-aov-aovapplmngt-nl-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.nl;
	}
	
}
 
server {
    listen *:443 ssl;
    server_name api-sit.allianz.nl;
    access_log /opt/trustbuilder/gateway/instances/default/logs/api-sit.allianz.nl/api-sit.allianz.nl_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    error_page 404 /404.html;
    error_page 403 /403.html;
    error_page 500 502 503 504 /500.html;

 
 location / {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		proxy_set_header Host "eu-int-benelux.apis.allianz";
		proxy_pass https://eu-int-benelux.apis.allianz;
	}
} 
server {   
   listen *:443 ssl;
   server_name api-tst.allianz.be;
   access_log /opt/trustbuilder/gateway/instances/default/logs/api-tst.allianz.be/api-tst.allianz.be_access.log logstash;
   root /opt/trustbuilder/gateway/instances/default/docroots/root;

   error_page 404 /404.html;
   error_page 403 /403.html;
   error_page 500 502 503 504 /500.html;

   # Configuration of root vhost 
    	

#location / {
        
 #} 
 
#climb-tst.allianz.be
location / {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT
		allow 194.127.9.106;
		#AZ_WPA2_Auth
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF
		allow 194.127.72.7;
		#AZBE_IP_OFF_1
		allow 194.127.72.13;
		#AZBE_IP_OFF
		allow 194.127.72.6;
		#AZNL_IP_OFF
		allow 191.235.131.37;
		#Click_1
		allow 191.235.132.226;
		#Click_10
		allow 191.235.131.249;
		#Click_11
		allow 191.235.130.254;
		#Click_12
		allow 191.235.129.90;
		#Click_13
		allow 191.235.135.16;
		#Click_14
		allow 191.235.131.217;
		#Click_15
		allow 104.214.218.45;
		#Click_16
		allow 23.102.54.167;
		#Click_17
		allow 40.113.80.190;
		#Click_18
		allow 40.113.84.45;
		#Click_19
		allow 40.113.81.82;
		#Click_2
		allow 40.113.87.99;
		#Click_20
		allow 40.113.87.3;
		#Click_21
		allow 52.169.0.238;
		#Click_22
		allow 191.235.130.156;
		#Click_3
		allow 191.235.135.29;
		#Click_4
		allow 191.235.130.239;
		#Click_5
		allow 191.235.131.125;
		#Click_6
		allow 191.235.128.160;
		#click_7
		allow 40.69.22.169;
		#Click_8
		allow 191.235.133.92;
		#Click_9
		deny all;
		proxy_set_header Host  "Climb-tst.allianz.be";
		proxy_pass   http://Climb-tst.allianz.be/;
        
}
 
 ## AML Service
location /AML {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.57.138.148;
	##Proxy_DCRP_1;
	allow 18.195.184.6;
	##Proxy_DCRP_2;
	allow 52.59.71.104;
	##Proxy_DCRP_3;
	allow 52.57.233.215;
	##Proxy_DCRP_4;
	allow 18.195.134.238;
	##Proxy_DCRP_5;
	allow 18.195.120.233;
	##Proxy_DCRP_6;
	allow 10.26.204.136;
	#transitional-dev-1_3
	allow 44.118.68.0/22;
	allow 44.118.72.0/22;
	allow 44.118.76.0/22;
	
	allow 13.36.117.162;
	allow 13.37.219.95;
	allow 15.237.145.227;
	allow 35.180.239.235;
	allow 13.38.22.232;
	allow 35.181.23.151;
	allow 52.57.20.183;
	allow 18.198.149.247;
	allow 3.126.195.64;
	allow 52.29.218.127;
	allow 18.157.192.179;
	allow 35.156.15.231;
	deny all;
	##proxy_intercept_errors on;
    ##rewrite_log on;
	#OLD Sever 
    #proxy_pass   http://externalws-dup.mgm-dup.agf.be/Aml;
    #proxy_redirect   off;
    #proxy_set_header Host  "externalws-dup.mgm-dup.agf.be";
	
	 #New BAPPS 
	 proxy_pass  http://externalwshc-ext-uat.agf.be/Aml;
     #proxy_redirect   off;
     proxy_set_header Host "externalwshc-ext-uat.agf.be";
	 
   }
#Digidentity
location /digidentityWS {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.57.138.148;
	##Proxy_DCRP_1;
	allow 18.195.184.6;
	##Proxy_DCRP_2;
	allow 52.59.71.104;
	##Proxy_DCRP_3;
	allow 52.57.233.215;
	##Proxy_DCRP_4;
	allow 18.195.134.238;
	##Proxy_DCRP_5;
	allow 18.195.120.233;
	##Proxy_DCRP_6;
	allow 10.26.204.136;
	deny all;
	##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass   http://e1-absesb1-tst.agf.be:8081/eWS/user/webUserManagement;
    #proxy_redirect   off;
    proxy_set_header Host  "e1-absesb1-tst.agf.be:8081";
   }
   
#digidentityWS 
location /digidentityWS/eWS/user/webUserManagement {
    satisfy any;
    auth_basic "Anonymous authentication";
    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";

    auth_request /tb_int_auth;
    auth_request_set $user $upstream_http_x_forwarded_user;
    proxy_set_header Host "e1-absesb1-tst.agf.be:8081";
    proxy_pass http://e1-absesb1-tst.agf.be:8081/eWS/user/webUserManagement;
	#http://e1-absesb1-tst.agf.be:8081/eWS/user/webUserManagement/WebuserManagementService?wsdl
    proxy_ssl_verify off;
}

#dispatchWS
location /dispatchWS/eWS/contract/dispatch/contractDetail {
	
    satisfy any;
    auth_basic "Anonymous authentication";
    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";
	
    auth_request /tb_int_auth;
    auth_request_set $user $upstream_http_x_forwarded_user;
	proxy_set_header Host "e1-absesb1-tst.agf.be:8081";
    proxy_pass http://e1-absesb1-tst.agf.be:8081/eWS/contract/dispatch/contractDetail;
    proxy_ssl_verify off; 
}

location = /tb_int_auth { 
	internal;
	proxy_pass https://orchestrator_backend/idhub/tb/anonymous_idp;
    proxy_ssl_verify    off;
    proxy_pass_request_body off;
    proxy_set_header Content-Length "";
    proxy_set_header X-Original-URI     $request_uri;
    proxy_set_header X-Real-IP          $remote_addr;
    proxy_set_header X-Client-IP        $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
    proxy_set_header Authorization      $http_authorization;
    proxy_set_header Host               $http_host;
}

## INT Test
location /MeFirstWS{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 91.183.8.77;
	 #MeFirst_TST_1
	 allow 91.183.224.53;
	 #MeFirst_TST_2
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host "externalwshc-ext-uat.agf.be";
   }
   
location /ImmothekerWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 84.194.79.89;
	#Immotheker_1
	allow 81.82.227.106;
	#Immotheker_2
	allow 84.197.200.140;
	#Immotheker_3
	allow 81.164.118.6;
	#Immotheker_4
	allow 81.83.24.62;
	#Immotheker_5
	allow 94.225.198.41;
	#Immotheker_6
	deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass   http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
location /MarshWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 168.168.43.249;
	#Marsh_Prod_1
	allow 168.168.35.214;
	#Marsh_Prod_10
	allow 168.168.35.230;
	#Marsh_Prod_11
	allow 168.168.43.254;
	#Marsh_Prod_2
	allow 168.168.45.214;
	#Marsh_PROD_8
	allow 168.168.45.230;
	#Marsh_Prod_9
	allow 54.72.239.62;
	#Marsh_Prod
	allow 168.168.35.214;
	#Marsh_UAT_2
	allow 35.195.51.248;
	#Marsh-TST_1
	allow 35.195.81.90;
	#Marsh-TST_2
	allow 31.14.160.34;
	allow 168.168.127.192/26;
	#Marsh-TST
	#NonLifePricingService Test Marsh rule from BE300636
	#194.127.26.75;
	#NLPSTestFromBE300636
	
	allow 168.168.43.248/29;
	allow 168.168.45.224/29;
	allow 168.168.33.248/29;
	allow 168.168.35.224/29;

	allow 168.168.45.248/30;
	#Marsh_Prod_3
	allow 168.168.33.248/30;
	#Marsh_Prod_4
	allow 168.168.35.248/30;
	#Marsh_Prod_5
	allow 168.168.43.248/30;
	#Marsh_Prod_6
	allow 168.168.45.225/32;
	#Marsh_Prod_7
	allow 168.168.45.214;
	allow 168.168.35.230;
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
location /CarPoolWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 81.82.205.150;
	#CarPool
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
   
location /CarPoolExcelWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.78.217.216;
	#CarPoolExcel_1
	allow 37.97.235.165;
	#CarPoolExcel_2;
	allow 149.210.154.126;
	#CarPoolExcel_3
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
   
location /ModixWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.29.75.213;
	#Modix_1
	allow 52.28.134.5;
	#Modix_2
	allow 78.21.63.41;
	#Modix_Dev_1
	allow 4.196.57.50;
	#Modix_Dev_2
	allow 52.18.243.178;
	#PricingService
	allow 52.19.172.135;
	#PricingService1
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host   "externalwshc-ext-uat.agf.be";
   }
   
location /WeGroupWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.18.243.178;
	#PricingService
	allow 52.19.172.135;
	#PricingService1
	allow 167.172.37.81;
	#WeGroup_1
	allow 40.74.2.154;
	#WeGroup_2
	allow 20.54.176.237;
	#WeGroup_3
	allow 91.182.194.48;
	#WeGroup_4
	allow 51.138.68.167;
	#WeGroup_5
	allow 91.166.210.51;
	#WeGroup_6
	allow 87.64.89.38;
	#WeGroup_7
	allow 20.54.178.110;
	#WeGroup_8
	allow 3.69.117.220;
	#WeGroup_9
	 deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass   http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host "externalwshc-ext-uat.agf.be";
   }
   
location /VanbredaWS {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.157.255.80/28;
	#VanBreda-Prod_4
	allow 94.143.188.0/29;
	#VanBreda-TST
	allow 185.101.43.228/31;
	#VanBreda-TST3
	allow 52.18.243.178;
	#PricingService
	allow  52.19.172.135;
	#PricingService1
	#allow 52.174.149.164;
	allow 40.68.245.211;
	#VanBreda-Dup_1
	allow 52.19.10.40;
	#VanBreda-Dup
	allow 194.78.251.150;
	#VanBreda-Prod_3
	allow 52.18.247.233;
	#VanBreda-Prod
	allow 213.251.74.88;
	#VanBreda-TST2
	allow 52.136.246.130;
	#VanBreda-TST4
	allow 13.93.91.78;
	#VanBreda-TST5
	allow 20.103.139.80/28;
	#New req
	allow 193.108.201.0/24;
	allow 185.101.43.228/31;
	#Newreq04072023
	allow 20.103.139.80/28;
	deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass   http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host "externalwshc-ext-uat.agf.be";
   }
location /VerzekeringenBeWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 188.93.81.150;
	#Verzekeringen.be_TST_1
	allow 188.93.86.18;
	#Verzekeringen.be_TST_2
	allow 188.93.84.3;
	#Verzekeringen.be_TST_3
	allow 51.145.179.161;
	#Verzekeringen.be_TST_4
	allow 51.145.179.162;
	#Verzekeringen.be_TST_5
	allow 137.117.153.55;
	#Verzekeringen.be_TST_6
	##Proxy_AGN_2
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass       http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host        "externalwshc-ext-uat.agf.be";
   }
location /BrocoliWS{
     allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 52.178.26.52;
	#Brocoli
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }   
location /OpenBroker{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 allow 3.120.48.206;
	 #OpenBroker 
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
location /SolidasWS{
     allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 54.36.183.16;
	 #Solidas
	 allow 194.78.203.56;
     #Solidas_1
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host   "externalwshc-ext-uat.agf.be";
   }
location /HypotheekWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 18.202.122.118;
	#Hypotheek1
	allow 8.194.210.14;
	#Hypotheek2
	deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass      http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host      "externalwshc-ext-uat.agf.be";
   }

##RadarLiveWS
## DEV
location /RadarLiveWS-DEV {
		allow 81.207.204.51;
		#Marketscan solera.nl
		allow 77.163.140.236;
		#Marketscan solera.nl
		#Marketscan
		allow 83.247.10.69;
		#Marketscan_DEV
		allow 87.195.108.55;
		#Marketscan_PC
		allow 95.142.98.12;
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		deny all;

     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass              https://bfi-radar-azbnl-bfi-radar-dev.apps.tools.adp.allianz/RadarLiveWS-DEV/;
     #proxy_redirect   off;
     proxy_set_header Host            "bfi-radar-azbnl-bfi-radar-dev.apps.tools.adp.allianz";
   }
   
 ##Dispatch
 ## Test
location /dispatchWS{
		allow 194.127.9.106;
		##AZ_WPA2_Auth
		allow 194.127.72.13;
		#AZBE_IP_OFF
		allow 81.18.5.150;
		##Dispatch
		allow 80.101.64.155;
		##Dispatch-DR
		allow 95.97.71.30;
		##Dispatch-Test2
		allow 80.126.213.192;
		##Disptach-Test1
		allow 217.104.67.22;
		##MarcoHankel@Home@22/10/2019
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		deny all;

     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass              http://e1-absesb-tst.agf.be/eWS/contract/dispatch/contractDetail/;
     #proxy_redirect   off;
     proxy_set_header Host            "e1-absesb-tst.agf.be";
   }
#INTERNET_ Simplesurance-tst
location /Simplesurance{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 #Simplesurance Ips
	 allow 18.195.79.181;
	 allow 3.120.42.196;
	 allow 217.110.188.50;
	 allow 213.191.38.230;
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
   
  #INTERNET_ portimamultipricing-tst
location /portimamultipricing{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 allow 20.54.220.214;
	 allow 20.54.178.110;
	 allow 51.124.50.98;
	 allow 20.54.95.112;
	 allow 192.168.0.252;
	 allow 192.168.0.139;
	 allow 94.224.178.98;
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
   
## Allianz Connect
## INT
location /allianzconnectws{
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 35.158.196.155;
	#Amazon-tst
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 94.127.72.6;
	#AZNL_IP_OFF
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass     http://externalws-dup.mgm-dup.agf.be/Common/AllianzConnect/Service;
    #proxy_redirect   off;
    proxy_set_header Host   "externalws-dup.mgm-dup.agf.be";
   }
   
   location /GSERest{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 91.183.8.77;
	 #MeFirst_TST_1
	 allow 91.183.224.53;
	 #MeFirst_TST_2
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://fwknetbackend/Web/Anonymous/Net4/Transversal/GSERest;
     #proxy_redirect   off;
     proxy_set_header Host "fwknetbackend";
   }
   
location /FastQuoteRest{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 91.183.8.77;
	 #MeFirst_TST_1
	 allow 91.183.224.53;
	 #MeFirst_TST_2
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://fwknetbackend/Web/Anonymous/Net4/P_C/FastQuoteRest;
     #proxy_redirect   off;
     proxy_set_header Host "fwknetbackend";
   }
   
	#MyAllianz
	location /MyAllianz {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		
		proxy_set_header Host "pnet-fe-azbnl-prolinknet-int.apps.tools.adp.allianz";
        proxy_pass https://pnet-fe-azbnl-prolinknet-int.apps.tools.adp.allianz/MyAllianz/;
		proxy_redirect https://pnet-fe-azbnl-prolinknet-int.apps.tools.adp.allianz https://api-tst.allianz.be;
	}
	
	#MyAllianz BFF
	location /MyAllianz/bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		
		proxy_set_header Host "pnet-bff-azbnl-prolinknet-int.apps.tools.adp.allianz";
        proxy_pass https://pnet-bff-azbnl-prolinknet-int.apps.tools.adp.allianz/MyAllianz/bff;
		proxy_redirect https://pnet-bff-azbnl-prolinknet-int.apps.tools.adp.allianz https://api-tst.allianz.be;
	}
	
	location /fraudsearch-dev {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		set $my_host "bfi-fraud-search-azbnl-bfi-snapcar.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://bfi-fraud-search-azbnl-bfi-snapcar.apps.tools.adp.allianz/;
	}
 
 location /premiumnotification {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		set $my_host "fwkhc-tst-backend.agf.be";
		proxy_set_header Host $my_host; 
    proxy_pass http://fwkhc-tst-backend.agf.be:8080/LVL3/net4/oAuth/P_C/PremiumNotificationApi/api/premiumnotification/v1/premiumnotifications;
	}
}

 
server {
    listen *:443 ssl;
    server_name api-sit.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/api-sit.allianz.be/api-sit.allianz.be_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    error_page 404 /404.html;
    error_page 403 /403.html;
    error_page 500 502 503 504 /500.html;

 
 location / {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		proxy_set_header Host "eu-int-benelux.apis.allianz";
		proxy_pass https://eu-int-benelux.apis.allianz;
	}

	location /itmp-oidc/v1 {
		proxy_set_header Host "eu-int-benelux.apis.allianz";
		proxy_pass https://eu-int-benelux.apis.allianz/itmp-oidc/v1;
	}

	location /itmp-plp-bff/v1 {
		proxy_set_header Host "eu-int-benelux.apis.allianz";
		proxy_pass https://eu-int-benelux.apis.allianz/itmp-plp-bff/v1;
	}
} 
server {
    listen *:443 ssl;
    ## listen *: 80;
    server_name apps-dup.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/apps-dup.allianz.be/apps-dup.allianz.be_access.log logstash;
    
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    allow 0.0.0.0/0;
    
    #allow 173.245.48.0/20;
    #allow 103.21.244.0/22;
    #allow 103.22.200.0/22;
    #allow 103.31.4.0/22;
    #allow 141.101.64.0/18;
    #allow 108.162.192.0/18;
    #allow 190.93.240.0/20;
    #allow 188.114.96.0/20;
    #allow 197.234.240.0/22;
    #allow 198.41.128.0/17;
    #allow 162.158.0.0/15;
    #allow 104.16.0.0/12;
    #allow 172.64.0.0/13;
    #allow 131.0.72.0/22;
    #allow 104.16.0.0/13;
    #allow 104.24.0.0/14;
	



#INTERNET_www-dup.allianz.be_INDISPONIBLE

#WoodLife 
#location /{
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        ##return 302 http://www.wood-life126.be;
        #proxy_redirect off;
 #       proxy_set_header Host "wood-life126-dup-mgm.allianz.be";
  #      proxy_pass http://wood-life126-dup-mgm.allianz.be;
        #proxy_redirect http://wood-life126-dup-mgm.allianz.be/ https://apps-dup.allianz.be/woodlife-dup/; 
   # }
#WoodLife 
#location /woodlife-dup {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        ##return 302 http://www.wood-life126.be;
        #proxy_redirect off;
        ###proxy_set_header Host "wood-life126-dup-mgm.allianz.be";
        ###proxy_pass http://wood-life126-dup-mgm.allianz.be/;
        #proxy_redirect http://wood-life126-dup-mgm.allianz.be/ https://apps-dup.allianz.be/woodlife-dup/; 
 #   }
location /woodlife-dup {
       
        proxy_set_header Host "woodlife1920-ext-uat";
        proxy_pass http://woodlife1920-ext-uat/;
    }
#DUP
#PreventionPolicy 
location /PreventionPolicy-dup {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
location /web/LVL3/Net4/Prevention/PreventionPolicy {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
location /Web/LVL3/Net4/Prevention/PreventionPolicy {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
#FiscalForms
location /FiscalForms {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://athena-hc-uat.agf.be/FiscalForms/;
     #proxy_redirect   off;
     proxy_set_header Host "athena-hc-uat.agf.be";
 }
 
#performancecalculation
location /life/performancecalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-hc-uat.agf.be";
      proxy_pass  http://athena-hc-uat.agf.be/life/performancecalculation;
 }
location /Life/PerformanceCalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-hc-uat.agf.b";
      proxy_pass  http://athena-hc-uat.agf.be/Life/PerformanceCalculation;
 }
location /Life/PerformanceCalculation/UI {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-hc-uat.agf.be";
      proxy_pass  http://athena-hc-uat.agf.be/Life/PerformanceCalculation/UI;
 }


#DUP
# PLC UCM
location /PLC/UCM {

     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://plc-fwkdcc-fez-dup.mgm-dup.agf.be/PLC/UCM;
     #proxy_redirect   off;
     proxy_set_header Host "plc-fwkdcc-fez-dup.mgm-dup.agf.be";
 }
 
 location /UnavailableUCM {

     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass    http://plc-fwkdcc-fez-dup.mgm-dup.agf.be/UnavailableUCM/prolinkCampaign.htm;
     #proxy_redirect   off;
     proxy_set_header Host "plc-fwkdcc-fez-dup.mgm-dup.agf.be";
 }
 
location /lvl0/emac/apps/EBWebSiteAffiliatesCarrefour{
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-dup.allianz.be";
        proxy_pass http://anonymous-dup.allianz.be/lvl0/emac/apps/EBWebSiteAffiliatesCarrefour;
    }
	
 location /LVL0/PLP {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-dup.allianz.be";
        proxy_pass http://anonymous-dup.allianz.be/LVL0/PLP;
    }

location /Web/LVL3/Net4/P_C/FastQuote {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
		add_header X-Robots-Tag "noindex, follow" always;
        #proxy_set_header Host "athena-dup.agf.be";
        #proxy_pass http://athena-dup.agf.be/Web/LVL3/Net4/P_C/FastQuote;
		#New bapps
		proxy_set_header Host "athena-hc-uat.agf.be";
        proxy_pass http://athena-hc-uat.agf.be/Web/LVL3/Net4/P_C/FastQuote;
    }
location /web/LVL3/Net4/P_C/FastQuote {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
		add_header X-Robots-Tag "noindex, follow" always;
        #proxy_set_header Host "athena-dup.agf.be";
        #proxy_pass http://athena-dup.agf.be/web/LVL3/Net4/P_C/FastQuote;
		#NEe bapps
		proxy_set_header Host "athena-hc-uat.agf.be";
        proxy_pass http://athena-hc-uat.agf.be/web/LVL3/Net4/P_C/FastQuote;
    }
location /allianz/mybenefits{
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-hc-uat.agf.be";
        proxy_pass http://athena-hc-uat.agf.be/allianz/mybenefits;
		
    }
	
location /allianz/media {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-hc-uat.agf.be";
        proxy_pass http://athena-hc-uat.agf.be/allianz/media;
    }
	
location /allianz/images {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-hc-uat.agf.be";
        proxy_pass http://athena-hc-uat.agf.be/allianz/images;
    }


# app.allianz.be (in TMG)	
location /motorclaim {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 103.233.174.2;
	deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    #proxy_pass https://f-azbenelux-gdf-fnol.apps.tools.adp.allianz/motorclaim_ut/;
    #proxy_redirect   off;
    #proxy_set_header Host "f-azbenelux-gdf-fnol.apps.tools.adp.allianz";
	#CRPV2
	proxy_pass https://gdf-bmw-be-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/motorclaim_ut/;
    #proxy_redirect   off;
    proxy_set_header Host "gdf-bmw-be-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	
 }
 location /motorclaim_ut{
	# allow 194.127.26.64/26;
	#Proxy_AGN_1
	# allow 194.127.24.64/26;
	##Proxy_AGN_2
	# allow 194.127.9.106;
	#AZ_WPA2_Auth
	# allow 194.127.28.7;
	#AZ_WPA2Auth2
	# allow 103.233.174.2;
	# deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    #proxy_pass https://f-azbenelux-gdf-fnol.apps.tools.adp.allianz/motorclaim_ut/;
    #proxy_redirect   off;
    #proxy_set_header Host "f-azbenelux-gdf-fnol.apps.tools.adp.allianz";
	#CRPV2
	proxy_pass https://gdf-bmw-be-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/motorclaim_ut/;
    #proxy_redirect   off;
    proxy_set_header Host "gdf-bmw-be-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
 }
 	
	
 #INTERNET_HomeInsurance
location /homeinsurance {
		#External
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "fq-home-azbnl-fqs-dup.apps.tools.adp.allianz";
        proxy_pass https://fq-home-azbnl-fqs-dup.apps.tools.adp.allianz/homeinsurance;
    }
	
#Cloudflare_FastQuoteRest API (under API dns)

location /FastQuoteRest{
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		deny all;
		##proxy_intercept_errors on;
		##rewrite_log on;
		proxy_pass  http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/P_C/FastQuoteRest;
		#proxy_redirect   off;
		proxy_set_header Host "anonymousws-hc-ext-uat.allianz.be ";
   }
   
	
#Coudflare_HomeInsurance


#INTERNET_BrokerSearch
location /search-broker {
	#CRPV1 migration
	#proxy_set_header Host "gse-brokers-gse-brokersearch-fe.apps.tools.adp.allianz";
        #proxy_pass https://gse-brokers-gse-brokersearch-fe.apps.tools.adp.allianz/search-broker;
	proxy_set_header Host "brokersearch-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://brokersearch-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/search-broker;

    }
    
    location /GSERest{
	 ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/Transversal/GSERest;
     #proxy_redirect   off;
     proxy_set_header Host "anonymousws-hc-ext-uat.allianz.be";
   }


#INTERNET_CarRepairShopSearch

location /search-car-repair-shop {
		#External
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
		#CRPV1
        #proxy_set_header Host "gse-crs-azbnl-gse-crs-fe.apps.tools.adp.allianz";
        #proxy_pass https://gse-crs-azbnl-gse-crs-fe.apps.tools.adp.allianz/search-car-repair-shop;
		
		proxy_set_header Host "carrepair-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://carrepair-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/search-car-repair-shop;
    }

#INTERNET_fund-bff
location /fund-bff {
		#External
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
		#CRPV1 Migration
        #proxy_set_header Host "funds-bff-azbnl-funds-app.apps.tools.adp.allianz";
        #proxy_pass https://funds-bff-azbnl-funds-app.apps.tools.adp.allianz/fund-bff;
		
		proxy_set_header Host "funds-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://funds-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/fund-bff;
    }
#INTERNET_fund
location /fund {
		#External
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
		#CRPV1 Migration
        #proxy_set_header Host "funds-fe-azbnl-funds-app.apps.tools.adp.allianz";
        #proxy_pass https://funds-fe-azbnl-funds-app.apps.tools.adp.allianz/fund;
		
		proxy_set_header Host "funds-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://funds-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;
    }

#INTERNET_Roadsafe-bff
location /roadsafe-bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;

        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
	#CRPV1 Migration
        #proxy_set_header Host "roadsafe-be-azbnl-roadsafe.apps.tools.adp.allianz";
        #proxy_pass https://roadsafe-be-azbnl-roadsafe.apps.tools.adp.allianz/roadsafe-bff;

	proxy_set_header Host "trans-roadsafe-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://trans-roadsafe-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/roadsafe-bff;
    }

#INTERNET_Roadsafe
location /roadsafe {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;

        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
	#CRPV1 Migration
        #proxy_set_header Host "roadsafe-fe-azbnl-roadsafe.apps.tools.adp.allianz";
        #proxy_pass https://roadsafe-fe-azbnl-roadsafe.apps.tools.adp.allianz/roadsafe;

	proxy_set_header Host "roadsafe-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://roadsafe-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/roadsafe;

    }

#INTERNET_paperless-digital
location /digital {
		proxy_set_header Host "form-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://form-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/digital;
    }
	
	location /digital/ {
		proxy_set_header Host "form-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://form-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/digital/;
    }
#INTERNET_Paperless-be
location /paperless-bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;

        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
	proxy_set_header Host "trans-paperless-form-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	proxy_pass  https://trans-paperless-form-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/paperless-bff;
    }
	
	location /paperless-bff/ {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;

        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
	proxy_set_header Host "trans-paperless-form-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	proxy_pass  https://trans-paperless-form-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/paperless-bff/;			 
    }
	
	

#INTERNET_azbnl-contact-nl
location /azbnl-contact-nl {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;

        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        #CRPV1 Migration
        #proxy_set_header Host "contact-nl-fe-azbnl-contactform-nl.apps.tools.adp.allianz";
        #proxy_pass https://contact-nl-fe-azbnl-contactform-nl.apps.tools.adp.allianz/azbnl-contact-nl;

		proxy_set_header Host "contactforms-fe-nl-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_pass https://contactforms-fe-nl-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/azbnl-contact-nl;

    }
	
#INTERNET_azbnl-contact-nl-be
location /azbnl-contact-nl-bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;

        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
	#CRPV1 Migration
        #proxy_set_header Host "contact-nl-be-azbnl-contactform-nl.apps.tools.adp.allianz";
        #proxy_pass https://contact-nl-be-azbnl-contactform-nl.apps.tools.adp.allianz/azbnl-contact-nl-be;

		proxy_set_header Host "contactforms-bff-nl-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_pass https://contactforms-bff-nl-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/azbnl-contact-nl-bff;
    }
	
#INTERNET_EBPortal
location /ebportal {
		#proxy_set_header Host "app-azbnl-eb-portal.apps.tools.adp.allianz";
        #proxy_pass https://app-azbnl-eb-portal.apps.tools.adp.allianz/ebportal;
		#proxy_redirect http://app-azbnl-eb-portal.apps.tools.adp.allianz/ebportal https://apps-dup.allianz.be/ebportal;
		
		#proxy_set_header Host "eb-portal-service-v1-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        #proxy_pass https://eb-portal-service-v1-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ebportal;
		#proxy_redirect http://eb-portal-service-v1-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
		
		proxy_set_header Host "eb-portal-service-v1-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://eb-portal-service-v1-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/ebportal;
		proxy_redirect http://eb-portal-service-v1-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
		
    }
#APPNL_AutoSchade
location /autoschade {
	
	proxy_set_header Host "m-azbenelux-gdf-fnol.apps.tools.adp.allianz";
    proxy_pass  https://m-azbenelux-gdf-fnol.apps.tools.adp.allianz/autoschade;

   }
#APPNL_AutoSchadeBackend
location /autoschade_be {
	
	proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
    proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz;

   }
   
#Coudflare_CarInsurance
location /carinsurance {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		#deny all;
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
		add_header X-Robots-Tag "noindex, follow" always;
        #proxy_set_header Host "m-az-benelux-pc-fastquote-services.apps.tools.adp.allianz";
        #proxy_pass https://m-az-benelux-pc-fastquote-services.apps.tools.adp.allianz/carinsurance;
		
		#CRPV1
		proxy_set_header Host "fastquote-car-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://fastquote-car-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/carinsurance;
    }

#INTERNET_www-dup.allianz.be_OldAllianzBE
location /AllianzBE {
	
	proxy_set_header Host "moss-inet-dup.allianz.be";
    proxy_pass  https://moss-inet-dup.allianz.be/AllianzBE;

   }

#INTERNET_www-dup.allianz.be_Pro
location /pro {
	
	proxy_set_header Host "moss-inet-dup.allianz.be";
    proxy_pass  http://moss-inet-dup.allianz.be/pro;

   }
#INTERNET_www-dup.allianz.be_Redirect_HTTP (multiple apps)

#INTERNET_www-dup.allianz.be_Redirect


##INTERNET_www-dup.allianz.be_INDISPONIBLE
location /indisponible/affiliates {
	
   proxy_set_header Host "indisponible";
   proxy_pass  http://indisponible/indisponible/affiliates/;

 }
#INTERNET_Affiliates
location /affiliates {
	
	proxy_set_header Host "affiliates-fez.mgm-dup.agf.be";
    proxy_pass  http://affiliates-fez.mgm-dup.agf.be/affiliates/;

   }
location /Affiliates {
	
	proxy_set_header Host "affiliates-fez.mgm-dup.agf.be";
    proxy_pass  http://affiliates-fez.mgm-dup.agf.be/affiliates/;

   }
#INTERNET_AT_XMed_AZT
location /xmed {
      
	proxy_set_header Host "apps-dup.allianz.be";
	proxy_pass http://mirage20-dup.agf.be;
	proxy_redirect http://mirage20-dup.agf.be:8380/xmed https://apps-dup.allianz.be;
}

location /ims {
		proxy_set_header Host "apps-dup.allianz.be";
		proxy_pass http://mirage20-dup.agf.be/ims;
		proxy_redirect http://mirage20-dup.agf.be:8380/ims https://apps-dup.allianz.be;
}

location /userportal {
		proxy_set_header Host "apps-dup.allianz.be";
		proxy_pass http://mirage20-dup.agf.be/userportal;
		proxy_redirect http://mirage20-dup.agf.be:8380/userportal https://apps-dup.allianz.be;
}

location /contract {
		proxy_set_header Host "apps-dup.allianz.be";
		proxy_pass http://mirage20-dup.agf.be/contract;
		proxy_redirect http://mirage20-dup.agf.be:8380/contract https://apps-dup.allianz.be;
}

location /parameter {
		proxy_set_header Host "apps-dup.allianz.be";
		proxy_pass http://mirage20-dup.agf.be/parameter;
		proxy_redirect http://mirage20-dup.agf.be:8380/userportal https://apps-dup.allianz.be;
}
location /dashboard {
		proxy_set_header Host "apps-dup.allianz.be";
		proxy_pass http://mirage20-dup.agf.be/dashboard;
		proxy_redirect http://mirage20-dup.agf.be:8380/dashboard https://apps-dup.allianz.be;
}



location /esbclient {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT;
		allow 194.127.9.106;
		#AZ_WPA2_Auth;
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF;
		allow 194.127.72.13;
		#AZBE_IP_OFF
		#194.127.72.6;
		#AZNL_IP_OFF;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		#deny all;
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "mirage20-dup.agf.be";
        proxy_pass http://mirage20-dup.agf.be:8380/esbclient;
		proxy_redirect http://mirage20-dup.agf.be:8380 https://apps-dup.allianz.be;
		

    }
#Cloudflare_MedicalPlan
location /medicalplan {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT;
		allow 194.127.9.106;
		#AZ_WPA2_Auth;
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF;
		allow 194.127.72.13;
		#AZBE_IP_OFF
		#194.127.72.6;
		#AZNL_IP_OFF;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		#deny all;

		#CRPV1 Migration
		#proxy_set_header Host "m-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz";
                #proxy_pass https://m-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz;

		proxy_set_header Host "medical-plan-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_pass https://medical-plan-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/medicalplan/;

		#proxy_redirect https://m-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz/medicalplan https://apps-dup.allianz.be/medicalplan;
}

#INTERNET_MedicalPlan_be
location /medicalplan_be  {
		#CRPV1 Migration
		#proxy_set_header Host "n-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz";
		#proxy_pass https://n-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz/;
		
		proxy_set_header Host "medical-plan-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_pass https://medical-plan-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;
		
}  

location /medicalplan_be/track-quote-contract {

	#CRPV1 Migration	
	#proxy_set_header Host "n-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz";
	#proxy_pass  https://n-azbenelux-life-eb-medical-plan.apps.tools.adp.allianz/track-quote-contract;

        proxy_set_header Host "medical-plan-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass  https://medical-plan-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/track-quote-contract;
   
 }
 

#INTERNET_fastquote-home
location /homeinsurance/  {
		add_header X-Robots-Tag "noindex, follow" always;
		#CRPV1
		#proxy_set_header Host "fq-home-az-benelux-pc-fastquote-services.apps.tools.adp.allianz";
		#proxy_pass https://fq-home-az-benelux-pc-fastquote-services.apps.tools.adp.allianz/fastquote-home;
		
		proxy_set_header Host "fastquote-home-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_pass https://fastquote-home-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/homeinsurance/;
		
} 


location /fastquote-home/  {
		add_header X-Robots-Tag "noindex, follow" always;
		#CRPV1
		#proxy_set_header Host "fq-home-az-benelux-pc-fastquote-services.apps.tools.adp.allianz";
		#proxy_pass https://fq-home-az-benelux-pc-fastquote-services.apps.tools.adp.allianz/fastquote-home;
		
		return 302 https://apps-dup.allianz.be/homeinsurance/;
		
}


#INTERNET_Cybersafe

location /cybersafe  {
		#CRPV1 Migration
		#proxy_set_header Host "cybersafe-fe-azbnl-cybersafe.apps.tools.adp.allianz";
		#proxy_pass https://cybersafe-fe-azbnl-cybersafe.apps.tools.adp.allianz/cybersafe;

		proxy_set_header Host "cybersafe-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_pass https://cybersafe-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/cybersafe;

} 
#INTERNET_Cybersafe-be
location /cybersafe-bff  {
		#CRPV1 Migration
		#proxy_set_header Host "cybersafe-be-azbnl-cybersafe.apps.tools.adp.allianz";
		#proxy_pass https://cybersafe-be-azbnl-cybersafe.apps.tools.adp.allianz/cybersafe-be;

		proxy_set_header Host "cybersafe-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_pass https://cybersafe-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
		
} 
#INTERNET_AZNL_Quick_Quotes
location /aznl-quick-quotes  {
		#CRPV1 Migration
		#proxy_set_header Host "quick-quotes-fe-azbnl-quick-quotes.apps.tools.adp.allianz";
		#proxy_pass https://quick-quotes-fe-azbnl-quick-quotes.apps.tools.adp.allianz/aznl-quick-quotes;

		proxy_set_header Host "quick-quotes-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
                proxy_pass https://quick-quotes-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/aznl-quick-quotes;
		
} 
#INTERNET_ContactForms
location /contact-forms {
        #CRPV1 Migration		
        #proxy_set_header Host "contact-forms-fe-azbnl-contact-forms.apps.tools.adp.allianz";
        #proxy_pass https://contact-forms-fe-azbnl-contact-forms.apps.tools.adp.allianz/contact-forms;

		proxy_set_header Host "contactforms-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://contactforms-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/contact-forms/;

    }
#INTERNET_ContactForms-be
location /contact-forms-bff {
        #CRPV1 Migration 
        #proxy_set_header Host "contact-forms-be-azbnl-contact-forms.apps.tools.adp.allianz";
        #proxy_pass https://contact-forms-be-azbnl-contact-forms.apps.tools.adp.allianz/contact-forms-be;

		proxy_set_header Host "contactforms-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_pass https://contactforms-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/contact-forms-bff;
    }
#Cloudflare_Cyberscan
location /cyberscan {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		#deny all;
        proxy_set_header Host "cyberscan-fe-azbnl-cyberscan.apps.tools.adp.allianz";
        proxy_pass https://cyberscan-fe-azbnl-cyberscan.apps.tools.adp.allianz/cyberscan;
    }
#Cloudflare_Cyberscan-be
location /cyberscan-be {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		#deny all;
        proxy_set_header Host "cyberscan-be-azbnl-cyberscan.apps.tools.adp.allianz";
        proxy_pass https://cyberscan-be-azbnl-cyberscan.apps.tools.adp.allianz/cyberscan-be;
    }
#INTERNET_AT_Oasys_AZT
	

location /oasys {
        sub_filter_once off;
		sub_filter 'http://sla23068.srv.allianz:8180' 'https://apps-dup.allianz.be';
		sub_filter 'http://apps-dup.allianz.be:80' 'https://apps-dup.allianz.be';
		
		proxy_set_header Host "apps-dup.allianz.be";
        proxy_pass http://sla23068.srv.allianz:8180;
		proxy_redirect http://sla23068.srv.allianz:8180/oasys https://apps-dup.allianz.be/oasys;
    }

location /resources {
		sub_filter_once off;
		sub_filter 'http://sla23068.srv.allianz:8180' 'https://apps-dup.allianz.be';
		sub_filter 'http://apps-dup.allianz.be:80' 'https://apps-dup.allianz.be';
        proxy_set_header Host "apps-dup.allianz.be";
		proxy_pass http://sla23068.srv.allianz:8180;
		proxy_redirect http://sla23068.srv.allianz:8180/resources https://apps-dup.allianz.be;
    }
	
location /cwsoft {
		 sub_filter_once off;
		 sub_filter 'http://sla23068.srv.allianz:8180' 'https://apps-dup.allianz.be';
		 sub_filter 'http://apps-dup.allianz.be:80' 'https://apps-dup.allianz.be';
         proxy_set_header Host "apps-dup.allianz.be";
         proxy_pass http://sla23068.srv.allianz:8180;
		 proxy_redirect http://sla23068.srv.allianz:8180/cwsoft https://apps-dup.allianz.be;
    }
location /mensuraUpload {
		sub_filter_once off;
		sub_filter 'http://sla23068.srv.allianz:8180' 'https://apps-dup.allianz.be';
		sub_filter 'http://apps-dup.allianz.be:80' 'https://apps-dup.allianz.be';
		proxy_set_header Host "apps-dup.allianz.be";
        proxy_pass http://sla23068.srv.allianz:8180;
		proxy_redirect http://sla23068.srv.allianz:8180/mensuraUpload https://apps-dup.allianz.be;
    }

	

#Cloudflare_BonusdriveCMSNL

location /bonusdriveCMS {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		#deny all;
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "app-bonusdrive-be.apps.tools.adp.allianz";
        proxy_pass https://app-bonusdrive-be.apps.tools.adp.allianz/bonusdriveCMS;
    }
#INTERNET_customer-golden-profile-bff (Backend)
#location /customer-golden-profile-bff {
#		
#		proxy_set_header Host "cgp-be-azbnl-cgp.apps.tools.adp.allianz";
#       proxy_pass https://cgp-be-azbnl-cgp.apps.tools.adp.allianz/;
#	}

#INTERNET_customer-golden-profile (Front End)
#location /customer-golden-profile {
		#External
#		allow 194.127.26.64/26;
		##Proxy_AGN_1
#		allow 194.127.24.64/26;
		##Proxy_AGN_2;
#		deny all;
#		proxy_set_header Host "cgp-fe-azbnl-cgp.apps.tools.adp.allianz";
 #      proxy_pass https://cgp-fe-azbnl-cgp.apps.tools.adp.allianz/;
#}

#DNS tmpbtu-dup.allianz.be
#INTERNET_btu-affinity-fe-tst
location /btu-affinity-fe {
		  #CRPV1
		  proxy_set_header Host "affinity-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		  proxy_pass https://affinity-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-affinity-fe;
    }
	
#INTERNET_btu-affinity-bff-tst
location /btu-affinity-bff {
	#CRPV1
	proxy_set_header Host "affinity-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://affinity-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-affinity-bff;
        proxy_redirect https://affinity-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
    }
	
#INTERNET_btu-affinity-fe-uat
location /btu-uat-affinity-fe {

        #proxy_set_header Host "affinity-fe-uat-azbnl-btu-affinity.apps.tools.adp.allianz";
        #proxy_pass https://affinity-fe-uat-azbnl-btu-affinity.apps.tools.adp.allianz/btu-uat-affinity-fe;
        #proxy_redirect https://affinity-fe-uat-azbnl-btu-affinity.apps.tools.adp.allianz https://apps-dup.allianz.be;
		
		proxy_set_header Host "affinity-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://affinity-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-affinity-fe/;
        proxy_redirect https://affinity-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
		
    }

#INTERNET_btu-affinity-bff-uat
location /btu-uat-affinity-bff {

        #proxy_set_header Host "affinity-bff-uat-azbnl-btu-affinity.apps.tools.adp.allianz";
        #proxy_pass https://affinity-bff-uat-azbnl-btu-affinity.apps.tools.adp.allianz/btu-uat-affinity-bff;
        #proxy_redirect https://affinity-bff-uat-azbnl-btu-affinity.apps.tools.adp.allianz https://apps-dup.allianz.be;
		
		proxy_set_header Host "affinity-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://affinity-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-affinity-bff;
        proxy_redirect https://affinity-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
		
    }	
#INTERNET_btu-myservice-fe-tst
location /btu-myservice-fe {

        #roxy_set_header Host "myservice-fe-azbnl-btu-myservice.apps.tools.adp.allianz";
        #proxy_pass https://myservice-fe-azbnl-btu-myservice.apps.tools.adp.allianz/btu-myservice-fe;
		
		proxy_set_header Host "myservice-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://myservice-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-myservice-fe;
    }
	
#INTERNET_btu-myservice-bff-tst
location /btu-myservice-bff {

        #proxy_set_header Host "myservice-bff-azbnl-btu-myservice.apps.tools.adp.allianz";
        #proxy_pass https://myservice-bff-azbnl-btu-myservice.apps.tools.adp.allianz/btu-myservice-bff;
		
		proxy_set_header Host "myservice-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://myservice-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-myservice-bff;
    }	

#INTERNET_btu-myservice-fe-uat
location /btu-uat-myservice-fe {

        #proxy_set_header Host "myservice-fe-uat-azbnl-btu-myservice.apps.tools.adp.allianz";
        #proxy_pass https://myservice-fe-uat-azbnl-btu-myservice.apps.tools.adp.allianz/btu-uat-myservice-fe;
		
		proxy_set_header Host "myservice-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://myservice-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-myservice-fe/;
		proxy_redirect https://myservice-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
    }
	
#INTERNET_btu-myservice-bff-uat
location /btu-uat-myservice-bff {

        #proxy_set_header Host "myservice-bff-uat-azbnl-btu-myservice.apps.tools.adp.allianz";
        #proxy_pass https://myservice-bff-uat-azbnl-btu-myservice.apps.tools.adp.allianz/btu-uat-myservice-bff;
		
		proxy_set_header Host "myservice-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://myservice-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-myservice-bff;
		
		
    }

#INTERNET_bonusdriveCMS-DUP
location /bonusdriveCMS-DUP {

        proxy_set_header Host "app-bonusdrive-be-uat.apps.tools.adp.allianz";
        proxy_pass https://app-bonusdrive-be-uat.apps.tools.adp.allianz/bonusdriveCMS-DUP;
    }

location /prevention {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;
		
		#CRPV1 Migration	
		

		proxy_set_header Host "prevention-platform-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://prevention-platform-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/prevention;
        proxy_redirect https://prevention-platform-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
	}
	
location /prevention-bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#AZ_WPA2_Auth;
		allow 194.127.9.106;
		#AZ_WPA2Auth2
		allow 194.127.28.7;
	    #CRPV1 Migration	
		#proxy_set_header Host "prevention-platform-bff-azbnl-roadsafe.apps.tools.adp.allianz";
        #proxy_pass https://prevention-platform-bff-azbnl-roadsafe.apps.tools.adp.allianz/prevention-platform-bff ;
		#proxy_redirect https://prevention-platform-bff-azbnl-roadsafe.apps.tools.adp.allianz https://apps-dup.allianz.be;

		proxy_set_header Host "trans-prevention-platform-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://trans-prevention-platform-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/prevention-platform-bff;
        proxy_redirect https://trans-prevention-platform-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;

	}
#Prolinknet Project
location /prolinknet {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "pnet-fe-azbnl-prolinknet.apps.tools.adp.allianz";
        proxy_pass https://pnet-fe-azbnl-prolinknet.apps.tools.adp.allianz/prolinknet/;
		proxy_redirect https://pnet-fe-azbnl-prolinknet.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}

location /prolinknet/bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "pnet-bff-azbnl-prolinknet.apps.tools.adp.allianz";
        proxy_pass https://pnet-bff-azbnl-prolinknet.apps.tools.adp.allianz/prolinknet/bff/;
		proxy_redirect https://pnet-bff-azbnl-prolinknet.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
########################## My Allianz ####################################
   location /MyAllianz {
        #External
        allow 194.127.26.64/26;
        ##Proxy_AGN_1
        allow 194.127.24.64/26;
        ##Proxy_AGN_2;
        allow 109.134.152.80;
        #deny all;
		
	   
	   proxy_set_header Host "up-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
       proxy_pass https://up-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/MyAllianz/;
	   proxy_redirect https://up-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.nl;
		
	  
		
	   
   }

  

#Colaboration-platform Project
location /collaboration-platform {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		#CRPV1
		#proxy_set_header Host "eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
        #proxy_pass https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz/collaboration-platform/;
		#proxy_redirect https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
		
		proxy_set_header Host "eb-collaboration-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://eb-collaboration-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/collaboration-platform/;
		proxy_redirect https://eb-collaboration-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
	}
	
#can be removed  as it is replace collaboration-platform
location /ae-ebcollaboration-fe {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		
		proxy_set_header Host "eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
        proxy_pass https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz/ae-ebcollaboration-fe/;
		proxy_redirect https://eb-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	
location /myallianz-documents {
		
		
		#proxy_set_header Host "pnet-fe-doc-azbnl-prolinknet-uat.apps.tools.adp.allianz";
        #proxy_pass https://pnet-fe-doc-azbnl-prolinknet-uat.apps.tools.adp.allianz/myallianz-documents/;
		#proxy_redirect https://pnet-fe-doc-azbnl-prolinknet-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
		
		proxy_set_header Host "up-fe-doc-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://up-fe-doc-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/myallianz-documents/;
		proxy_redirect https://up-fe-doc-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
		
	}	
	
location /myallianz-documents/bff {
		
		
		#proxy_set_header Host "pnet-bff-azbnl-prolinknet-uat.apps.tools.adp.allianz";
        #proxy_pass https://pnet-bff-azbnl-prolinknet-uat.apps.tools.adp.allianz/MyAllianz/bff;
		#proxy_redirect https://pnet-bff-azbnl-prolinknet-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
		
		proxy_set_header Host "up-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://up-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/MyAllianz/bff;
		proxy_redirect https://up-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be;
		
		
	}
#old not in use
location /ebonline {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		set $my_host "eb-online-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://eb-online-azbnl-ebcollabora-uat.apps.tools.adp.allianz/ebonline/;
		#proxy_redirect https://eb-online-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	
location /eb-online-fe {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		set $my_host "eb-online-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
        #proxy_pass http://eb-online-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz/eb-online-fe/;
		proxy_pass https://eb-online-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-online-fe/;
		#proxy_redirect http://eb-online-fe-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	
	# in use eb 2.0
	location /ebonline/api/v1/oidc/login {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		set $my_host "eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz/eb-online-bff/api/v1/oidc/login;
		#proxy_redirect https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	# in use 2.0
	location /ebonline/api/v1/oidc/user {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		set $my_host "eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz/eb-online-bff/api/v1/oidc/user;
		#proxy_redirect https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	# in use 2.0
	location /ebonline/api/v1/oidc/callback {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		set $my_host "eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz/eb-online-bff/api/v1/oidc/callback;
		#proxy_redirect https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}

location /eb-online-bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		set $my_host "eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz/eb-online-bff;
		proxy_redirect https://eb-online-bff-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	

location /DedalUI {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		set $my_host "fwkdcc-fez-tst.mgm-tst.agf.be";
		proxy_set_header Host $my_host; 
        proxy_pass http://fwkhc-dev.agf.be/LVL3/NET4/Common/DedaleU;
	}	
	
	# Atline fully transparent SSO
	location /atline {
	  access_by_lua_block {
					local header_map = {
							Authorization = "credential.attributes['common|authz_header']",
											x_tb_session  = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
	  }
	  header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	  }
	  
	  sub_filter_once off;
	  sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'apps-dup.allianz.be';
	  
	  set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	  proxy_set_header Host $my_host;
	  proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Life/EB/Atline;
	  proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://apps-dup.allianz.be; 
   }
   
   location /lvl3/NET2/Life/EB/Atline {
	  access_by_lua_block {
					local header_map = {
							Authorization = "credential.attributes['common|authz_header']",
											x_tb_session  = ''
					}
					require("trustbuilder-gateway.protect").web_app(header_map)
	  }
	  header_filter_by_lua_block {
		require("trustbuilder-gateway.auth_interface")()
	  }
	  
	  sub_filter_once off;
	  sub_filter 'fwkhc-fez-dup.mgm-dup.agf.be' 'apps-dup.allianz.be';
	  
	  set $my_host "fwkhc-fez-dup.mgm-dup.agf.be";
	  proxy_set_header Host $my_host;
	  proxy_pass http://fwkhc-fez-dup.mgm-dup.agf.be/lvl3/NET2/Life/EB/Atline;
	  proxy_redirect http://fwkhc-fez-dup.mgm-dup.agf.be https://apps-dup.allianz.be; 
   }
  
 	
	  location /risk {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		#CRPV1
		#set $my_host "ra-fe-uat-azbnl-notification-bfi.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
		#proxy_pass https://ra-fe-uat-azbnl-notification-bfi.apps.tools.adp.allianz;
		
		set $my_host "risk-awareness-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://risk-awareness-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz;
	}
	
 location /risk-api {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		#CRPV1
		#set $my_host "ra-bff-uat-azbnl-notification-bfi.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
		#proxy_pass https://ra-bff-uat-azbnl-notification-bfi.apps.tools.adp.allianz/api;
		
		set $my_host "risk-awareness-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
		proxy_pass https://risk-awareness-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/api;
	}
	 
	
	#location / {
		#External
	#	allow 194.127.26.64/26;
		##Proxy_AGN_1
	#	allow 194.127.24.64/26;
	#	allow 212.113.67.18;
		##Proxy_AGN_2;
	#	deny all;
	#	set $my_host "bridge-fe.aks-azbnl-we1-nonprod.azbnl.we1.azure.aztec.cloud.allianz";
	#	proxy_set_header Host $my_host;
     #   proxy_pass https://bridge-fe.aks-azbnl-we1-nonprod.azbnl.we1.azure.aztec.cloud.allianz;
		##proxy_redirect https://bridge-fe.aks-azbnl-we1-nonprod.azbnl.we1.azure.aztec.cloud.allianz https://apps-dup.allianz.be/plppoc; 
		
		
	#}
 
 #Mortgage staging
	location /mortgage { 
   #set $my_host "allianzstg.alpha1.be";
   #proxy_pass https://allianzstg.alpha1.be/;
   #proxy_redirect https://allianzstg.alpha1.be https://apps-dup.allianz.be/mortgage;
	}
	
 #New Cognos 10 on Windows 2019
	location /bi {
		access_by_lua_block {
  		local header_map = {
  			Authorization="credential.attributes['common|authz_header']", 
  			x_tb_session   = ''
  		}
  		require("trustbuilder-gateway.protect").web_app(header_map)
  	}
		set $my_host "cognos1920-dup.agf.be";
		proxy_set_header Host $my_host; 
    proxy_pass http://cognos1920-dup.agf.be/ibmcognos/bi;
	}
   
  # PRIIPS 21-11-2023
	location /productandfundmodule/UI {
		set $my_host "life-priips-calculation-be-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
    proxy_pass https://life-priips-calculation-be-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/priips-documents/performance/search;
	}
 
  location /priips-documents {
		set $my_host "life-priips-calculation-be-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
    proxy_pass https://life-priips-calculation-be-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/priips-documents;
	}

	location /priips-documents-be {
		set $my_host "life-priips-calculation-be-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
    	proxy_pass https://life-priips-calculation-be-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/priips-documents-be;
	}
   
  # location /bridge {
	#	set $my_host "bridge-fe.aks-azbnl-we1-nonprod.azbnl.we1.azure.aztec.cloud.allianz";
	#	proxy_set_header Host $my_host; 
    #proxy_pass https://bridge-fe.aks-azbnl-we1-nonprod.azbnl.we1.azure.aztec.cloud.allianz/;
	#}
  
  # Temp for testing from GDP
  location /RadarLiveWS-DEV {
		allow 81.207.204.51;
		#Marketscan solera.nl
		allow 77.163.140.236;
		#Marketscan solera.nl
		#Marketscan
		allow 83.247.10.69;
		#Marketscan_DEV
		allow 87.195.108.55;
		#Marketscan_PC
		allow 95.142.98.12;
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 44.133.30.0/25;
		#GDP Range
		#deny all;
		
		sub_filter 'http://radarlive-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz' 'https://apps-dup.allianz.be';
		sub_filter_types text/html text/css text/xml;
		sub_filter_once off;
		
		proxy_set_header Host "radarlive-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_pass https://radarlive-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/RadarLiveWS-DEV; 
   }
# temp test it as eb-uat is nto responding
 location /eb-portal-bo-fe {
     #set $my_host "eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
     #proxy_set_header Host $my_host;
     #proxy_pass  https://eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-bo-fe/;
	 #proxy_redirect https://eb-portal-bo-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-portal-bo-fe/ https://eb-uat.allianz.be/;
	 
	 #CRPV221062023
	 set $my_host "eb-portal-bo-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
     proxy_set_header Host $my_host;
     proxy_pass  https://eb-portal-bo-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-bo-fe/;
	 proxy_redirect https://eb-portal-bo-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-portal-bo-fe/ https://eb-uat.allianz.be/;
   }
}
 
server {   
   listen *:443 ssl;
   server_name climb-tst.allianz.be;
   access_log /opt/trustbuilder/gateway/instances/default/logs/climb-tst.allianz.be/climb-tst.allianz.be_access.log logstash;
   root /opt/trustbuilder/gateway/instances/default/docroots/root;

   error_page 404 /404.html;
   error_page 403 /403.html;
   error_page 500 502 503 504 /500.html;

   # Configuration of root vhost 

#climb-tst.allianz.be
location / {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT
		allow 194.127.9.106;
		#AZ_WPA2_Auth
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF
		allow 194.127.72.7;
		#AZBE_IP_OFF_1
		allow 194.127.72.13;
		#AZBE_IP_OFF
		allow 194.127.72.6;
		#AZNL_IP_OFF
		allow 191.235.131.37;
		#Click_1
		allow 191.235.132.226;
		#Click_10
		allow 191.235.131.249;
		#Click_11
		allow 191.235.130.254;
		#Click_12
		allow 191.235.129.90;
		#Click_13
		allow 191.235.135.16;
		#Click_14
		allow 191.235.131.217;
		#Click_15
		allow 104.214.218.45;
		#Click_16
		allow 23.102.54.167;
		#Click_17
		allow 40.113.80.190;
		#Click_18
		allow 40.113.84.45;
		#Click_19
		allow 40.113.81.82;
		#Click_2
		allow 40.113.87.99;
		#Click_20
		allow 40.113.87.3;
		#Click_21
		allow 52.169.0.238;
		#Click_22
		allow 191.235.130.156;
		#Click_3
		allow 191.235.135.29;
		#Click_4
		allow 191.235.130.239;
		#Click_5
		allow 191.235.131.125;
		#Click_6
		allow 191.235.128.160;
		#click_7
		allow 40.69.22.169;
		#Click_8
		allow 191.235.133.92;
		#Click_9
		allow 213.39.91.253;
		deny all;
		proxy_set_header Host  "Climb-tst.allianz.be";
		proxy_pass   http://Climb-tst.allianz.be/;
        
	}

}

 
server {
    listen *:443 ssl;
    ## listen *: 80;
    server_name tmpbtu-dup.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/tmpbtu-dup.allianz.be/tmpbtu-dup.allianz.be_access.log logstash;
    
    root /opt/trustbuilder/gateway/instances/default/docroots/root;
    
    allow 173.245.48.0/20;
    allow 103.21.244.0/22;
    allow 103.22.200.0/22;
    allow 103.31.4.0/22;
    allow 141.101.64.0/18;
    allow 108.162.192.0/18;
    allow 190.93.240.0/20;
    allow 188.114.96.0/20;
    allow 197.234.240.0/22;
    allow 198.41.128.0/17;
    allow 162.158.0.0/15;
    allow 104.16.0.0/12;
    allow 172.64.0.0/13;
    allow 131.0.72.0/22;
	
	

location /{
}


#DNS tmpbtu-dup.allianz.be
#INTERNET_btu-affinity-fe-tst
location /btu-affinity-fe {

        #proxy_set_header Host "btu-affinity-fe-azbnl-btu-affinity.apps.tools.adp.allianz";
        #proxy_pass https://btu-affinity-fe-azbnl-btu-affinity.apps.tools.adp.allianz/btu-affinity-fe;
		 proxy_set_header Host "affinity-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		 proxy_pass https://affinity-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-affinity-fe;
    }
	
#INTERNET_btu-affinity-bff-tst
location /btu-affinity-bff {

        #proxy_set_header Host "btu-affinity-bff-azbnl-btu-affinity.apps.tools.adp.allianz";
        #proxy_pass https://btu-affinity-bff-azbnl-btu-affinity.apps.tools.adp.allianz/btu-affinity-bff;
		proxy_set_header Host "affinity-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://affinity-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-affinity-bff;
    }
	
#INTERNET_btu-affinity-fe-uat
location /btu-uat-affinity-fe {

        #proxy_set_header Host "affinity-fe-uat-azbnl-btu-affinity.apps.tools.adp.allianz";
        #proxy_pass https://affinity-fe-uat-azbnl-btu-affinity.apps.tools.adp.allianz/btu-uat-affinity-fe;
		
		proxy_set_header Host "affinity-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://affinity-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-affinity-fe;
    }

#INTERNET_btu-affinity-bff-uat
location /btu-uat-affinity-bff {

        #proxy_set_header Host "affinity-bff-uat-azbnl-btu-affinity.apps.tools.adp.allianz";
        #proxy_pass https://affinity-bff-uat-azbnl-btu-affinity.apps.tools.adp.allianz/btu-uat-affinity-bff;
		
		proxy_set_header Host "affinity-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://affinity-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-affinity-bff;
		
    }	
#INTERNET_btu-myservice-fe-tst
location /btu-myservice-fe {

        proxy_set_header Host "myservice-fe-azbnl-btu-myservice.apps.tools.adp.allianz";
        proxy_pass https://myservice-fe-azbnl-btu-myservice.apps.tools.adp.allianz/btu-myservice-fe;
    }
	
#INTERNET_btu-myservice-bff-tst
location /btu-myservice-bff {

        proxy_set_header Host "myservice-bff-azbnl-btu-myservice.apps.tools.adp.allianz";
        proxy_pass https://myservice-bff-azbnl-btu-myservice.apps.tools.adp.allianz/btu-myservice-bff;
    }	

#INTERNET_btu-myservice-fe-uat
location /btu-uat-myservice-fe {

        #proxy_set_header Host "myservice-fe-uat-azbnl-btu-myservice.apps.tools.adp.allianz";
        #proxy_pass https://myservice-fe-uat-azbnl-btu-myservice.apps.tools.adp.allianz/btu-uat-myservice-fe;
		
		proxy_set_header Host "myservice-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://myservice-fe-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-myservice-fe;
    }
	
#INTERNET_btu-myservice-bff-uat
location /btu-uat-myservice-bff {

        #proxy_set_header Host "myservice-bff-uat-azbnl-btu-myservice.apps.tools.adp.allianz";
        #proxy_pass https://myservice-bff-uat-azbnl-btu-myservice.apps.tools.adp.allianz/btu-uat-myservice-bff;
		
		proxy_set_header Host "myservice-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
        proxy_pass https://myservice-bff-acc.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/btu-uat-myservice-bff;
    }

#INTERNET_bonusdriveCMS-DUP
location /bonusdriveCMS-DUP {

        proxy_set_header Host "app-bonusdrive-be-uat.apps.tools.adp.allianz";
        proxy_pass https://app-bonusdrive-be-uat.apps.tools.adp.allianz/bonusdriveCMS-DUP;
    }

#EB New 
	location /eb-uat-portal-fe {
        proxy_set_header Host "eb-portal-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz";
        proxy_pass https://eb-portal-fe-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-uat-portal-fe;
    }
	
	location /eb-uat-portal-bff {
        proxy_set_header Host "eb-portal-bff-azbnl-eb-portal-uat.apps.tools.adp.allianz";
        proxy_pass https://eb-portal-bff-azbnl-eb-portal-uat.apps.tools.adp.allianz/eb-uat-portal-bff;
    }
	
	
}
 
server {
    listen *:443 ssl;
    server_name api-uat.allianz.nl;
    access_log /opt/trustbuilder/gateway/instances/default/logs/api-uat.allianz.be/api-uat.allianz.nl_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    error_page 404 /404.html;
    error_page 403 /403.html;
    error_page 500 502 503 504 /500.html;

    

 location / {
                #deny all;
                proxy_set_header Host "eu-uat-benelux.apis.allianz";
                proxy_pass https://eu-uat-benelux.apis.allianz;

        }

	
}
 
server {
    listen *:443 ssl;
    server_name api-uat.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/api-uat.allianz.be/api-uat.allianz.be_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    error_page 404 /404.html;
    error_page 403 /403.html;
    error_page 500 502 503 504 /500.html;

    
#location / {
 #} 
 
 #MyAllianz BFF
 
 location /MyAllianz {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
		proxy_pass https://eu-uat-benelux.apis.allianz.com/MyAllianz;
		#return 302 https://eu-uat-benelux.apis.allianz.com/MyAllianz/bff/login;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-uat.allianz.be;
        
		
	}
 
 location /MyAllianz/bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
		proxy_pass https://eu-uat-benelux.apis.allianz.com/MyAllianz/bff;
		#return 302 https://eu-uat-benelux.apis.allianz.com/MyAllianz/bff/login;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-uat.allianz.be;
        
		
	}
	
	location /ae-namirial-esign-bfi {
    ##Namirial
    allow 52.210.162.237;
    allow 52.211.203.240;
		##External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		deny all;
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
		proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-namirial-esign-bfi;
	}
	
	location /dposervice {
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
		proxy_pass http://eu-uat-benelux.apis.allianz.com:9003/dposervice;
	}

 location /ae-mira-bff-be {
                #deny all;
                proxy_set_header Host "eu-uat-benelux.apis.allianz";
                proxy_pass https://eu-uat-benelux.apis.allianz/ae-mira-bff-be;
                #return 302 https://eu-uat-benelux.apis.allianz.com/MyAllianz/bff/login;
                #proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-uat.allianz.be;

        }

	
}
 
server {
   listen *:443 ssl;
   ## listen *:80;
   server_name app-dup.allianz.nl;
	
  
   access_log /opt/trustbuilder/gateway/instances/default/logs/app-dup.allianz.nl_access.log logstash;
   root /opt/trustbuilder/gateway/instances/default/docroots/root;

	
   
   




#APPNL_BMWFS_AutoSchadeBackend_ut
location /bmwfs_autoschade_ut_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	#deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	#proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
    #proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz/;
	#CRPV2
	proxy_set_header Host "gateway-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	proxy_pass  https://gateway-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;
    #proxy_redirect   off;
   }

#APPNL_AutoSchade_ut
location /autoschade_ut {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	#deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	#proxy_set_header Host "r-azbenelux-gdf-fnol.apps.tools.adp.allianz";
    #proxy_pass  https://r-azbenelux-gdf-fnol.apps.tools.adp.allianz/autoschade_ut;
	
	#CRPV2
	proxy_set_header Host "gdf-fnol-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
    proxy_pass  https://gdf-fnol-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/autoschade_ut;
    #proxy_redirect   off;
   }
#APPNL_AutoSchadeBackend_ut
location /autoschade_ut_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	#deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	#proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
    #proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz/;
	#CRPV2
	proxy_set_header Host "gateway-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	proxy_pass  https://gateway-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/;
	
    #proxy_redirect   off;
   }

location /autoschade_ut_be/sbp {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	#deny all;
	#proxy_intercept_errors on;
	#rewrite_log on;
	#proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
	#proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz/sbp;
	#CRPV2
	proxy_set_header Host "gateway-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
	proxy_pass  https://gateway-bff-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/sbp;
	#proxy_redirect   off;
   }




#APPNL_FlexCoverTMX-DUP
location /flexcoverTMX {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	#deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bmw-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
    proxy_pass  https://bmw-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/flexcoverTMX;
    #proxy_redirect   off;
   }

location /flexcoverTMX/AllianzTMX_AFD {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	#deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bmw-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
    proxy_pass  https://bmw-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/flexcoverTMX/AllianzTMX_AFD;
    #proxy_redirect   off;
   }
   
location /flexcovertmx/AllianzTMX_AFD {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	#deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bmw-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
    proxy_pass  https://bmw-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/flexcovertmx/AllianzTMX_AFD;
    #proxy_redirect   off;
	
	
   }
   
}

 
server {
    listen *:443 ssl;
    server_name api-dup.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/api-dup.allianz.be/api-dup.allianz.be_access.log logstash;
    root /opt/trustbuilder/gateway/instances/default/docroots/root;

    error_page 404 /404.html;
    error_page 403 /403.html;
    error_page 500 502 503 504 /500.html;

    
#location / {
# } 

#climb-uat.allianz.be
location / {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT
		allow 194.127.9.106;
		#AZ_WPA2_Auth
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF
		allow 194.127.72.7;
		#AZBE_IP_OFF_1
		allow 194.127.72.13;
		#AZBE_IP_OFF
		allow 194.127.72.6;
		#AZNL_IP_OFF
		allow 191.235.131.37;
		#Click_1
		allow 191.235.132.226;
		#Click_10
		allow 191.235.131.249;
		#Click_11
		allow 191.235.130.254;
		#Click_12
		allow 191.235.129.90;
		#Click_13
		allow 191.235.135.16;
		#Click_14
		allow 191.235.131.217;
		#Click_15
		allow 104.214.218.45;
		#Click_16
		allow 23.102.54.167;
		#Click_17
		allow 40.113.80.190;
		#Click_18
		allow 40.113.84.45;
		#Click_19
		allow 40.113.81.82;
		#Click_2
		allow 40.113.87.99;
		#Click_20
		allow 40.113.87.3;
		#Click_21
		allow 52.169.0.238;
		#Click_22
		allow 191.235.130.156;
		#Click_3
		allow 191.235.135.29;
		#Click_4
		allow 191.235.130.239;
		#Click_5
		allow 191.235.131.125;
		#Click_6
		allow 191.235.128.160;
		#click_7
		allow 40.69.22.169;
		#Click_8
		allow 191.235.133.92;
		#Click_9
		
		#ainogo access (digidentity)		
		allow 145.53.216.3;
		allow 185.63.152.93;
		allow 185.63.152.244;
		allow 185.63.152.87;

		#deny all;
		#proxy_set_header Host  "Climb-uat.allianz.be";
		#proxy_pass   http://climb-uat.allianz.be;
        
	}

## XTal
location /xngcallback {	
	#sub_filter 'http://fwkdcc-dup-backend.agf.be/web/lvl3/Net4/Common/Services.Web/CallbackService.svc' 'https://api-dup.allianz.be/xngcallback';
	#sub_filter 'http://fwkdcc-dup-backend.agf.be:8080/web/lvl3/Net4/Common/Services.Web/CallbackService.svc' 'https://api-dup.allianz.be/xngcallback';
  sub_filter 'http://fwkhc-uat-backend.agf.be/web/lvl3/Net4/Common/Services.Web/CallbackService.svc' 'https://api-dup.allianz.be/xngcallback';
	sub_filter 'http://fwkhc-uat-backend.agf.be:8080/web/lvl3/Net4/Common/Services.Web/CallbackService.svc' 'https://api-dup.allianz.be/xngcallback';
	sub_filter_types text/html text/css text/xml;
	sub_filter_once off;
	proxy_set_header Host "fwkhc-uat-backend.agf.be";
  #Old Xtal svc
	#proxy_pass http://fwkdcc-dup-backend.agf.be:8080/web/lvl3/Net4/Common/Services.Web/CallbackService.svc;
  #HC Xtal svc
	proxy_pass http://fwkhc-uat-backend.agf.be:8080/web/lvl3/Net4/Common/Services.Web/CallbackService.svc;
}


## AML Service
location /AML {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.57.138.148;
	##Proxy_DCRP_1;
	allow 18.195.184.6;
	##Proxy_DCRP_2;
	allow 52.59.71.104;
	##Proxy_DCRP_3;
	allow 52.57.233.215;
	##Proxy_DCRP_4;
	allow 18.195.134.238;
	##Proxy_DCRP_5;
	allow 18.195.120.233;
	##Proxy_DCRP_6;
	allow 10.26.204.136;
    allow 10.26.192.106;
	#transitional-dev-1_3
	allow 44.92.204.0/22;
	allow 44.92.208.0/22;
	allow 44.92.212.0/22;
	
	allow 13.36.117.162;
	allow 13.37.219.95;
	allow 15.237.145.227;
	allow 35.180.239.235;
	allow 13.38.22.232;
	allow 35.181.23.151;
	allow 52.57.20.183;
	allow 18.198.149.247;
	allow 3.126.195.64;
	allow 52.29.218.127;
	allow 18.157.192.179;
	allow 35.156.15.231;
	deny all;
	 ##proxy_intercept_errors on;
     ##rewrite_log on;
	 #OLD BAPPS 
     #proxy_pass  http://externalws-dup.mgm-dup.agf.be/Aml;
     #proxy_redirect   off;
     #proxy_set_header Host "externalws-dup.mgm-dup.agf.be";
	 
	 #New BAPPS 
	 proxy_pass  http://externalwshc-ext-uat.agf.be/Aml;
     #proxy_redirect   off;
     proxy_set_header Host "externalwshc-ext-uat.agf.be";
   }

#digidentityWS 
location /digidentityWS/eWS/user/webUserManagement {
    satisfy any;
    auth_basic "Anonymous authentication";
    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";

    auth_request /tb_int_auth;
    auth_request_set $user $upstream_http_x_forwarded_user;

    proxy_set_header Host $host;
    proxy_pass http://e1-absesb1-uat.agf.be:8084/eWS/user/webUserManagement;
    proxy_ssl_verify off;
}

#dispatchWS
location /dispatchWS/eWS/contract/dispatch/contractDetail {
	
    satisfy any;
    auth_basic "Anonymous";
    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";
	
    auth_request /tb_int_auth;
    auth_request_set $user $upstream_http_x_forwarded_user;
	 proxy_set_header Host "e1-absesb-uat.agf.be";
    proxy_pass http://e1-absesb1-uat.agf.be:8084/eWS/contract/dispatch/contractDetail;
    proxy_ssl_verify off; 
}

#digidentityWS 
location /digidentityWS-tst/eWS/user/webUserManagement {
    satisfy any;
    auth_basic "Anonymous authentication";
    auth_basic_user_file "/opt/trustbuilder/gateway/instances/default/ssl/htpasspwd";

    auth_request /tb_int_auth;
    auth_request_set $user $upstream_http_x_forwarded_user;
    proxy_set_header Host "e1-absesb1-tst.agf.be:8081";
    proxy_pass http://e1-absesb1-tst.agf.be:8081/eWS/user/webUserManagement;
	#http://e1-absesb1-tst.agf.be:8081/eWS/user/webUserManagement/WebuserManagementService?wsdl
    proxy_ssl_verify off;
}
location = /tb_int_auth { 
	internal;
	#Digidentity
	allow 194.127.8.150;
    #AZ_IP_OFF_FRANKFURT 
    allow 194.127.9.106;
    #AZ_WPA2_Auth 
    allow 194.7.155.132;
    #AZBE_CMO_IP_OFF 
    allow 194.127.72.13;
    #AZBE_IP_OFF 
    allow 194.127.72.6;
    #AZNL_IP_OFF 
    allow 2.51.147.59;
    #Digidentity_1 
    allow 34.251.16.238;
    #Digidentity_2 
    allow 52.31.177.93;
    #Digidentity_3 
    allow 18.200.15.82;
    #Digidentity_4 
    allow 90.145.204.66;
    #Digidentity 
    allow 213.125.23.194;
    #Digidentity-tst 
	
	#Dispatch
	allow 194.127.26.64/26;
    ##Proxy_AGN_1 
    allow 194.127.24.64/26;
    ##Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 80.101.64.155;
	#Dispatch-DR
	allow 213.136.31.196;
	#Dispatch-NewProd
	allow 46.226.63.238;
	#Dispatch-NewUAT
	allow 95.97.71.30;
	#Dispatch-Test
	allow 80.126.213.19;
	#Disptach-Test1
	allow 85.148.166.1;
	#MarcoHankel@Home@22/10/2019
	allow 213.136.5.112/28;
	#Dispatch-subnet
	deny all; 
	
    proxy_pass https://orchestrator_backend/idhub/tb/anonymous_idp;
    proxy_ssl_verify    off;
    proxy_pass_request_body off;
    proxy_set_header Content-Length "";
    proxy_set_header X-Original-URI     $request_uri;
    proxy_set_header X-Real-IP          $remote_addr;
    proxy_set_header X-Client-IP        $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;
    proxy_set_header Authorization      $http_authorization;
    proxy_set_header Host               $http_host;
}



##RadarLiveWS
## DEV
location /RadarLiveWS-DEV {
		allow 81.207.204.51;
		#Marketscan solera.nl
		allow 77.163.140.236;
		#Marketscan solera.nl
		#Marketscan
		allow 83.247.10.69;
		#Marketscan_DEV
		allow 87.195.108.55;
		#Marketscan_PC
		allow 95.142.98.12;
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 44.133.30.0/25;
		#GDP Range
		deny all;
		
		sub_filter 'http://radarlive-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/' 'https://api-dup.allianz.be/';
		sub_filter_types text/html text/css text/xml;
		sub_filter_once off;
		
		proxy_set_header Host "radarlive-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_pass https://radarlive-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/RadarLiveWS-DEV/; 
   }
 
 location /RadarLiveWS-Voogd {
		#allow 194.127.26.64/26;
		##Proxy_AGN_1
		#allow 194.127.24.64/26;
		##Proxy_AGN_2
		#apigee
		#allow 44.130.0.38;
		#allow 44.130.0.11;

		#allow  44.130.0.148;
		#allow  44.130.0.187;
		#deny all;
		
		sub_filter 'http://radarlivedpo19-uat.agf.be:380/' 'https://api-dup.allianz.be/';
		sub_filter_types text/html text/css text/xml;
		sub_filter_once off;
		
		proxy_set_header Host "radarlivedpo19-uat.agf.be";
		proxy_pass http://radarlivedpo19-uat.agf.be:380/DpoService.svc;
   }
   
  
location /FraudSearchWS-DUP {
		allow 217.104.67.22;
		#MarcoHankel@Home@22/10/2019
		allow 52.30.40.12;
		#SnapCar_TST1
		allow 52.213.158.55;
		#SnapCar_TST2
		allow 52.49.252.142;
		#SnapCar_TST3
		allow 52.213.255.172;
		#SnapCar_TST4
		allow 54.154.7.182;
		#SnapCar_TST5
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		#deny all;
		##proxy_intercept_errors on;
		#rewrite_log on;
		proxy_pass   https://snapcar-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/FraudSearchWS-DUP;
		#proxy_redirect   off;
		proxy_set_header Host    "snapcar-bfi-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
   }
   
## NLPS DUP
location /MeFirstWS{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 91.183.8.77;
	 #MeFirst_TST_1
	 allow 91.183.224.53;
	 #MeFirst_TST_2
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host "externalwshc-ext-uat.agf.be";
   }
   
location /MarshWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 168.168.43.249;
	#Marsh_Prod_1
	allow 168.168.35.214;
	#Marsh_Prod_10
	allow 168.168.35.230;
	#Marsh_Prod_11
	allow 168.168.43.254;
	#Marsh_Prod_2
	allow 168.168.45.214;
	#Marsh_PROD_8
	allow 168.168.45.230;
	#Marsh_Prod_9
	allow 54.72.239.62;
	#Marsh_Prod
	allow 168.168.35.214;
	#Marsh_UAT_2
	allow 35.195.51.248;
	#Marsh-TST_1
	allow 35.195.81.90;
	#Marsh-TST_2
	allow 31.14.160.34;
	allow 168.168.127.192/26;
	#Marsh-TST
	#NonLifePricingService Test Marsh rule from BE300636
	#194.127.26.75;
	#NLPSTestFromBE300636
	allow 168.168.43.248/29;
	allow 168.168.45.224/29;
	allow 168.168.33.248/29;
	allow 168.168.35.224/29;
	#Marsh_DUP_1
	allow 168.168.35.225/32;
	
	allow 168.168.45.248/30;
	#Marsh_Prod_3
	allow 168.168.33.248/30;
	#Marsh_Prod_4
	allow 168.168.35.248/30;
	#Marsh_Prod_5
	allow 168.168.43.248/30;
	#Marsh_Prod_6
	allow 168.168.45.225/32;
	#Marsh_Prod_7
	
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
location /CarPoolWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 81.82.205.150;
	#CarPool
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
   
location /CarPoolExcelWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.78.217.216;
	#CarPoolExcel_1
	allow 37.97.235.165;
	#CarPoolExcel_2;
	allow 149.210.154.126;
	#CarPoolExcel_3
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass    http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
   
location /ModixWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.29.75.213;
	#Modix_1
	allow 52.28.134.5;
	#Modix_2
	allow 78.21.63.41;
	#Modix_Dev_1
	allow 4.196.57.50;
	#Modix_Dev_2
	allow 52.18.243.178;
	#PricingService
	allow 52.19.172.135;
	#PricingService1
	deny all;

     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass              http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
location /WeGroupWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.18.243.178;
	#PricingService
	allow 52.19.172.135;
	#PricingService1
	allow 167.172.37.81;
	#WeGroup_1
	allow 40.74.2.154;
	#WeGroup_2
	allow 20.54.176.237;
	#WeGroup_3
	allow 91.182.194.48;
	#WeGroup_4
	allow 51.138.68.167;
	#WeGroup_5
	allow 91.166.210.51;
	#WeGroup_6
	allow 3.69.117.220;
	#WeGroup_9
	allow 139.144.74.159;
	#WeGroup_10
	allow 20.111.27.240;
	 deny all;

     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass   http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host "externalwshc-ext-uat.agf.be";
   } 
location /VanbredaWS {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.157.255.80/28;
	#VanBreda-Prod_4
	allow 94.143.188.0/29;
	#VanBreda-TST
	allow 185.101.43.228/31;
	#VanBreda-TST3
	allow 52.18.243.178;
	#PricingService
	allow  52.19.172.135;
	#PricingService1
	#allow 52.174.149.164;
	allow 40.68.245.211;
	#VanBreda-Dup_1
	allow 52.19.10.40;
	#VanBreda-Dup
	allow 194.78.251.150;
	#VanBreda-Prod_3
	allow 52.18.247.233;
	#VanBreda-Prod
	allow 213.251.74.88;
	#VanBreda-TST2
	allow 52.136.246.130;
	#VanBreda-TST4
	allow 13.93.91.78;
	#VanBreda-TST5
	allow 20.103.139.80/28;
	#New req
	allow 193.108.201.0/24;
	allow 185.101.43.228/31;
  # Vanbreda VPN (work from home)
  allow 208.127.140.0/24;
  # Vanbreda network
  allow 193.108.201.0/24;
  # Vanbreda Azure Test environment
  allow 20.103.139.80/28;
  #Newreq04072023
  allow 20.76.35.128/28;
  deny all;
  ##proxy_intercept_errors on;
  ##rewrite_log on;
  proxy_pass   http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
  #proxy_redirect   off;
  proxy_set_header Host "externalwshc-ext-uat.agf.be";
 }
location /VerzekeringenBeWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 188.93.84.3;
	#Verzekeringen.be_DUP_1
	allow 188.93.84.9;
	#Verzekeringen.be_DUP_2
	allow 51.145.179.161;
	#Verzekeringen.be_DUP_3
	allow 51.145.179.162;
	#Verzekeringen.be_DUP_4
	allow 137.117.153.55;
	#Verzekeringen.be_DUP_5
	allow 188.93.81.150;
	#New Cloud Provider IP 08/06/2021
	allow 52.209.158.45;
	#VerzekeringenDEV
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass              http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
location /BrocoliWS{
     allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 52.178.26.52;
	#Brocoli
	deny all;

    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }   
location /OpenBroker{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 3.120.48.206;
	 #OpenBroker 
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
location /SolidasWS{
     allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 allow 194.127.72.13;
	 #AZBE_IP_OFF
	 allow 54.36.183.16;
	 #Solidas
	 allow 194.78.203.56;
     #Solidas_1
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host   "externalwshc-ext-uat.agf.be";
   }
location /HypotheekWS {
    allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 18.202.122.118;
	#Hypotheek1
	allow 8.194.210.14;
	#Hypotheek2
	deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    #proxy_pass      http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
    #proxy_redirect   off;
    #proxy_set_header Host      "externalwshc-ext-uat.agf.be";
   }
#INTERNET__Simplesurance-dup 
location /Simplesurance{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 #Simplesurance Ips
	 allow 18.195.79.181;
	 allow 3.120.42.196;
	 allow 217.110.188.50;
	 allow 213.191.38.230;
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
  #portimamultipricing
  location /portimamultipricing{
	 allow 194.127.26.64/26;
	 ##Proxy_AGN_1
	 allow 194.127.24.64/26;
	 ##Proxy_AGN_2
	 allow 20.54.220.214;
	 allow 20.54.178.110;
	 allow 51.124.50.98;
	 allow 20.54.95.112;
	 allow 192.168.0.252;
	 allow 192.168.0.139;
	 allow 94.224.178.98;
	 deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass     http://externalwshc-ext-uat.agf.be:80/NonLife/MeFirst/Service/NonLifePricingService;
     #proxy_redirect   off;
     proxy_set_header Host  "externalwshc-ext-uat.agf.be";
   }
   
   
   
## Allianz Connect/Direct Connect
## Dup
location /allianzconnectws{
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 35.157.156.247;
	#Amazon-dup
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	# Allianz-Amezon - Duplex (NEW)
	allow 3.67.160.103;
	allow 196.179.246.130;
	allow 3.124.25.29;
	deny all;
    ##proxy_intercept_errors on;
    ##rewrite_log on;
    proxy_pass     http://externalws-dup.mgm-dup.agf.be/Common/AllianzConnect/Service;
    #proxy_redirect   off;
    proxy_set_header Host   "externalwshc-ext-uat.agf.be";
   }
##Tele Desk
##UAT
location /teledeskWS {
     allow 194.127.8.150;
	##AZ_IP_OFF_FRANKFUR;
	allow 194.127.9.106;
	##AZ_WPA2_Auth;
	allow 194.7.155.132;
	##AZBE_CMO_IP_OFF;
	allow 194.127.72.13;
	##AZBE_IP_OFF;
	allow 194.127.72.6;
	##AZNL_IP_OFF;
	allow 195.207.179.153;
	##TeleDesk;
	allow 194.127.26.64/26;
	##Proxy_AGN_1;
	allow 194.127.24.64/26;
	##Proxy_AGN_2;
	deny all;
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass              http://extranetservice-dup.allianz.be/LVL3/Net4/;
     #proxy_redirect   off;
     proxy_set_header Host            "externalwshc-ext-uat.agf.be";
   }
   
   location /GSERest{
	 ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/Transversal/GSERest;
     #proxy_redirect   off;
     proxy_set_header Host "anonymousws-hc-ext-uat.allianz.bee";
   }
location /Web/Anonymous/Net4/Transversal/GSERest{
	 ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/Transversal/GSERest;
     #proxy_redirect   off;
     proxy_set_header Host "anonymousws-hc-ext-uat.allianz.be";
   }
   
location /FastQuoteRest{
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		deny all;
		##proxy_intercept_errors on;
		##rewrite_log on;
		proxy_pass    http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/P_C/FastQuoteRest;
		#proxy_redirect   off;
		proxy_set_header Host "anonymousws-hc-ext-uat.allianz.be";
   }

location /FastQuoteRest-prod{
     ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass    http://anonymousws-mgm-prod.allianz.be/Web/Anonymous/Net4/P_C/FastQuoteRest;
     #proxy_redirect   off;
     proxy_set_header Host "anonymousws-mgm-prod.allianz.be";
   }

##app.allianz.nl
#APPNL_AutoSchade
location /autoschade {
	allow 194.127.26.64/26;
	##Proxy_AGN_1
	allow 194.127.24.64/26;
	##Proxy_AGN_2
	allow 52.57.138.148;
	##Proxy_DCRP_1;
	allow 18.195.184.6;
	##Proxy_DCRP_2;
	allow 52.59.71.104;
	##Proxy_DCRP_3;
	allow 52.57.233.215;
	##Proxy_DCRP_4;
	allow 18.195.134.238;
	##Proxy_DCRP_5;
	allow 18.195.120.233;
	##Proxy_DCRP_6;
	allow 10.26.204.136;
    allow 10.26.192.106;
	deny all;
	##proxy_intercept_errors on;
    ##rewrite_log on;
	proxy_set_header Host "r-azbnl-fnol-prod.apps.tools.adp.allianz";
    proxy_pass  https://r-azbnl-fnol-prod.apps.tools.adp.allianz/autoschade;
    #proxy_redirect   off;
   }
#APPNL_AutoSchadeBackend
location /autoschade_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz";
    proxy_pass  https://bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz/;
    #proxy_redirect   off;
   }
   
location /autoschade_be/sbp/file/requestid {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz";
    proxy_pass  https://bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz/autoschade_be/sbp/file/requestid;
    #proxy_redirect   off;
   }


location /autoschade_be/sbp/file/fetchfilelist {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz";
    proxy_pass  https://bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz/autoschade_be/sbp/file/fetchfilelist;
    #proxy_redirect   off;
   }
   
   
#APPNL_VWPFS_AutoSchadeBackend_ut
location /vwpfs_autoschade_ut_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
    proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz/;
    #proxy_redirect   off;
   }
#APPNL_VWPFS_AutoSchade_ut
location /vwpfs_autoschade_ut {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "s-azbenelux-gdf-fnol.apps.tools.adp.allianz";
    proxy_pass  https://s-azbenelux-gdf-fnol.apps.tools.adp.allianz/vwpfs_autoschade_ut;
    #proxy_redirect   off;
   }
#APPNL_VWPFS_AutoSchadeBackend
location /vwpfs_autoschade_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz";
    proxy_pass  https://bff-gw-azbnl-gdf-shared-prod.apps.tools.adp.allianz/;
    #proxy_redirect   off;
   }

  
#APPNL_VWPFS_AutoSchade
location /vwpfs_autoschade {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "gdf-fnol-saturnus-azbnl-fnol-prod.apps.tools.adp.allianz";
    proxy_pass  https://gdf-fnol-saturnus-azbnl-fnol-prod.apps.tools.adp.allianz/vwpfs_autoschade;
    #proxy_redirect   off;
   }
#APPNL_BMWFS_AutoSchadeBackend_ut
location /bmwfs_autoschade_ut_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
    proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz/;
    #proxy_redirect   off;
   }
#APPNL_BMWFS_AutoSchade_ut
location /bmwfs_autoschade_ut {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "b-azbenelux-gdf-fnol.apps.tools.adp.allianz";
    proxy_pass  https://b-azbenelux-gdf-fnol.apps.tools.adp.allianz/bmwfs_autoschade_ut;
    #proxy_redirect   off;
   }
#APPNL_BMWFS_AutoSchade
location /bmwfs_autoschade {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "gdf-bmw-fe-azbnl-fnol-prod.apps.tools.adp.allianz";
    proxy_pass  https://gdf-bmw-fe-azbnl-fnol-prod.apps.tools.adp.allianz/bmwfs_autoschade;
    #proxy_redirect   off;
   }
#APPNL_AutoSchade_ut
location /autoschade_ut {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "r-azbenelux-gdf-fnol.apps.tools.adp.allianz";
    proxy_pass  https://r-azbenelux-gdf-fnol.apps.tools.adp.allianz/autoschade_ut;
    #proxy_redirect   off;
   }
#APPNL_AutoSchadeBackend_ut
location /autoschade_ut_be {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.8.150;
	#AZ_IP_OFF_FRANKFURT
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 194.127.28.7;
	#AZ_WPA2Auth2
	allow 194.7.155.132;
	#AZBE_CMO_IP_OFF
	allow 194.127.72.7;
	#AZBE_IP_OFF_1
	allow 194.127.72.13;
	#AZBE_IP_OFF
	allow 194.127.72.6;
	#AZNL_IP_OFF
	allow 10.16.190.0/23;
	#AZBNL_GDP
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz";
    proxy_pass  https://bff-gateway-azbnl-gdf-shared.apps.tools.adp.allianz;
    #proxy_redirect   off;
   }
#APPNL_FlexCover
location /flexcover-prod {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "azb-services-azbnl-tmx-prod.apps.tools.adp.allianz";
    proxy_pass  https://azb-services-azbnl-tmx-prod.apps.tools.adp.allianz/flexcover-prod;
    #proxy_redirect   off;
   }
#APPNL_FlexCoverTMX
location /flexcoverTMX-prod {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bmw-tmx-azbnl-tmx-prod.apps.tools.adp.allianz";
    proxy_pass  https://bmw-tmx-azbnl-tmx-prod.apps.tools.adp.allianz/flexcoverTMX-prod;
    #proxy_redirect   off;
   }
 location /flexcovertmx-prod/AllianzTMX_AFD {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "bmw-tmx-azbnl-tmx-prod.apps.tools.adp.allianz";
    proxy_pass  https://bmw-tmx-azbnl-tmx-prod.apps.tools.adp.allianz/flexcovertmx-prod/AllianzTMX_AFD;
    #proxy_redirect   off;
   }
#APPNL_FlexCover-DUP
location /flexcover {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "abz-azbnl-tmx.apps.tools.adp.allianz";
    proxy_pass  https://abz-azbnl-tmx.apps.tools.adp.allianz/flexcover;
    #proxy_redirect   off;
   }
#APPNL_FlexCoverTMX-DUP
location /flexcoverTMX {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "tmx-azbnl-tmx.apps.tools.adp.allianz";
    proxy_pass  https://tmx-azbnl-tmx.apps.tools.adp.allianz/flexcoverTMX;
    #proxy_redirect   off;
   }
   location /flexcoverTMX/AllianzTMX_AFD {
	allow 194.127.26.64/26;
	#Proxy_AGN_1
	allow 194.127.24.64/26;
	#Proxy_AGN_2
	allow 194.127.9.106;
	#AZ_WPA2_Auth
	allow 185.107.100.18;
	#Colimbra_Test_IP
	allow 94.190.202.67;
	#Colimbra_Test_IP2
	allow 82.199.91.189;
	#Colimbra_Test_IP3
	allow 185.125.236.21;
	#Colimbra_Test_IP4
	allow 85.25.41.158;
	#Gremwell-IP1
	allow 85.25.74.212;
	#Gremwell-IP2
	allow 85.234.199.198;
	#Gremwell-IP3
	allow 87.66.2.253;
	#Gremwell-IP4
	allow 188.138.125.196;
	#Gremwell-IP5
	allow 94.143.189.241;
	#Humix_Wifi
	allow 85.25.41.144/28;
	#Gremwell-Subnet1
	allow 5.25.74.202/31;
	#Gremwell-Subnet2
	allow 85.25.79.128/25;
	#Gremwell-Subnet3
	deny all;
	#proxy_intercept_errors on;
    #rewrite_log on;
	proxy_set_header Host "tmx-azbnl-tmx.apps.tools.adp.allianz";
    proxy_pass  https://tmx-azbnl-tmx.apps.tools.adp.allianz/flexcoverTMX/AllianzTMX_AFD;
    #proxy_redirect   off;
   }
   
   location /ae-ebcollaboration-bff/api/bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
		return 302 https://eu-uat-benelux.apis.allianz.com/ae-ebcollaboration-bff/api/bff;
        #proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-ebcollaboration-bff/api/bff;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-dup.allianz.be;
	}
	
	location /ae-ebcollaboration-bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
		return 302 https://eu-uat-benelux.apis.allianz.com/ae-ebcollaboration-bff;
        #proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-collaboration-bff;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-dup.allianz.be;
	}
	
	
	location /ae-ebcollaboration-bff/login {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
        #proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-collaboration-bff/login;
		return 302 https://eu-uat-benelux.apis.allianz.com/ae-ebcollaboration-bff/login;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-dup.allianz.be;
	}
	
	location /ae-ebcollaboration-bff/login/refresh {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
        #proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-collaboration-bff/login;
		return 302 https://eu-uat-benelux.apis.allianz.com/ae-ebcollaboration-bff/login/refresh;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-dup.allianz.be;
	}
	
	location /ae-ebcollaboration-bff/logout {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eu-uat-benelux.apis.allianz.com";
        #proxy_pass https://eu-uat-benelux.apis.allianz.com/ae-collaboration-bff/login;
		return 302 https://eu-uat-benelux.apis.allianz.com/ae-ebcollaboration-bff/logout;
		#proxy_redirect https://eu-uat-benelux.apis.allianz.com https://apps-dup.allianz.be;
	}
	
	
	#MyAllianz
	location /MyAllianz {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		
		proxy_set_header Host "pnet-fe-azbnl-prolinknet-uat.apps.tools.adp.allianz";
        proxy_pass https://pnet-fe-azbnl-prolinknet-uat.apps.tools.adp.allianz/MyAllianz/;
		proxy_redirect https://pnet-fe-azbnl-prolinknet-uat.apps.tools.adp.allianz https://api-dup.allianz.be;
	}
	
	#MyAllianz BFF
	location /MyAllianz/bff {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		
		proxy_set_header Host "pnet-bff-azbnl-prolinknet-uat.apps.tools.adp.allianz";
        proxy_pass https://pnet-bff-azbnl-prolinknet-uat.apps.tools.adp.allianz/MyAllianz/bff;
		proxy_redirect https://pnet-bff-azbnl-prolinknet-uat.apps.tools.adp.allianz https://api-dup.allianz.be;
	}
   
   location /api/events/document/chrystal/create {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		allow 109.134.152.80;
		#deny all;
		
		proxy_set_header Host "notification-producer-bfi-azbnl-ebcollabora-uat.apps.tools.adp.allianz";
        proxy_pass https://notification-producer-bfi-azbnl-ebcollabora-uat.apps.tools.adp.allianz/api/events/document/chrystal/create;
		proxy_redirect https://notification-producer-bfi-azbnl-ebcollabora-uat.apps.tools.adp.allianz https://api-dup.allianz.be;
	}
 
 location /premiumnotification {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
    # Portima
    allow 20.54.178.110;
    allow 20.54.220.214;
    allow 51.124.50.98;
    allow 20.73.25.16;
    allow 20.82.40.82;
    allow 20.54.95.112;
    allow 20.105.95.230;
    allow 20.13.245.90;
    allow 40.127.232.26;
    allow 40.127.232.250;

		deny all;
		set $my_host "fwkhc-uat-backend.agf.be";
		proxy_set_header Host $my_host; 
    proxy_pass https://fwkhc-uat-backend.agf.be/LVL3/net4/oAuth/P_C/PremiumNotificationApi;
	}

   location /verifleet {
	proxy_set_header Host "anonymousws-hc-ext-uat.allianz.be";
    proxy_pass    http://anonymousws-hc-ext-uat.allianz.be/Web/Anonymous/Net4/P_C/VerifleetRestApi;
   }
}
 
server {
    listen *:443 ssl;
    ## listen *: 80;
    ## server_name api-tst.allianz.be;
    server_name z;
    access_log /opt/trustbuilder/gateway/instances/default/logs/anon_access.log logstash;
    allow 173.245.48.0/20;
    allow 103.21.244.0/22;
    allow 103.22.200.0/22;
    allow 103.31.4.0/22;
    allow 141.101.64.0/18;
    allow 108.162.192.0/18;
    allow 190.93.240.0/20;
    allow 188.114.96.0/20;
    allow 197.234.240.0/22;
    allow 198.41.128.0/17;
    allow 162.158.0.0/15;
    allow 104.16.0.0/12;
    allow 172.64.0.0/13;
    allow 131.0.72.0/22;

## AML Service
location /AML {
	 ##proxy_intercept_errors on;
     ##rewrite_log on;
     proxy_pass  http://externalws-dup.mgm-dup.agf.be/Aml;
     #proxy_redirect   off;
     proxy_set_header Host "externalws-dup.mgm-dup.agf.be";
   }
   
location /GenericSearchEngine/BrokerSearch/LoadBrokerSearch {

		if ($args ~ fr) {
			return 302  https://allianz.brussels/fr/particuliers/trouver-un-courtier.html;
		}
		return 302  https://allianz.brussels/nl/particuliers/trouver-un-courtier.html;
 }
 
location /GenericSearchEngine {

		if ($args ~ fr){
			return 302  https://allianz.brussels/fr/particuliers/trouver-un-courtier.html;
		}
		return 302  https://allianz.brussels/nl/particuliers/trouver-un-courtier.html;
 }
 
 location /emac/geolocalisation {

		if ($args ~ fr){
			return 302 https://allianz.be/nl/prive/autoschadehersteller.html;
		}
		return 302  https://allianz.be/nl/prive/autoschadehersteller.html;
 }
 
 
    #PreventionPolicy 
    location /PreventionPolicy-tst {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }

    location /Web/LVL3/Net4/Prevention/PreventionPolicy {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
    
    location /Web/LVL3/Net4/Prevention/PreventionPolicyDoc {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicyDoc;
    }

    #DUP
	  #PreventionPolicy 
    location /PreventionPolicy-dup {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
 location /web/LVL3/Net4/Prevention/PreventionPolicy {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-dup.agf.be";
        proxy_pass http://athena-dup.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
	
    #WoodLife 
 location /woodlife-dup {
        allow 194.127.26.64/26;
        ##Proxy_AGN_1 allow 194.127.24.64/26;
        ##Proxy_AGN_2 ##deny all;
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        ##return 302 http: //www.wood-life126.be;
        #proxy_redirect off;
        proxy_set_header Host "wood-life126-dup-mgm.allianz.be";
        proxy_pass http://wood-life126-dup-mgm.allianz.be/;
        proxy_redirect http://wood-life126-dup-mgm.allianz.be/ https://anon-dup-tmp.allianz.be/woodlife-dup/; 
    }
#FiscalForms
location /FiscalForms {

     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://athena-tst.agf.be/FiscalForms/;
     #proxy_redirect   off;
     proxy_set_header Host "athena-tst.agf.be";
 }
 
#performancecalculation
location /life/performancecalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-tst.agf.be";
      proxy_pass  http://athena-tst.agf.be/life/performancecalculation;
 }
location /Life/PerformanceCalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-tst.agf.be";
      proxy_pass  http://athena-tst.agf.be/Life/PerformanceCalculation;
 }
location /Life/PerformanceCalculation/UI {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-tst.agf.be";
      proxy_pass  http://athena-tst.agf.be/Life/PerformanceCalculation/UI;
 }


 # PLC UCM
 location /PLC/UCM {

     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://plc-fwkdcc-fez-dup.mgm-dup.agf.be/PLC/UCM;
     #proxy_redirect   off;
     proxy_set_header Host "plc-fwkdcc-fez-dup.mgm-dup.agf.be";
 }
 
 location /lvl0/emac/apps/EBWebSiteAffiliatesCarrefour {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-tst.allianz.be";
        proxy_pass http://anonymous-tst.allianz.be/lvl0/emac/apps/EBWebSiteAffiliatesCarrefour;
    }
	
 location /LVL0/PLP {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-tst.allianz.be";
        proxy_pass http://anonymous-tst.allianz.be/LVL0/PLP;
    }
#DUP
location /LVL0/emac/apps/EBWebSiteAffiliatesCarrefour {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-dup.allianz.be";
        proxy_pass http://anonymous-dup.allianz.be/lvl0/emac/apps/EBWebSiteAffiliatesCarrefour;
    }
	
 location /lvl0/PLP {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-dup.allianz.be";
        proxy_pass http://anonymous-dup.allianz.be/LVL0/PLP;
    }
	
location /Web/LVL3/Net4/P_C/FastQuote {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/P_C/FastQuote;
    }
	
	
 
}
 
server {
    listen *:443 ssl;
    ## listen *: 80;
    server_name apps-tst.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/apps-tst.allianz.be/apps-tst.allianz.be_access.log logstash;
    allow 173.245.48.0/20;
    allow 103.21.244.0/22;
    allow 103.22.200.0/22;
    allow 103.31.4.0/22;
    allow 141.101.64.0/18;
    allow 108.162.192.0/18;
    allow 190.93.240.0/20;
    allow 188.114.96.0/20;
    allow 197.234.240.0/22;
    allow 198.41.128.0/17;
    allow 162.158.0.0/15;
    allow 104.16.0.0/12;
    allow 172.64.0.0/13;
    allow 131.0.72.0/22;

location /GenericSearchEngine/BrokerSearch/LoadBrokerSearch {

		if ($args ~ fr) {
			return 302  https://allianz.brussels/fr/particuliers/trouver-un-courtier.html;
		}
		return 302  https://allianz.brussels/nl/particuliers/trouver-un-courtier.html;
 }
 
location /GenericSearchEngine {

		if ($args ~ fr){
			return 302  https://allianz.brussels/fr/particuliers/trouver-un-courtier.html;
		}
		return 302  https://allianz.brussels/nl/particuliers/trouver-un-courtier.html;
 }
 
#PreventionPolicy 
location /Web/LVL3/Net4/Prevention/PreventionPolicy {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicy;
    }
    
location /Web/LVL3/Net4/Prevention/PreventionPolicyDoc {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/Prevention/PreventionPolicyDoc;
    }

 #dispatchWS 
location /dispatchWS/eWS/contract/dispatch/contractDetail {
    ##proxy_intercept_errors on;
     ##rewrite_log on;
	proxy_set_header Host "e2-absesb.agf.be";
	proxy_pass http://e2-absesb.agf.be:8081/eWS/contract/dispatch/contractDetail;
    #proxy_redirect   off;
    
} 
#FiscalForms
location /FiscalForms {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://athena-tst.agf.be/FiscalForms/;
     #proxy_redirect   off;
     proxy_set_header Host "athena-tst.agf.be";
 }
 
#performancecalculation
location /life/performancecalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-tst.agf.be";
      proxy_pass  http://athena-tst.agf.be/life/performancecalculation;
 }
location /Life/PerformanceCalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-tst.agf.be";
      proxy_pass  http://athena-tst.agf.be/Life/PerformanceCalculation;
 }
location /Life/PerformanceCalculation/UI {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-tst.agf.be";
      proxy_pass  http://athena-tst.agf.be/Life/PerformanceCalculation/UI;
 }

 # PLC UCM
location /PLC/UCM {

     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://plc-fwkdcc-fez-dup.mgm-dup.agf.be/PLC/UCM;
     #proxy_redirect   off;
     proxy_set_header Host "plc-fwkdcc-fez-dup.mgm-dup.agf.be";
 }
 
location /lvl0/emac/apps/EBWebSiteAffiliatesCarrefour {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-tst.allianz.be";
        proxy_pass http://anonymous-tst.allianz.be/lvl0/emac/apps/EBWebSiteAffiliatesCarrefour;
    }
	
location /LVL0/PLP {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-tst.allianz.be";
        proxy_pass http://anonymous-tst.allianz.be/LVL0/PLP;
    }
	
location /Web/LVL3/Net4/P_C/FastQuote {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/P_C/FastQuote;
    }
	
location /web/LVL3/Net4/P_C/FastQuote {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/Web/LVL3/Net4/P_C/FastQuote;
    }

location /allianz/mybenefits{
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/allianz/mybenefits;
    }

location /allianz/media {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be/allianz/media;
    }
	
location /allianz/images {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "athena-tst.agf.be";
        proxy_pass http://athena-tst.agf.be//allianz/images;
    }
	

#INTERNET_XMed_apps	
location /xmed {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT;
		allow 194.127.9.106;
		#AZ_WPA2_Auth;
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF;
		allow 194.127.72.13;
		#AZBE_IP_OFF
		#194.127.72.6;
		#AZNL_IP_OFF;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		
		#deny all;
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "mirage10.agf.be";
        proxy_pass http://mirage30-tst.agf.be:8380/xmed;
		#proxy_redirect http://mirage30-tst.agf.be:8380/xmed/ https://anon.allianz.be/xmed;
		return 301 https://apps-tst.allianz.be/userportal/main/formLogin;
		
		
    }

location /userportal {
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2
		allow 194.127.8.150;
		#AZ_IP_OFF_FRANKFURT;
		allow 194.127.9.106;
		#AZ_WPA2_Auth;
		allow 194.7.155.132;
		#AZBE_CMO_IP_OFF;
		allow 194.127.72.13;
		#AZBE_IP_OFF
		#194.127.72.6;
		#AZNL_IP_OFF;
		allow 173.245.48.0/20;
		#Cloudflare-subnet1;
		allow 198.41.128.0/17;
		#Cloudflare-Subnet10;
		allow 162.158.0.0/15;
		#Cloudflare-Subnet11;
		allow 104.16.0.0/12;
		#Cloudflare-Subnet12;
		allow 172.64.0.0/13;
		#Cloudflare-Subnet13;
		allow 131.0.72.0/22;
		#Cloudflare-Subnet14;
		allow 103.21.244.0/22;
		#Cloudflare-Subnet2;
		allow 103.22.200.0/22;
		#Cloudflare-Subnet3;
		allow 103.31.4.0/22;
		#Cloudflare-Subnet4;
		allow 141.101.64.0/18;
		#Cloudflare-Subnet5;
		allow 108.162.192.0/18;
		#Cloudflare-Subnet6;
		allow 190.93.240.0/20;
		#Cloudflare-Subnet7;
		allow 188.114.96.0/20;
		#Cloudflare-Subnet8;
		allow 197.234.240.0/22;
		#Cloudflare-Subnet9;
		
		#deny all;
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "mirage10.agf.be";
        proxy_pass http://mirage30-tst.agf.be:8380/userportal/;
		proxy_redirect http://mirage30-tst.agf.be:8380/userportal https://apps-tst.allianz.be/userportal/main/formLogin;
		
    }
	
	#Colaboration-platform Project
	location /colaboration-platform {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eb-fe-azbnl-ebcollabora.apps.tools.adp.allianz";
        proxy_pass https://eb-fe-azbnl-ebcollabora.apps.tools.adp.allianz/ae-ebcollaboration-fe/;
		proxy_redirect https://eb-fe-azbnl-ebcollabora.apps.tools.adp.allianz https://apps-tst.allianz.be;
	}
	
	location /collaboration-platform {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "eb-fe-azbnl-ebcollabora.apps.tools.adp.allianz";
        proxy_pass https://eb-fe-azbnl-ebcollabora.apps.tools.adp.allianz/ae-ebcollaboration-fe/;
		proxy_redirect https://eb-fe-azbnl-ebcollabora.apps.tools.adp.allianz https://apps-dup.allianz.be;
	}
	
	#Colaboration-platform Project
	location /MyAllianz {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		
		proxy_set_header Host "pnet-fe-azbnl-prolinknet.apps.tools.adp.allianz";
        proxy_pass https://pnet-fe-azbnl-prolinknet.apps.tools.adp.allianz/MyAllianz;
		proxy_redirect https://pnet-fe-azbnl-prolinknet.apps.tools.adp.allianz https://apps-tst.allianz.be;
	}
	
	 location /risk {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		deny all;
		set $my_host "risk-awareness-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://risk-awareness-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/risk/;
	}
	
	location /eb-online-fe {
		#External
		allow 194.127.26.64/26;
		##Proxy_AGN_1
		allow 194.127.24.64/26;
		##Proxy_AGN_2;
		#deny all;
		#set $my_host "eb-online-fe-azbnl-ebcollabora.apps.tools.adp.allianz";
		#proxy_set_header Host $my_host; 
        #proxy_pass https://eb-online-fe-azbnl-ebcollabora.apps.tools.adp.allianz/eb-online-fe/;
		#proxy_redirect https://eb-online-fe-azbnl-ebcollabora.apps.tools.adp.allianz https://apps-tst.allianz.be;
		
		set $my_host "eb-online-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz";
		proxy_set_header Host $my_host; 
        proxy_pass https://eb-online-fe-dev.azbnl-nonprod.azbnl-u-u.we1.azure.aztec.cloud.allianz/eb-online-fe/;
		
	}
	
	
	
	
	
}
 
server {
    listen *:443 ssl;
    ## listen *: 80;
    server_name www-dup.allianz.be;
    access_log /opt/trustbuilder/gateway/instances/default/logs/www-dup.allianz.be/www-dup.allianz.be_access.log logstash;
    
    root /opt/trustbuilder/gateway/instances/default/docroots/root;
    
    allow 173.245.48.0/20;
    allow 103.21.244.0/22;
    allow 103.22.200.0/22;
    allow 103.31.4.0/22;
    allow 141.101.64.0/18;
    allow 108.162.192.0/18;
    allow 190.93.240.0/20;
    allow 188.114.96.0/20;
    allow 197.234.240.0/22;
    allow 198.41.128.0/17;
    allow 162.158.0.0/15;
    allow 104.16.0.0/12;
    allow 172.64.0.0/13;
    allow 131.0.72.0/22;
	allow 104.16.0.0/13;
	allow 104.24.0.0/14;
	
	

location /{
}

#FiscalForms
location /FiscalForms {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_pass   http://athena-dup.agf.be/FiscalForms/;
     #proxy_redirect   off;
     proxy_set_header Host "athena-dup.agf.be";
 }
 
#performancecalculation
location /life/performancecalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-dup.agf.be";
      proxy_pass  http://athena-dup.agf.be/life/performancecalculation;
 }
location /Life/PerformanceCalculation {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-dup.agf.be";
      proxy_pass  http://athena-dup.agf.be/Life/PerformanceCalculation;
 }
location /Life/PerformanceCalculation/UI {
     ##proxy_intercept_errors on;
     ##rewrite_log on;
      proxy_set_header Host "athena-dup.agf.be";
      proxy_pass  http://athena-dup.agf.be/Life/PerformanceCalculation/UI;
 }

 
location /lvl0/emac/apps/EBWebSiteAffiliatesCarrefour{
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-dup.allianz.be";
        proxy_pass http://anonymous-dup.allianz.be/lvl0/emac/apps/EBWebSiteAffiliatesCarrefour;
    }
	
 location /LVL0/PLP {
        ##proxy_intercept_errors on;
        ##rewrite_log on;
        #proxy_redirect off;
        proxy_set_header Host "anonymous-dup.allianz.be";
        proxy_pass http://anonymous-dup.allianz.be/LVL0/PLP;
    }
   
}
}
